!function t(e,i,s){function o(n,r){if(!i[n]){if(!e[n]){var h="function"==typeof require&&require;if(!r&&h)return h(n,!0);if(a)return a(n,!0);var l=new Error("Cannot find module '"+n+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[n]={exports:{}};e[n][0].call(c.exports,(function(t){return o(e[n][1][t]||t)}),c,c.exports,t,e,i,s)}return i[n].exports}for(var a="function"==typeof require&&require,n=0;n<s.length;n++)o(s[n]);return o}({1:[function(t,e,i){e.exports={name:"a-recit",title:"A-RECIT",version:"0.0.0",description:"Education component game based for A-Frame",homepage:"https://github.com/xx/README.md",main:"index.js",scripts:{prepare:"npm run build",clean:"rm arecit/*.js || del arecit\\*.js",build:'npm run clean && foreach -g src/*.js -x "browserify #{path} -o arecit/#{name}.js" && npm run minify',watch:'npm run clean && foreach -g src/*.js -C -x "watchify #{path} -d -o arecit/#{name}.js"',minify:'foreach -g arecit/*.js -C -x "minify #{path} > arecit/#{name}.min.js"',bump:"npm version minor --no-git-tag-version",gitadd:"git add package*.json arecit/*.js"},"pre-commit":["bump","build","gitadd"],keywords:["aframe","aframe-component","webvr","webxr","gamedev"],author:"RECITFAD based on poeticAndroid work's",license:"MIT",devDependencies:{browserify:"^17.0.0","foreach-cli":"^1.8.1",minify:"^7.0.2","pre-commit":"^1.2.2",watchify:"^4.0.0"}}},{}],2:[function(t,e,i){t("./libs/pools"),t("./libs/copyWorldPosRot"),t("./libs/ensureElement"),t("./libs/touchGestures"),t("./libs/betterRaycaster"),addEventListener("DOMContentLoaded",(t=>{document.body.addEventListener("swipeup",(t=>{document.body.requestFullscreen()}))})),t("./components/aframe-state-component"),t("./states/states"),t("./components/htmlembed"),t("./components/aframe-orbit-controls-component"),t("./components/classeroomdeskchair"),t("./components/grabbing"),t("./components/include"),t("./components/scienceslab/injectglasses"),t("./components/arealight"),t("./components/injectfluo"),t("./components/injectglove"),t("./components/injectplayer"),t("./components/scienceslab/injectbeaker"),t("./components/scienceslab/injecttesttube"),t("./components/scienceslab/injecterlenmeyer"),t("./components/scienceslab/injectcylindergraduate"),t("./components/limit"),t("./components/locomotion"),t("./components/onevent"),t("./components/onstate"),t("./components/aframe-state-component"),t("./components/physics"),t("./components/script"),t("./components/trigger"),t("./components/aframe-websurfaces.umd"),t("./primitives/a-glasses"),t("./primitives/a-fluorescent"),t("./primitives/a-beaker"),t("./primitives/a-testtube"),t("./primitives/a-cylindergraduate"),t("./primitives/a-erlenmeyer"),t("./primitives/a-glove"),t("./primitives/a-hand"),t("./primitives/a-main"),t("./primitives/a-player"),t("./primitives/a-laboratory"),t("./systems/laboratory");const s=t("../package");console.log(`${s.title} Version ${s.version} by ${s.author}\n(${s.homepage})`)},{"../package":1,"./components/aframe-orbit-controls-component":3,"./components/aframe-state-component":4,"./components/aframe-websurfaces.umd":5,"./components/arealight":6,"./components/classeroomdeskchair":7,"./components/grabbing":8,"./components/htmlembed":15,"./components/include":16,"./components/injectfluo":17,"./components/injectglove":18,"./components/injectplayer":19,"./components/limit":20,"./components/locomotion":21,"./components/onevent":25,"./components/onstate":26,"./components/physics":27,"./components/scienceslab/injectbeaker":31,"./components/scienceslab/injectcylindergraduate":32,"./components/scienceslab/injecterlenmeyer":33,"./components/scienceslab/injectglasses":34,"./components/scienceslab/injecttesttube":35,"./components/script":36,"./components/trigger":37,"./libs/betterRaycaster":38,"./libs/copyWorldPosRot":40,"./libs/ensureElement":41,"./libs/pools":42,"./libs/touchGestures":43,"./primitives/a-beaker":44,"./primitives/a-cylindergraduate":45,"./primitives/a-erlenmeyer":46,"./primitives/a-fluorescent":47,"./primitives/a-glasses":48,"./primitives/a-glove":49,"./primitives/a-hand":50,"./primitives/a-laboratory":51,"./primitives/a-main":52,"./primitives/a-player":53,"./primitives/a-testtube":54,"./states/states":55,"./systems/laboratory":56}],3:[function(t,e,i){!function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={exports:{},id:s,loaded:!1};return t[s].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.m=t,i.c=e,i.p="",i(0)}([function(t,e){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");var i,s=THREE.Math.radToDeg;AFRAME.registerComponent("orbit-controls",{dependencies:["position","rotation"],schema:{enabled:{default:!0},target:{default:""},distance:{default:1},enableRotate:{default:!0},rotateSpeed:{default:1},enableZoom:{default:!0},zoomSpeed:{default:1},enablePan:{default:!0},keyPanSpeed:{default:7},enableDamping:{default:!1},dampingFactor:{default:.25},autoRotate:{default:!1},autoRotateSpeed:{default:2},enableKeys:{default:!0},minAzimuthAngle:{default:-1/0},maxAzimuthAngle:{default:1/0},minPolarAngle:{default:0},maxPolarAngle:{default:Math.PI},minZoom:{default:0},maxZoom:{default:1/0},invertZoom:{default:!1},minDistance:{default:0},maxDistance:{default:1/0},rotateTo:{type:"vec3",default:{x:0,y:0,z:0}},rotateToSpeed:{type:"number",default:.05},logPosition:{type:"boolean",default:!1},autoVRLookCam:{type:"boolean",default:!0}},multiple:!1,init:function(){this.sceneEl=this.el.sceneEl,this.object=this.el.object3D,this.target=this.sceneEl.querySelector(this.data.target).object3D.position,console.log("enabled: ",this.data.enabled),this.isRunning=!1,this.lookControls=null,this.data.autoVRLookCam&&(this.el.components["look-controls"]||this.el.setAttribute("look-controls",""),this.lookControls=this.el.components["look-controls"],this.lookControls.pause(),this.el.sceneEl.addEventListener("enter-vr",this.onEnterVR.bind(this),!1),this.el.sceneEl.addEventListener("exit-vr",this.onExitVR.bind(this),!1)),this.dolly=new THREE.Object3D,this.dolly.position.copy(this.object.position),this.savedPose=null,this.STATE={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5,ROTATE_TO:6},this.state=this.STATE.NONE,this.EPS=1e-6,this.lastPosition=new THREE.Vector3,this.lastQuaternion=new THREE.Quaternion,this.spherical=new THREE.Spherical,this.sphericalDelta=new THREE.Spherical,this.scale=1,this.zoomChanged=!1,this.rotateStart=new THREE.Vector2,this.rotateEnd=new THREE.Vector2,this.rotateDelta=new THREE.Vector2,this.panStart=new THREE.Vector2,this.panEnd=new THREE.Vector2,this.panDelta=new THREE.Vector2,this.panOffset=new THREE.Vector3,this.dollyStart=new THREE.Vector2,this.dollyEnd=new THREE.Vector2,this.dollyDelta=new THREE.Vector2,this.vector=new THREE.Vector3,this.desiredPosition=new THREE.Vector3,this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.bindMethods()},update:function(t){if(console.log("component update"),this.data.rotateTo){var e=new THREE.Vector3(this.data.rotateTo.x,this.data.rotateTo.y,this.data.rotateTo.z);this.desiredPosition.equals(e)||(this.desiredPosition.copy(e),this.rotateTo(this.desiredPosition))}this.dolly.position.copy(this.object.position),this.updateView(!0)},remove:function(){this.isRunning=!1,this.removeEventListeners(),this.el.sceneEl.removeEventListener("enter-vr",this.onEnterVR,!1),this.el.sceneEl.removeEventListener("exit-vr",this.onExitVR,!1)},tick:function(t){!0===(!(!this.data.enabled||!this.isRunning)&&this.updateView())&&!0===this.data.logPosition&&console.log(this.el.object3D.position)},onEnterVR:function(t){this.saveCameraPose(),this.el.setAttribute("position",{x:0,y:2,z:5}),this.el.setAttribute("rotation",{x:0,y:0,z:0}),this.pause(),this.lookControls.play(),this.data.autoRotate&&console.warn("orbit-controls: Sorry, autoRotate is not implemented in VR mode")},onExitVR:function(t){this.lookControls.pause(),this.play(),this.restoreCameraPose(),this.updateView(!0)},pause:function(){this.isRunning=!1,this.removeEventListeners()},play:function(){var t,e;this.isRunning=!0,this.object.traverse((function(i){i instanceof THREE.PerspectiveCamera?(t=i,e="PerspectiveCamera"):i instanceof THREE.OrthographicCamera&&(t=i,e="OrthographicCamera")})),this.camera=t,this.cameraType=e,this.sceneEl.addEventListener("renderstart",this.onRenderTargetLoaded,!1),this.lookControls&&this.lookControls.pause(),this.canvasEl&&this.addEventListeners()},onRenderTargetLoaded:function(){this.sceneEl.removeEventListener("renderstart",this.onRenderTargetLoaded,!1),this.canvasEl=this.sceneEl.canvas,this.addEventListeners()},bindMethods:function(){this.onRenderTargetLoaded=this.onRenderTargetLoaded.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseWheel=this.onMouseWheel.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onKeyDown=this.onKeyDown.bind(this)},addEventListeners:function(){this.canvasEl.addEventListener("contextmenu",this.onContextMenu,!1),this.canvasEl.addEventListener("mousedown",this.onMouseDown,!1),this.canvasEl.addEventListener("mousewheel",this.onMouseWheel,!1),this.canvasEl.addEventListener("MozMousePixelScroll",this.onMouseWheel,!1),this.canvasEl.addEventListener("touchstart",this.onTouchStart,!1),this.canvasEl.addEventListener("touchend",this.onTouchEnd,!1),this.canvasEl.addEventListener("touchmove",this.onTouchMove,!1),window.addEventListener("keydown",this.onKeyDown,!1)},removeEventListeners:function(){this.canvasEl&&(this.canvasEl.removeEventListener("contextmenu",this.onContextMenu,!1),this.canvasEl.removeEventListener("mousedown",this.onMouseDown,!1),this.canvasEl.removeEventListener("mousewheel",this.onMouseWheel,!1),this.canvasEl.removeEventListener("MozMousePixelScroll",this.onMouseWheel,!1),this.canvasEl.removeEventListener("touchstart",this.onTouchStart,!1),this.canvasEl.removeEventListener("touchend",this.onTouchEnd,!1),this.canvasEl.removeEventListener("touchmove",this.onTouchMove,!1),this.canvasEl.removeEventListener("mousemove",this.onMouseMove,!1),this.canvasEl.removeEventListener("mouseup",this.onMouseUp,!1),this.canvasEl.removeEventListener("mouseout",this.onMouseUp,!1)),window.removeEventListener("keydown",this.onKeyDown,!1)},onContextMenu:function(t){t.preventDefault()},onMouseDown:function(t){if(this.data.enabled&&this.isRunning){if(t.button===this.mouseButtons.ORBIT&&(t.shiftKey||t.ctrlKey)){if(!1===this.data.enablePan)return;this.handleMouseDownPan(t),this.state=this.STATE.PAN}else if(t.button===this.mouseButtons.ORBIT){if(this.panOffset.set(0,0,0),!1===this.data.enableRotate)return;this.handleMouseDownRotate(t),this.state=this.STATE.ROTATE}else if(t.button===this.mouseButtons.ZOOM){if(this.panOffset.set(0,0,0),!1===this.data.enableZoom)return;this.handleMouseDownDolly(t),this.state=this.STATE.DOLLY}else if(t.button===this.mouseButtons.PAN){if(!1===this.data.enablePan)return;this.handleMouseDownPan(t),this.state=this.STATE.PAN}this.state!==this.STATE.NONE&&(this.canvasEl.addEventListener("mousemove",this.onMouseMove,!1),this.canvasEl.addEventListener("mouseup",this.onMouseUp,!1),this.canvasEl.addEventListener("mouseout",this.onMouseUp,!1),this.el.emit("start-drag-orbit-controls",null,!1))}},onMouseMove:function(t){if(this.data.enabled&&this.isRunning)if(t.preventDefault(),this.state===this.STATE.ROTATE){if(!1===this.data.enableRotate)return;this.handleMouseMoveRotate(t)}else if(this.state===this.STATE.DOLLY){if(!1===this.data.enableZoom)return;this.handleMouseMoveDolly(t)}else if(this.state===this.STATE.PAN){if(!1===this.data.enablePan)return;this.handleMouseMovePan(t)}},onMouseUp:function(t){this.data.enabled&&this.isRunning&&this.state!==this.STATE.ROTATE_TO&&(t.preventDefault(),t.stopPropagation(),this.handleMouseUp(t),this.canvasEl.removeEventListener("mousemove",this.onMouseMove,!1),this.canvasEl.removeEventListener("mouseup",this.onMouseUp,!1),this.canvasEl.removeEventListener("mouseout",this.onMouseUp,!1),this.state=this.STATE.NONE,this.el.emit("end-drag-orbit-controls",null,!1))},onMouseWheel:function(t){this.data.enabled&&this.isRunning&&!1!==this.data.enableZoom&&(this.state===this.STATE.NONE||this.state===this.STATE.ROTATE)&&(t.preventDefault(),t.stopPropagation(),this.handleMouseWheel(t))},onTouchStart:function(t){if(this.data.enabled&&this.isRunning){switch(t.touches.length){case 1:if(!1===this.data.enableRotate)return;this.handleTouchStartRotate(t),this.state=this.STATE.TOUCH_ROTATE;break;case 2:if(!1===this.data.enableZoom)return;this.handleTouchStartDolly(t),this.state=this.STATE.TOUCH_DOLLY;break;case 3:if(!1===this.data.enablePan)return;this.handleTouchStartPan(t),this.state=this.STATE.TOUCH_PAN;break;default:this.state=this.STATE.NONE}this.state!==this.STATE.NONE&&this.el.emit("start-drag-orbit-controls",null,!1)}},onTouchMove:function(t){if(this.data.enabled&&this.isRunning)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===this.enableRotate)return;if(this.state!==this.STATE.TOUCH_ROTATE)return;this.handleTouchMoveRotate(t);break;case 2:if(!1===this.data.enableZoom)return;if(this.state!==this.STATE.TOUCH_DOLLY)return;this.handleTouchMoveDolly(t);break;case 3:if(!1===this.data.enablePan)return;if(this.state!==this.STATE.TOUCH_PAN)return;this.handleTouchMovePan(t);break;default:this.state=this.STATE.NONE}},onTouchEnd:function(t){this.data.enabled&&this.isRunning&&(this.handleTouchEnd(t),this.el.emit("end-drag-orbit-controls",null,!1),this.state=this.STATE.NONE)},onKeyDown:function(t){this.data.enabled&&this.isRunning&&!1!==this.data.enableKeys&&!1!==this.data.enablePan&&this.handleKeyDown(t)},handleMouseDownRotate:function(t){this.rotateStart.set(t.clientX,t.clientY)},handleMouseDownDolly:function(t){this.dollyStart.set(t.clientX,t.clientY)},handleMouseDownPan:function(t){this.panStart.set(t.clientX,t.clientY)},handleMouseMoveRotate:function(t){this.rotateEnd.set(t.clientX,t.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart);var e=this.canvasEl===document?this.canvasEl.body:this.canvasEl;this.rotateLeft(2*Math.PI*this.rotateDelta.x/e.clientWidth*this.data.rotateSpeed),this.rotateUp(2*Math.PI*this.rotateDelta.y/e.clientHeight*this.data.rotateSpeed),this.rotateStart.copy(this.rotateEnd),this.updateView()},handleMouseMoveDolly:function(t){this.dollyEnd.set(t.clientX,t.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.data.invertZoom?this.dollyOut(this.getZoomScale()):this.dollyIn(this.getZoomScale()):this.dollyDelta.y<0&&(this.data.invertZoom?this.dollyIn(this.getZoomScale()):this.dollyOut(this.getZoomScale())),this.dollyStart.copy(this.dollyEnd),this.updateView()},handleMouseMovePan:function(t){this.panEnd.set(t.clientX,t.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd),this.updateView()},handleMouseUp:function(t){},handleMouseWheel:function(t){var e=0;void 0!==t.wheelDelta?e=t.wheelDelta:void 0!==t.detail&&(e=-t.detail),e>0?this.data.invertZoom?this.dollyIn(this.getZoomScale()):this.dollyOut(this.getZoomScale()):e<0&&(this.data.invertZoom?this.dollyOut(this.getZoomScale()):this.dollyIn(this.getZoomScale())),this.updateView()},handleTouchStartRotate:function(t){this.rotateStart.set(t.touches[0].pageX,t.touches[0].pageY)},handleTouchStartDolly:function(t){var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,s=Math.sqrt(e*e+i*i);this.dollyStart.set(0,s)},handleTouchStartPan:function(t){this.panStart.set(t.touches[0].pageX,t.touches[0].pageY)},handleTouchMoveRotate:function(t){this.rotateEnd.set(t.touches[0].pageX,t.touches[0].pageY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart);var e=this.canvasEl===document?this.canvasEl.body:this.canvasEl;this.rotateLeft(2*Math.PI*this.rotateDelta.x/e.clientWidth*this.data.rotateSpeed),this.rotateUp(2*Math.PI*this.rotateDelta.y/e.clientHeight*this.data.rotateSpeed),this.rotateStart.copy(this.rotateEnd),this.updateView()},handleTouchMoveDolly:function(t){var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,s=Math.sqrt(e*e+i*i);this.dollyEnd.set(0,s),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyIn(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyOut(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.updateView()},handleTouchMovePan:function(t){this.panEnd.set(t.touches[0].pageX,t.touches[0].pageY),this.panDelta.subVectors(this.panEnd,this.panStart),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd),this.updateView()},handleTouchEnd:function(t){},handleKeyDown:function(t){switch(t.keyCode){case this.keys.UP:this.pan(0,this.data.keyPanSpeed),this.updateView();break;case this.keys.BOTTOM:this.pan(0,-this.data.keyPanSpeed),this.updateView();break;case this.keys.LEFT:this.pan(this.data.keyPanSpeed,0),this.updateView();break;case this.keys.RIGHT:this.pan(-this.data.keyPanSpeed,0),this.updateView()}},getAutoRotationAngle:function(){return 2*Math.PI/60/60*this.data.autoRotateSpeed},getZoomScale:function(){return Math.pow(.95,this.data.zoomSpeed)},rotateLeft:function(t){this.sphericalDelta.theta-=t},rotateUp:function(t){this.sphericalDelta.phi-=t},rotateTo:function(t){this.state=this.STATE.ROTATE_TO,this.desiredPosition.copy(t)},panHorizontally:function(t,e){var i=new THREE.Vector3;i.setFromMatrixColumn(e,0),i.multiplyScalar(-t),this.panOffset.add(i)},panVertically:function(t,e){var i=new THREE.Vector3;i.setFromMatrixColumn(e,1),i.multiplyScalar(t),this.panOffset.add(i)},pan:function(t,e){var i=new THREE.Vector3,s=this.canvasEl===document?this.canvasEl.body:this.canvasEl;if("PerspectiveCamera"===this.cameraType){var o=this.dolly.position;i.copy(o).sub(this.target);var a=i.length();a*=Math.tan(this.camera.fov/2*Math.PI/180),this.panHorizontally(2*t*a/s.clientHeight,this.object.matrix),this.panVertically(2*e*a/s.clientHeight,this.object.matrix)}else"OrthographicCamera"===this.cameraType?(this.panHorizontally(t*(this.dolly.right-this.dolly.left)/this.camera.zoom/s.clientWidth,this.object.matrix),this.panVertically(e*(this.dolly.top-this.dolly.bottom)/this.camera.zoom/s.clientHeight,this.object.matrix)):(console.warn("Trying to pan: WARNING: Orbit Controls encountered an unknown camera type - pan disabled."),this.data.enablePan=!1)},dollyIn:function(t){"PerspectiveCamera"===this.cameraType?this.scale*=t:"OrthographicCamera"===this.cameraType?(this.camera.zoom=Math.max(this.data.minZoom,Math.min(this.data.maxZoom,this.camera.zoom*t)),this.camera.updateProjectionMatrix(),this.zoomChanged=!0):(console.warn("Trying to dolly in: WARNING: Orbit Controls encountered an unknown camera type - dolly/zoom disabled."),this.data.enableZoom=!1)},dollyOut:function(t){"PerspectiveCamera"===this.cameraType?this.scale/=t:"OrthographicCamera"===this.cameraType?(this.camera.zoom=Math.max(this.data.minZoom,Math.min(this.data.maxZoom,this.camera.zoom/t)),this.camera.updateProjectionMatrix(),this.zoomChanged=!0):(console.warn("Trying to dolly out: WARNING: Orbit Controls encountered an unknown camera type - dolly/zoom disabled."),this.data.enableZoom=!1)},lookAtTarget:function(t,e){var i=new THREE.Vector3;i.subVectors(t.position,e).add(t.position),t.lookAt(i)},saveCameraPose:function(){this.savedPose||(this.savedPose={position:this.dolly.position,rotation:this.dolly.rotation})},restoreCameraPose:function(){this.savedPose&&(this.dolly.position.copy(this.savedPose.position),this.dolly.rotation.copy(this.savedPose.rotation),this.savedPose=null)},updateView:function(t){if(this.desiredPosition&&this.state===this.STATE.ROTATE_TO){var e=new THREE.Spherical;e.setFromVector3(this.desiredPosition);var i=e.phi-this.spherical.phi,o=e.theta-this.spherical.theta;this.sphericalDelta.set(this.spherical.radius,i*this.data.rotateToSpeed,o*this.data.rotateToSpeed)}var a=new THREE.Vector3,n=(new THREE.Quaternion).setFromUnitVectors(this.dolly.up,new THREE.Vector3(0,1,0)),r=n.clone().inverse();if(a.copy(this.dolly.position).sub(this.target),a.applyQuaternion(n),this.spherical.setFromVector3(a),this.data.autoRotate&&this.state===this.STATE.NONE&&this.rotateLeft(this.getAutoRotationAngle()),this.spherical.theta+=this.sphericalDelta.theta,this.spherical.phi+=this.sphericalDelta.phi,this.spherical.theta=Math.max(this.data.minAzimuthAngle,Math.min(this.data.maxAzimuthAngle,this.spherical.theta)),this.spherical.phi=Math.max(this.data.minPolarAngle,Math.min(this.data.maxPolarAngle,this.spherical.phi)),this.spherical.makeSafe(),this.spherical.radius*=this.scale,this.spherical.radius=Math.max(this.data.minDistance,Math.min(this.data.maxDistance,this.spherical.radius)),this.target.add(this.panOffset),a.setFromSpherical(this.spherical),a.applyQuaternion(r),this.dolly.position.copy(this.target).add(a),this.target&&this.lookAtTarget(this.dolly,this.target),!0===this.data.enableDamping?(this.sphericalDelta.theta*=1-this.data.dampingFactor,this.sphericalDelta.phi*=1-this.data.dampingFactor):this.sphericalDelta.set(0,0,0),this.scale=1,this.panOffset.set(0,0,0),!0===t||this.zoomChanged||this.lastPosition.distanceToSquared(this.dolly.position)>this.EPS||8*(1-this.lastQuaternion.dot(this.dolly.quaternion))>this.EPS){var h=this.calculateHMDQuaternion(),l=new THREE.Euler;return l.setFromQuaternion(h,"YXZ"),this.el.setAttribute("position",{x:this.dolly.position.x,y:this.dolly.position.y,z:this.dolly.position.z}),this.el.setAttribute("rotation",{x:s(l.x),y:s(l.y),z:s(l.z)}),this.lastPosition.copy(this.dolly.position),this.lastQuaternion.copy(this.dolly.quaternion),this.zoomChanged=!1,!0}return!1},calculateHMDQuaternion:(i=new THREE.Quaternion,function(){return i.copy(this.dolly.quaternion),i})})}])},{}],4:[function(t,e,i){!function(t,s){if("object"==typeof i&&"object"==typeof e)e.exports=s();else if("function"==typeof define&&define.amd)define([],s);else{var o=s();for(var a in o)("object"==typeof i?i:t)[a]=o[a]}}("undefined"!=typeof self?self:this,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){"use strict";var s={};t.exports.select=function(t,e,i){return s[e]||(s[e]=new Function("state","item","return "+l(e)+";")),s[e](t,i)};var o=/\.([A-Za-z][\w_-]*)/g,a=/([=&|!?:+-])(\s*)([\(]?)([A-Za-z][\w_-]*)/g,n=/^([\(]?)([A-Za-z][\w_-]*)/g,r=/state\["item"\]/g,h=/state\["(true|false)"\]/g;function l(t){return t=(t=(t=(t=(t=t.replace(o,'["$1"]')).replace(n,'$1state["$2"]')).replace(a,'$1$2$3state["$4"]')).replace(r,"item")).replace(h,"$1")}function c(){var t=arguments;return function(){var e;for(e=0;e<t.length;e++)t[e].apply(this,arguments)}}t.exports.generateExpression=l,t.exports.clearObject=function(t){for(var e in t)delete t[e]},t.exports.composeHandlers=function(){var t,e,i,s=arguments;for(i={},e=0;e<s.length;e++)for(t in s[e])t in i?i[t].constructor===Array?i[t].push(s[e][t]):i[t]=[i[t],s[e][t]]:i[t]=s[e][t];for(t in i)i[t].constructor===Array&&(i[t]=c.apply(this,i[t]));return i},t.exports.composeFunctions=c;var d=["||","&&","!=","!==","==","===",">","<","<=",">="],u=/\s+/,p=/\(|\)|\!/g;function m(t){return-1===(t=function(t){if(0===t.indexOf("!!"))return t.replace("!!","");if(0===t.indexOf("!"))return t.replace("!","");return t}(t.trim())).indexOf(".")?t:t.substring(0,t.indexOf("."))}t.exports.parseKeysToWatch=function(t,e,i){var s,o;for(o=g(e,u),s=0;s<o.length;s++)if(-1===d.indexOf(o[s])&&!o[s].startsWith("'")&&-1===t.indexOf(o[s])){if(i&&"item"===o[s])continue;t.push(m(o[s]).replace(p,""))}return t};var b={};function g(t,e){return b[e]||(b[e]={}),b[e][t]||(b[e][t]=t.split(e)),b[e][t]}t.exports.split=g,t.exports.copyArray=function(t,e){var i;for(t.length=0,i=0;i<e.length;i++)t[i]=e[i]}},function(t,e,i){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};i(2);var o,a,n=i(3),r=i(0),h=i(4).wrapArray,l={initialState:{},nonBindedStateKeys:[],handlers:{},computeState:[function(){}]},c="object";AFRAME.registerState=function(t){var e=l.computeState;t.computeState&&e.push(t.computeState),AFRAME.utils.extendDeep(l,t),l.computeState=e},AFRAME.registerSystem("state",{init:function(){var t,e=this;for(t in this.arrays=[],this.dirtyArrays=[],this.diff={},this.state=AFRAME.utils.clone(l.initialState),this.subscriptions=[],this.initEventHandlers(),this.state)this.state[t]&&this.state[t].constructor===Array&&(this.arrays.push(t),this.state[t].__dirty=!0,h(this.state[t]));this.lastState=AFRAME.utils.clone(this.state),this.eventDetail={lastState:this.lastState,state:this.state},this.el.addEventListener("loaded",(function(){var t;for(t=0;t<l.computeState.length;t++)l.computeState[t](e.state,"@@INIT");for(t=0;t<e.subscriptions.length;t++)e.subscriptions[t].onStateUpdate(e.state)}))},dispatch:(a=[],function(t,e){var i,s;for(l.handlers[t](this.state,e),i=0;i<l.computeState.length;i++)l.computeState[i](this.state,t,e);for(s in this.diff)delete this.diff[s];for(n(this.lastState,this.state,this.diff,l.nonBindedStateKeys),this.dirtyArrays.length=0,i=0;i<this.arrays.length;i++)this.state[this.arrays[i]].__dirty&&this.dirtyArrays.push(this.arrays[i]);for(a.length=0,i=0;i<this.subscriptions.length;i++){if("bind-for"===this.subscriptions[i].name){if(!this.state[this.subscriptions[i].keysToWatch[0]].__dirty)continue}else if(!this.shouldUpdate(this.subscriptions[i].keysToWatch,this.diff,this.dirtyArrays))continue;-1===a.indexOf(this.subscriptions[i])&&a.push(this.subscriptions[i])}for(i=0;i<a.length;i++)a[i].onStateUpdate();for(s in this.state)this.state[s]&&this.state[s].constructor===Array&&(this.state[s].__dirty=!1);this.copyState(this.lastState,this.state),this.eventDetail.action=t,this.eventDetail.payload=e,this.el.emit("stateupdate",this.eventDetail)}),copyState:function(t,e,i){var s;for(s in e)if(i||-1===l.nonBindedStateKeys.indexOf(s))if(e[s]&&e[s].constructor===Object){if(!(s in t)){t[s]=AFRAME.utils.clone(e[s]);continue}this.copyState(t[s],e[s],!0)}else t[s]=e[s]},subscribe:function(t){this.subscriptions.push(t)},unsubscribe:function(t){var e=this.subscriptions.indexOf(t);e>-1&&this.subscriptions.splice(e,1)},shouldUpdate:function(t,e,i){for(var s=0;s<t.length;s++)if(t[s]in e||-1!==i.indexOf(t[s]))return!0;return!1},initEventHandlers:function(){var t,e=[];for(t in i=i.bind(this),l.handlers)-1===e.indexOf(t)&&(e.push(t),i(t));function i(t){var e=this;this.el.addEventListener(t,(function(i){e.dispatch(t,i.detail)}))}},renderTemplate:(o=/{{\s*(\w*\.)?([\w.]+)\s*}}/g,function(t,e,i){var a,n;if(n=t,e)for(;a=o.exec(t);)n=n.replace(a[0],(void 0===e?"undefined":s(e))===c?r.select(e,a[2])||"":e);return i?n:document.createRange().createContextualFragment(n)}),select:r.select}),AFRAME.registerComponent("bind",{schema:{default:{},parse:function(t){var e,i,s,o;if(t.constructor===Object)return t;if(-1===t.indexOf(":"))return t;for(e={},s=r.split(t,";"),i=0;i<s.length;i++)e[(o=r.split(s[i].trim(),":"))[0]]=o[1].trim();return e}},multiple:!0,init:function(){var t;this.data;this.keysToWatch=[],this.onStateUpdate=this.onStateUpdate.bind(this),this.system=this.el.sceneEl.systems.state,this.id&&(t=r.split(this.id,"__")[0]),this.isNamespacedBind=this.id&&t in AFRAME.components&&!AFRAME.components[t].isSingleProp||t in AFRAME.systems,this.lastData={},this.updateObj={},this.system.subscribe(this),this.onStateUpdate=this.onStateUpdate.bind(this)},update:function(){var t,e=this.data;if(this.keysToWatch.length=0,"string"==typeof e)r.parseKeysToWatch(this.keysToWatch,e);else for(t in e)r.parseKeysToWatch(this.keysToWatch,e[t]);this.onStateUpdate()},onStateUpdate:function(){var t,e,i,o,a=!1,n=this.el;if(n.parentNode){if(this.isNamespacedBind&&r.clearObject(this.updateObj),i=this.system.state,s(this.data)!==c){try{o=r.select(i,this.data)}catch(t){throw new Error("[aframe-state-component] Key '"+this.data+"' not found in state. #"+this.el.getAttribute("id")+"["+this.attrName+"]")}if((void 0===o?"undefined":s(o))!==c&&s(this.lastData)!==c&&this.lastData===o)return;return AFRAME.utils.entity.setComponentProperty(n,this.id,o),void(this.lastData=o)}for(t in this.data){e=this.data[t].trim();try{o=r.select(i,e)}catch(t){throw console.log(t),new Error("[aframe-state-component] Key '"+e+"' not found in state. #"+this.el.getAttribute("id")+"["+this.attrName+"]")}if((void 0===o?"undefined":s(o))===c||s(this.lastData[t])===c||this.lastData[t]!==o){if(t in AFRAME.components&&void 0===o)return void n.removeAttribute(t);this.isNamespacedBind?this.updateObj[t]=o:AFRAME.utils.entity.setComponentProperty(n,t,o),this.lastData[t]=o}}for(a in this.updateObj);this.isNamespacedBind&&a&&n.setAttribute(this.id,this.updateObj)}},remove:function(){this.system.unsubscribe(this)}}),AFRAME.registerComponent("bind-toggle",{schema:{type:"string"},multiple:!0,init:function(){this.system=this.el.sceneEl.systems.state,this.keysToWatch=[],this.onStateUpdate=this.onStateUpdate.bind(this),this.system.subscribe(this),this.onStateUpdate()},update:function(){this.keysToWatch.length=0,r.parseKeysToWatch(this.keysToWatch,this.data)},onStateUpdate:function(){var t,e,i=this.el;t=this.system.state;try{e=r.select(t,this.data)}catch(t){throw new Error("[aframe-state-component] Key '"+this.data+"' not found in state. #"+this.el.getAttribute("id")+"["+this.attrName+"]")}e?i.setAttribute(this.id,""):i.removeAttribute(this.id)},remove:function(){this.system.unsubscribe(this)}}),t.exports={composeFunctions:r.composeFunctions,composeHandlers:r.composeHandlers,select:r.select}},function(t,e,i){"use strict";var s,o,a=i(0);AFRAME.registerComponent("bind-for",{schema:{delay:{default:0},for:{type:"string",default:"item"},in:{type:"string"},key:{type:"string"},pool:{default:0},template:{type:"string"},updateInPlace:{default:!1}},init:function(){this.system=this.el.sceneEl.systems.state,this.onStateUpdate=this.onStateUpdate.bind(this),this.keysToWatch=[],this.renderedKeys=[],this.system.subscribe(this),this.el.children[0]&&"TEMPLATE"===this.el.children[0].tagName?this.template=this.el.children[0].innerHTML.trim():this.template=document.querySelector(this.data.template).innerHTML.trim();for(var t=0;t<this.data.pool;t++)this.el.appendChild(this.generateFromTemplate(null,t))},update:function(){this.keysToWatch[0]=a.split(this.data.in,".")[0],this.onStateUpdate()},onStateUpdateNaive:(o=[],function(){var t,e=this.data,i=this.el;try{t=a.select(this.system.state,e.in)}catch(t){throw new Error("[aframe-state-component] Key '"+e.in+"' not found in state. #"+i.getAttribute("id")+"["+this.attrName+"]")}o.length=0;for(var s=0;s<t.length;s++){var n=t[s];o.push(e.key?n[e.key].toString():n.toString())}for(var r=this.getElsToRemove(o,this.renderedKeys),h=0;h<r.length;h++)r[h].parentNode.removeChild(r[h]);t.length&&this.renderItems(t,o,0)}),renderItems:function(t,e,i){var s,o=this,a=this.data,n=this.el,r=t[i],h=a.key?r[a.key].toString():r.toString();if(-1===this.renderedKeys.indexOf(h))s=this.generateFromTemplate(r,i),n.appendChild(s),this.renderedKeys.push(h);else{if(t.length&&t[0].constructor===String){var l=a.key?r[a.key].toString():r.toString();(s=n.querySelector('[data-bind-for-value="'+l+'"]')).setAttribute("data-bind-for-key",i)}else{var c=this.getBindForKey(r,i);s=n.querySelector('[data-bind-for-key="'+c+'"]')}s.emit("bindforupdate",r,!1)}t[i+1]&&(this.data.delay?setTimeout((function(){o.renderItems(t,e,i+1)}),this.data.delay):this.renderItems(t,e,i+1))},onStateUpdateInPlace:function(){var t=[];return function(){var e,i,s=this.data,o=this.el;try{e=a.select(this.system.state,s.in)}catch(t){throw console.log(t),new Error("[aframe-state-component] Key '"+s.in+"' not found in state. #"+o.getAttribute("id")+"["+this.attrName+"]")}t.length=0;for(var n=0;n<e.length;n++){var r=e[n];i=s.key?r[s.key].toString():r.toString(),t.push(i)}for(var h=this.getElsToRemove(t,this.renderedKeys),l=0;l<h.length;l++)h[l].object3D.visible=!1,h[l].setAttribute("data-bind-for-active","false"),h[l].removeAttribute("data-bind-for-key"),h[l].removeAttribute("data-bind-for-value"),h[l].emit("bindfordeactivate",null,!1),h[l].pause();e.length&&this.renderItemsInPlace(e,t,0)}}(),renderItemsInPlace:function(t,e,i){var s,o=this,a=this.data,n=this.el,r=t[i],h=this.getBindForKey(r,i),l=a.key?r[a.key].toString():r.toString();if(-1===this.renderedKeys.indexOf(l)){if(n.querySelector(':scope > [data-bind-for-active="false"]'))(s=n.querySelector('[data-bind-for-active="false"]')).setAttribute("data-bind-for-key",h),s.setAttribute("data-bind-for-value",l),s.object3D.visible=!0,s.play(),s.setAttribute("data-bind-for-active","true"),s.emit("bindforupdateinplace",r,!1);else{var c=this.generateFromTemplate(r,i);c.addEventListener("loaded",(function(){c.emit("bindforupdateinplace",r,!1)})),n.appendChild(c)}this.renderedKeys.push(l)}else-1!==e.indexOf(l)&&(t.length&&t[0].constructor===String?(s=n.querySelector('[data-bind-for-value="'+l+'"]')).setAttribute("data-bind-for-key",i):s=n.querySelector('[data-bind-for-key="'+h+'"]'),s.emit("bindforupdateinplace",r,!1));t[i+1]&&(this.data.delay?setTimeout((function(){o.renderItemsInPlace(t,e,i+1)}),this.data.delay):this.renderItemsInPlace(t,e,i+1))},generateFromTemplate:function(t,e){var i=this.data;this.el.appendChild(this.system.renderTemplate(this.template,t));var s=this.el.children[this.el.children.length-1];if(!t)return s.setAttribute("data-bind-for-key",""),s.setAttribute("data-bind-for-active","false"),s;var o=this.getBindForKey(t,e);return s.setAttribute("data-bind-for-key",o),i.key||s.setAttribute("data-bind-for-value",t),s.setAttribute("data-bind-for-active","true"),s},getElsToRemove:(s=[],function(t,e){var i=this.data,o=this.el;s.length=0;for(var a=0;a<o.children.length;a++)if("TEMPLATE"!==o.children[a].tagName){var n=i.key?o.children[a].getAttribute("data-bind-for-key"):o.children[a].getAttribute("data-bind-for-value");-1===t.indexOf(n)&&-1!==e.indexOf(n)&&(s.push(o.children[a]),e.splice(e.indexOf(n),1))}return s}),getBindForKey:function(t,e){return this.data.key?t[this.data.key].toString():e.toString()},onStateUpdate:function(){this.data.updateInPlace?this.onStateUpdateInPlace():this.onStateUpdateNaive()},remove:function(){this.el.sceneEl.systems.state.unsubscribe(this)}}),AFRAME.registerComponent("bind-item",{schema:{type:"string"},multiple:!0,init:function(){this.itemData=null,this.keysToWatch=[],this.prevValues={};var t=this.rootEl=this.el.closest("[data-bind-for-key]");if(!t)throw new Error("bind-item component must be attached to entity under a bind-for item.");t.addEventListener("bindforupdateinplace",this.updateInPlace.bind(this)),t.addEventListener("bindfordeactivate",this.deactivate.bind(this)),this.el.sceneEl.systems.state.subscribe(this)},update:function(){this.parseSelector()},updateInPlace:function(t){var e=this.propertyMap;if("false"!==this.rootEl.getAttribute("data-bind-for-active"))for(var i in t&&(this.itemData=t.detail),e){var s=this.select(this.itemData,e[i]);s!==this.prevValues[i]&&(AFRAME.utils.entity.setComponentProperty(this.el,i,s),this.prevValues[i]=s)}},onStateUpdate:function(){this.updateInPlace()},select:function(t,e){return a.select(this.el.sceneEl.systems.state.state,e,t)},deactivate:function(){this.prevValues={}},parseSelector:function(){var t=this.propertyMap={};this.keysToWatch.length=0;var e=a.split(this.id,"__")[0];if(!(e in AFRAME.components)||AFRAME.components[e].isSingleProp)t[this.id]=this.data,a.parseKeysToWatch(this.keysToWatch,this.data,!0);else for(var i=a.split(this.data,";"),s=0;s<i.length;s++){var o=a.split(i[s],":");t[this.id+"."+o[0].trim()]=o[1].trim(),a.parseKeysToWatch(this.keysToWatch,o[1].trim(),!0)}},remove:function(){this.el.sceneEl.systems.state.unsubscribe(this)}})},function(t,e,i){"use strict";var s;t.exports=(s=[],function(t,e,i,o){var a,n,r,h,l,c,d;for(l in h=i||{},s.length=0,t)s.push(l);if(!e)return h;for(r in e)-1===s.indexOf(r)&&s.push(r);for(c=0;c<s.length;c++)l=s[c],o&&-1!==o.indexOf(l)||(a=t[l],n=e[l],((d=a&&n&&a.constructor===Object&&n.constructor===Object)&&!AFRAME.utils.deepEqual(a,n)||!d&&a!==n)&&(h[l]=n));return h})},function(t,e,i){"use strict";var s=["push","pop","shift","unshift","splice"];function o(t,e){var i=t[e];t[e]=function(){i.apply(t,arguments),t.__dirty=!0}}t.exports.wrapArray=function(t){var e;if(!t.__wrapped){for(e=0;e<s.length;e++)o(t,s[e]);t.__wrapped=!0}}}])}))},{}],5:[function(t,e,i){var s,o;s=this,o=function(t){function e(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,i(t,e)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var s=function(t){function i(e){var i;return(i=t.call(this)||this).element=e||document.createElement("div"),i.element.style.position="absolute",i.element.style.pointerEvents="auto",i.addEventListener("removed",(function(){this.traverse((function(t){t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))})),i}return e(i,t),i.prototype.copy=function(e,i){return t.prototype.copy.call(this,e,i),this.element=e.element.cloneNode(!0),this},i}(THREE.Object3D);s.prototype.isCSS3DObject=!0,function(t){function i(e){var i;return(i=t.call(this,e)||this).rotation2D=0,i}return e(i,t),i.prototype.copy=function(e,i){return t.prototype.copy.call(this,e,i),this.rotation2D=e.rotation2D,this},i}(s).prototype.isCSS3DSprite=!0;var o=new THREE.Matrix4,a=new THREE.Matrix4,n=function(){var t,e,i,s,n=this,r={camera:{fov:0,style:""},objects:new WeakMap},h=document.createElement("div");h.style.overflow="hidden",this.domElement=h;var l=document.createElement("div");function c(t){return Math.abs(t)<1e-10?0:t}function d(t){var e=t.elements;return"matrix3d("+c(e[0])+","+c(-e[1])+","+c(e[2])+","+c(e[3])+","+c(e[4])+","+c(-e[5])+","+c(e[6])+","+c(e[7])+","+c(e[8])+","+c(-e[9])+","+c(e[10])+","+c(e[11])+","+c(e[12])+","+c(-e[13])+","+c(e[14])+","+c(e[15])+")"}function u(t){var e=t.elements;return"translate(-50%,-50%)matrix3d("+c(e[0])+","+c(e[1])+","+c(e[2])+","+c(e[3])+","+c(-e[4])+","+c(-e[5])+","+c(-e[6])+","+c(-e[7])+","+c(e[8])+","+c(e[9])+","+c(e[10])+","+c(e[11])+","+c(e[12])+","+c(e[13])+","+c(e[14])+","+c(e[15])+")"}function p(t,e,i,s){if(t.isCSS3DObject){var h;t.onBeforeRender(n,e,i),t.isCSS3DSprite?(o.copy(i.matrixWorldInverse),o.transpose(),0!==t.rotation2D&&o.multiply(a.makeRotationZ(t.rotation2D)),o.copyPosition(t.matrixWorld),o.scale(t.scale),o.elements[3]=0,o.elements[7]=0,o.elements[11]=0,o.elements[15]=1,h=u(o)):h=u(t.matrixWorld);var c=t.element,d=r.objects.get(t);void 0!==d&&d.style===h||(c.style.transform=h,r.objects.set(t,{style:h})),c.style.display=t.visible?"":"none",c.parentNode!==l&&l.appendChild(c),t.onAfterRender(n,e,i)}for(var m=0,b=t.children.length;m<b;m++)p(t.children[m],e,i)}l.style.transformStyle="preserve-3d",l.style.pointerEvents="none",h.appendChild(l),this.getSize=function(){return{width:t,height:e}},this.render=function(t,e){var o,a,n=e.projectionMatrix.elements[5]*s;r.camera.fov!==n&&(h.style.perspective=e.isPerspectiveCamera?n+"px":"",r.camera.fov=n),!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),e.isOrthographicCamera&&(o=-(e.right+e.left)/2,a=(e.top+e.bottom)/2);var u=(e.isOrthographicCamera?"scale("+n+")translate("+c(o)+"px,"+c(a)+"px)"+d(e.matrixWorldInverse):"translateZ("+n+"px)"+d(e.matrixWorldInverse))+"translate("+i+"px,"+s+"px)";r.camera.style!==u&&(l.style.transform=u,r.camera.style=u),p(t,t,e)},this.setSize=function(o,a){i=(t=o)/2,s=(e=a)/2,h.style.width=o+"px",h.style.height=a+"px",l.style.width=o+"px",l.style.height=a+"px"}},r=100,h=function(){function t(t,e){this.websurfaceEntity=e,this.enabled=!0,this.cssRenderer=new n,this.domElement=this.cssRenderer.domElement,this.domElement.style.position="fixed",this.domElement.style.zIndex="-2",this.cssCamera=new THREE.PerspectiveCamera(t.fov,t.aspect,t.near*r,t.far*r),this.camera=t,this.cssScene=new THREE.Scene,this.update=this.update.bind(this)}var e=t.prototype;return e.setSize=function(t,e){this.cssRenderer.setSize(t,e),this.cssCamera.aspect=t/e,this.cssCamera.updateProjectionMatrix()},e.update=function(){this.camera.getWorldPosition(this.cssCamera.position),this.cssCamera.position.multiplyScalar(r),this.camera.getWorldQuaternion(this.cssCamera.quaternion),this.cssRenderer.render(this.cssScene,this.cssCamera)},t}(),l=function(t){function i(e,i,o,a,n){var h,l=(void 0===n?{}:n).elementWidth,c=void 0===l?1280:l,d=new THREE.PlaneGeometry(o,a),u=new THREE.MeshBasicMaterial({opacity:0,blending:THREE.NoBlending,side:THREE.DoubleSide,color:new THREE.Color(0,0,0)});return(h=t.call(this,d,u)||this).context=e,h.domElement=i,h.aspectRatio=a/o,h.elementWidth=c,h.elementHeight=h.elementWidth*h.aspectRatio,h.width=o,h.height=a,h.resizeElement(),h.cssObject=new s(h.domElement),h.cssObject.scale.multiplyScalar(r/(h.elementWidth/h.width)),h.cssObjectInitialScale=h.cssObject.scale,h.size=new THREE.Vector3,h.box=new THREE.Box3,h.addEventListener("added",h.handleAdded),h.addEventListener("removed",h.handleRemoved),h.update=h.update.bind(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(h)),h}e(i,t);var o=i.prototype;return o.handleAdded=function(){this.context.cssScene.add(this.cssObject)},o.handleRemoved=function(){this.context.cssScene.remove(this.cssObject)},o.resizeElement=function(){this.domElement.style.width=this.elementWidth+"px",this.domElement.style.height=this.elementHeight+"px"},o.setElement=function(t){this.domElement.parentNode&&this.domElement.parentNode.removeChild(this.domElement),this.domElement=t,this.cssObject.element=t,this.resizeElement()},o.update=function(t){this.cssObject.quaternion.copy(t.quaternion),this.cssObject.position.copy(t.position).multiplyScalar(r),this.box.setFromObject(this).getSize(this.size);var e=t.scale;this.oldScaleFactor!=e&&(this.oldScaleFactor=e,this.cssObject.scale.set(this.cssObjectInitialScale.x,this.cssObjectInitialScale.y,this.cssObjectInitialScale.z),this.cssObject.scale.multiply(e)),this.cssObject.visible=t.visible},o.dispose=function(){this.removeEventListener("added",this.handleAdded),this.removeEventListener("removed",this.handleRemoved),this.domElement.remove(),this.geometry.dispose(),this.material.dispose()},i}(THREE.Mesh),c=AFRAME.registerComponent("websurface",{schema:{url:{default:"https://aframe.io"},width:{default:1},height:{default:.75},isInteractable:{default:!0},frameSkips:{default:1},autoSceneStyling:{default:!0}},init:function(){var t=this.el,e=this.data;1==e.autoSceneStyling&&(t.sceneEl.style.position="absolute",t.sceneEl.style.zIndex="1"),1==e.isInteractable&&(e.mouseHasLeftScreen=!0,t.setAttribute("geometry","primitive:plane; width:"+e.width+"; height:"+e.height+";"),t.addEventListener("click",(function(){0!=e.mouseHasLeftScreen&&(document.exitPointerLock(),t.sceneEl.style.zIndex="-1",e.mouseHasLeftScreen=!1)})),t.addEventListener("mouseenter",(function(){e.context.domElement.style.zIndex="0"})),t.addEventListener("mouseleave",(function(){e.context.domElement.style.zIndex="-2",e.mouseHasLeftScreen=!0}))),t.addEventListener("cam-loaded",(function(){var i=document.createElement("iframe");i.setAttribute("src",e.url),i.style.border="none";var s=new h(t.sceneEl.camera,t);s.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(s.domElement);var o=new l(s,i,e.width,e.height);if(t.object3D.add(o),1==e.isInteractable){var a=document.createElement("div");a.style.position="fixed",a.style.top="0",a.style.width="100%",a.style.height="100%",a.style.zIndex="-1",s.domElement.appendChild(a),a.addEventListener("click",(function(){t.sceneEl.style.zIndex=1}))}this.websurface_iframe=i,this.css3d_context=s,e.context=s,e.element=o,window.addEventListener("resize",(function(){s.setSize(window.innerWidth,window.innerHeight)}))})),e.frames=0,e.isCamLoaded=!1},tick:function(){var t=this.el,e=this.data;if(1!=e.isPaused)if(0!=e.isCamLoaded){var i=e.context,s=e.element;e.frames%e.frameSkips==0&&(i&&i.update(),s&&s.update(t.object3D)),e.frames++}else t.sceneEl.camera&&(this.el.emit("cam-loaded"),e.isCamLoaded=!0)},pause:function(){this.data.isPaused=!0},play:function(){this.data.isPaused=!1}});t.component=c},"object"==typeof i&&void 0!==e?o(i):"function"==typeof define&&define.amd?define(["exports"],o):o((s||self).aframeWebsurfaces={})},{}],6:[function(t,e,i){AFRAME.registerComponent("arealight",{schema:{width:{type:"number"},height:{type:"number"},scale:{type:"vec3"},intensity:{type:"number",default:30},color:{type:"color",default:"#ffffff"},rotation:{type:"vec3",default:{x:0,y:360,z:0}},showHelper:{type:"boolean",default:!1}},init:function(){var t,e,i,s=this.data;i=this.el.object3D.scale,t=this.el.getAttribute("geometry").height*i.y,e=this.el.getAttribute("geometry").radius*i.y*2;var o=new THREE.RectAreaLight(s.color,s.intensity,e,t);if(o.position.set(e*i.x/2,0,0),o.rotation.set(s.rotation.x,s.rotation.y,s.rotation.z),this.el.setObject3D("area-light",o),s.showHelper){var a=new THREE.RectAreaLightHelper(o);a.update(),this.el.setObject3D("area-light-helper",a)}}});var s=AFRAME.ANIME;AFRAME.registerComponent("animatefluo",{dependencies:["material","sound__hum","animation","area-light"],update:function(){this.el.components.sound__hum.playSound(),this.light={emissiveIntensity:0,areaLightIntensity:0,opacity:this.el.components.material.material.opacity,volume:0},this.animeUpdateHandler=function(){this.el.components.material.material.emissiveIntensity=this.light.emissiveIntensity,this.el.getObject3D("area-light").intensity=10*this.light.emissiveIntensity,this.el.components.material.material.opacity=this.light.opacity,this.el.setAttribute("sound__hum","volume",this.light.volume)}.bind(this),this.animationtest=s({targets:this.light,emissiveIntensity:1.5,areaLightIntensity:10,opacity:1,volume:.1,duration:1e4,elasticity:1e3,delay:function(){return 5e3+s.random(-250,250)},loop:!0,autoplay:!0,update:this.animeUpdateHandler}),this.animationIsPlaying=!0,this.time=0},tick:function(t,e){}})},{}],7:[function(t,e,i){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("classeroomdeskchair",{schema:{row:{type:"int",default:6},column:{type:"int",default:5},widthc:{type:"int",default:8},depthc:{type:"int",default:8},scrid:{default:"#desk1"}},init:function(){var t=this.data,e=t.widthc/t.column,i=t.depthc/t.row;console.log(e),console.log(i);for(var s=this.el,o=0,a=[],n=0,r=0;r<t.column;r+=1){for(var h=0,l=0;l<t.row;l+=1){var c=n+" 0 "+(h=h+i);d(c,t.scrid),a[o]=c,o+=1}n=n+e}function d(t,e){var i=document.createElement("a-gltf-model");i.setAttribute("src",e),i.setAttribute("position",t),i.setAttribute("scale","0.5 0.5 0.5"),i.setAttribute("rotation","0 90 0"),i.setAttribute("shadow","receive:true"),i.setAttribute("body","type:dynamic"),s.appendChild(i)}console.log(a)}})},{}],8:[function(t,e,s){AFRAME.registerComponent("grabbing",{schema:{hideOnGrab:{type:"boolean",default:!1},grabDistance:{type:"number",default:1},attractHand:{type:"boolean",default:!0},avoidWalls:{type:"boolean",default:!0}},init(){this._enableHands=this._enableHands.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onWheel=this._onWheel.bind(this),this._onButtonChanged=this._onButtonChanged.bind(this),this._onTouchTap=this._onTouchTap.bind(this),this._onTouchHold=this._onTouchHold.bind(this),this._btnPress={},this._btnFlex={},this._keysDown={},this._grabCount=0,this._gamepadBtns=[],this._hands=["head","left","right"],this._head={},this._left={},this._right={},this._head.hand=this.el.querySelector("a-camera"),this._left.hand=this.el.querySelector('a-hand[side="left"]'),this._right.hand=this.el.querySelector('a-hand[side="right"]'),this._head.glove=this._head.hand.ensure(".hitbox","a-sphere",{class:"hitbox",body:"type:kinematic;",radius:.25}),this._left.glove=this._left.hand.ensure("a-glove"),this._right.glove=this._right.hand.ensure("a-glove"),this._left.glove.setAttribute("visible",!1),this._right.glove.setAttribute("visible",!1);for(let t of this._hands){this["_"+t].hand.addEventListener("buttonchanged",this._enableHands)}this._head.ray=this._head.hand.ensure(".grabbing-ray","a-entity",{class:"grabbing-ray",raycaster:{deep:!0,objects:"[wall], [grabbable]",autoRefresh:!1}}),this._head.buttonRay=this._head.hand.ensure(".button.ray","a-entity",{class:"button ray",raycaster:{deep:!0,objects:"[wall], [button], [gui-interactable]",far:1,autoRefresh:!1}}),this._head.reticle=this._head.hand.ensure(".reticle","a-plane",{class:"reticle",material:"transparent:true; shader:flat;",position:"0 0 -0.0078125",scale:"0.00048828125 0.00048828125 0.00048828125"}),this._head.anchor=this._head.ray.ensure(".grabbing.anchor","a-entity",{class:"grabbing anchor",visible:!1,body:"type:kinematic;autoShape:false;"})},update(t){for(let t of this._hands){let e="_"+t;this[e].ray&&this[e].ray.setAttribute("raycaster","far",this.data.grabDistance+("head"===t?1:.1875))}},play(){document.addEventListener("keydown",this._onKeyDown),document.addEventListener("keyup",this._onKeyUp),this.el.sceneEl.canvas.addEventListener("mousedown",this._onMouseDown),this.el.sceneEl.canvas.addEventListener("mouseup",this._onMouseUp),this.el.sceneEl.canvas.addEventListener("wheel",this._onWheel);for(let t of[this._left.hand,this._right.hand])t.addEventListener("buttonchanged",this._onButtonChanged);this.el.sceneEl.canvas.addEventListener("tap",this._onTouchTap),this.el.sceneEl.canvas.addEventListener("hold",this._onTouchHold)},pause(){document.removeEventListener("keydown",this._onKeyDown),document.removeEventListener("keyup",this._onKeyUp),this.el.sceneEl.canvas.removeEventListener("mousedown",this._onMouseDown),this.el.sceneEl.canvas.removeEventListener("mouseup",this._onMouseUp),this.el.sceneEl.canvas.removeEventListener("wheel",this._onWheel);for(let t of[this._left.hand,this._right.hand])t.removeEventListener("buttonchanged",this._onButtonChanged);this.el.sceneEl.canvas.removeEventListener("tap",this._onTouchTap),this.el.sceneEl.canvas.removeEventListener("hold",this._onTouchHold)},remove(){for(let t of this._hands){let e="_"+t;this.drop(t),this[e].glove.copyWorldPosRot(this[e].hand);let i=.25;for(let s=0;s<5;s++)this.emit("fingerflex",this[e].glove,this[e].grabbed,{hand:t,finger:s,flex:i})}},tick(t,e){for(let t=0;t<16;t++)this._gamepadBtns[t]=0;for(i=0,len=navigator.getGamepads().length;i<len;i++)if(gamepad=navigator.getGamepads()[i],gamepad)for(let t=0;t<16;t++)this._gamepadBtns[t]+=gamepad.buttons[t]?.pressed||0;for(!this._gamepadBtns[4]&&!this._gamepadBtns[5]||this._grabBtn||(this._setDevice("gamepad"),console.log("grabbing!",this._gamepadBtns[4],this._gamepadBtns[5],this._grabBtn),this.grab()),!this._grabBtn||this._gamepadBtns[4]||this._gamepadBtns[5]||(console.log("dropping!",this._gamepadBtns[4],this._gamepadBtns[5],this._grabBtn),this.drop()),!this._gamepadBtns[6]&&!this._gamepadBtns[7]||this._useBtn0||this.useDown(),this._gamepadBtns[0]&&!this._useBtn1&&this.useDown("head",1),this._gamepadBtns[1]&&!this._useBtn2&&this.useDown("head",2),this._gamepadBtns[2]?(this._gamepadBtns[12]&&this.moveHeadHand(0,-.03125),this._gamepadBtns[13]&&this.moveHeadHand(0,.03125),this._gamepadBtns[14]&&this.moveHeadHand(0,0,-.03125),this._gamepadBtns[15]&&this.moveHeadHand(0,0,.03125)):(this._gamepadBtns[12]&&this.moveHeadHand(-.03125),this._gamepadBtns[13]&&this.moveHeadHand(.03125),this._gamepadBtns[14]&&this.moveHeadHand(0,0,0,.03125),this._gamepadBtns[15]&&this.moveHeadHand(0,0,0,-.03125)),this._grabBtn=!1,this._useBtn0=!1,this._useBtn1=!1,this._useBtn2=!1,i=0,len=navigator.getGamepads().length;i<len;i++)gamepad=navigator.getGamepads()[i],gamepad&&(this._grabBtn=this._grabBtn||this._gamepadBtns[4]||this._gamepadBtns[5],this._useBtn0=this._useBtn0||this._gamepadBtns[6]||this._gamepadBtns[7],this._useBtn1=this._useBtn1||this._gamepadBtns[0],this._useBtn2=this._useBtn2||this._gamepadBtns[1]);let s=THREE.Vector3.temp(),o=THREE.Vector3.temp(),a=THREE.Vector3.temp();s.copy(this._head.hand.object3D.position),this._head.hand.object3D.parent.localToWorld(s);for(let t of this._hands){let i="_"+t;if(this.data.avoidWalls&&this[i]._occlusionRay){let t=this[i].glove.querySelector(".palm")||this[i].glove;this[i].glove.copyWorldPosRot(this[i].hand),this[i]._occlusionRay.object3D.position.copy(s),t.object3D.getWorldPosition(o),this[i].glove.object3D.getWorldPosition(a),a.sub(o),o.sub(s);let e=o.length();o.normalize(),this[i]._occlusionRay.setAttribute("raycaster","direction",`${o.x} ${o.y} ${o.z}`),this[i]._occlusionRay.setAttribute("raycaster","far",e+.03125);let n=this[i]._occlusionRay.components.raycaster;n.refreshObjects();let r=n.intersections[0];if(r){let t=o.copy(r.point).sub(s).length();this[i].glove.object3D.position.copy(s).add(a).add(o.normalize().multiplyScalar(t-.03125)),this[i].glove.object3D.parent.worldToLocal(this[i].glove.object3D.position)}}let n="default";if(this[i].grabbed){let e=this[i].ray.components.raycaster;if(e.refreshObjects(),!this[i].grabbed.components.grabbable?.data.immovable){if(this[i].grabbed.components.grabbable?.data.avoidWalls)for(let t of e.intersections)t&&t.el.components.wall&&t.distance<-this[i].anchor.object3D.position.z&&this[i].anchor.object3D.position.multiplyScalar(.5);let s=THREE.Vector3.temp().copy(this[i].grabbed.object3D.position);this[i].grabbed.copyWorldPosRot(this[i].anchor),s.sub(this[i].grabbed.object3D.position),s.length()>1&&this.drop(t)}this[i].reticle&&this._setReticle(null)}else{if(this[i].ray){let e=this[i].ray.components.raycaster;e.refreshObjects();let s=e.intersections[0];s&&s.el.components.grabbable?(this[i]._lastHit!==s.el&&(this[i]._lastHit&&this.emit("unreachable",this[i].glove,this[i]._lastHit),this[i]._lastHit=s.el,this.emit("reachable",this[i].glove,this[i]._lastHit),this._flexFinger(t,5,-.125,!0),this._flexFinger(t,0,0,!0)),this[i].reticle&&(n="grab")):(this[i]._lastHit&&(this.emit("unreachable",this[i].glove,this[i]._lastHit),this._restoreUserFlex(t)),this[i]._lastHit=null)}if(this[i].buttonRay){let e=this[i].buttonRay.components.raycaster;e.refreshObjects();let s=e.intersections[0];s&&null!=s.el.components.button?(this[i]._lastButton!==s.el&&(this[i]._lastButton&&this.emit("unhover",this[i].glove,this[i]._lastButton),this[i]._lastButton=s.el,this.emit("hover",this[i].glove,this[i]._lastButton),this._flexFinger(t,7,1,!0),this._flexFinger(t,1,-.125,!0)),s.distance<.125?this[i]._lastPress!==s.el&&(this[i]._lastPress&&(this.emit("unpress",this[i].glove,this[i]._lastPress),this[i]._lastPress.removeState("pressed")),this[i]._lastPress=s.el,this.emit("press",this[i].glove,this[i]._lastPress),this[i]._lastPress.addState("pressed")):(this[i]._lastPress&&(this.emit("unpress",this[i].glove,this[i]._lastPress),this[i]._lastPress.removeState("pressed")),this[i]._lastPress=null),this[i].reticle&&(n="push")):(this[i]._lastPress&&(this.emit("unpress",this[i].glove,this[i]._lastPress),this[i]._lastPress.removeState("pressed")),this[i]._lastPress=null,this[i]._lastButton&&(this.emit("unhover",this[i].glove,this[i]._lastButton),this._restoreUserFlex(t)),this[i]._lastButton=null)}this[i].reticle&&this._setReticle(n)}this[i].lastGlovePos=this[i].lastGlovePos||new THREE.Vector3,this[i].lastGrabbedPos=this[i].lastGrabbedPos||new THREE.Vector3,this[i].gloveVelocity=this[i].gloveVelocity||new THREE.Vector3,this[i].grabbedVelocity=this[i].grabbedVelocity||new THREE.Vector3;let r=THREE.Vector3.temp();this[i].glove&&(this[i].glove.object3D.localToWorld(r.set(0,0,0)),this[i].gloveVelocity.copy(r).sub(this[i].lastGlovePos).multiplyScalar(500/e),this[i].lastGlovePos.copy(r)),this[i].grabbed&&(this[i].grabbed.object3D.localToWorld(r.set(0,0,0)),this[i].grabbedVelocity.copy(r).sub(this[i].lastGrabbedPos).multiplyScalar(500/e),this[i].lastGrabbedPos.copy(r)),"head"===t&&this[i].gloveVelocity.copy(this[i].grabbedVelocity)}this.el.object3D.updateWorldMatrix(!0,!0)},toggleGrab(t="head"){this["_"+t].grabbed?this.drop(t):this.grab(t)},showpannel(){},grab(t="head"){let e="_"+t;if(!this[e].ray)return;if(this[e].grabbed)return;let i=this[e].ray.components.raycaster;i.refreshObjects();let s=i.intersections[0];if(s&&s.el.components.grabbable){"head"===t&&this.data.attractHand&&this[e].ray.setAttribute("animation__pos",{property:"position",to:{x:0,y:-.125,z:0},dur:256}),this.dropObject(s.el),this[e].grabbed=s.el,this[e].anchor.copyWorldPosRot(this[e].grabbed),this[e].anchor.components.body.commit(),null!=this[e].grabbed.components.body?(this[e].grabbed.components.grabbable?.data.immovable||this[e].anchor.setAttribute("joint__grab",{body2:this[e].grabbed,type:"lock"}),this[e].isPhysical=!0):this[e].isPhysical=!1,this[e].anchor.removeAttribute("animation__pos"),this[e].anchor.removeAttribute("animation__rot");let i=s.distance;if(i-="head"===t?.5:.09375,this[e].grabbed.components.grabbable.data.fixed){let i=THREE.Vector3.temp().copy(this[e].grabbed.components.grabbable.data.fixedPosition);"left"===t&&(i.x*=-1),"head"===t&&(i.x=0);let s=THREE.Quaternion.temp().copy(this[e].ray.object3D.quaternion).conjugate();i.applyQuaternion(s),i.z+=-.09375,this[e].anchor.setAttribute("animation__pos",{property:"position",to:{x:i.x,y:i.y,z:i.z},dur:256});let o={x:0,y:0,z:0};"left"===t&&(o.y=45),"right"===t&&(o.y=-45),this[e].anchor.setAttribute("animation__rot",{property:"rotation",to:o,dur:256})}else this.data.attractHand&&!this[e].grabbed.components.grabbable?.data.immovable&&this[e].anchor.setAttribute("animation__pos",{property:"object3D.position.z",to:this[e].anchor.object3D.position.z+i,dur:256});(this.data.hideOnGrab||this[e].grabbed.components.grabbable.data.hideOnGrab)&&this[e].glove.setAttribute("visible",!1),this[e].glove.setAttribute("body","collidesWith",0),this.emit("grab",this[e].glove,this[e].grabbed,{intersection:s}),this._grabCount=Math.min(2,this._grabCount+1),this.el.addState("grabbing"),this[e].grabbed.addState("grabbed"),this.sticky=!0,console.log(this[e].grabbed+"is grabbe"),this._flexFinger(t,5,0,!0),setTimeout((()=>{let i=this[e].grabbed.components.grabbable.data.fingerFlex.map((t=>parseFloat(t)))||[.5];this._flexFinger(t,5,i.pop()||0,!0);let s=0;for(let e of i)this._flexFinger(t,s++,e||0,!0);this.sticky=!1}),256)}},drop(t="head"){let e="_"+t;this.sticky||(this[e].anchor.removeAttribute("animation__rot"),this[e].anchor.removeAttribute("animation__pos"),this[e].glove.setAttribute("visible",!0),this[e].anchor.removeAttribute("joint__grab"),this[e].anchor.setAttribute("position","0 0 0"),this[e].anchor.setAttribute("rotation","0 0 0"),setTimeout((()=>{this[e].glove.setAttribute("body","collidesWith",1)}),1024),this[e].grabbed&&(this.emit("drop",this[e].glove,this[e].grabbed),this._grabCount=Math.max(0,this._grabCount-1),this._grabCount||this.el.removeState("grabbing"),this._restoreUserFlex(t),this[e].grabbed.removeState("grabbed"),this[e].grabbed.components.grabbable?.data.kinematicGrab&&!this[e].grabbed.components.grabbable?.data.immovable&&(this[e].grabbed.components.body?.applyWorldImpulse(this[e].gloveVelocity,this[e].lastGlovePos),this[e].grabbed.components.body?.applyWorldImpulse(this[e].grabbedVelocity,this[e].lastGrabbedPos)),this[e].grabbed=null,"head"===t&&(this[e].ray.removeAttribute("animation__pos"),this[e].ray.object3D.position.y=0)))},dropObject(t){for(let e of this._hands){this["_"+e].grabbed===t&&this.drop(e)}},use(t="head",e=0){this.useDown(t,e),setTimeout((()=>{this.useUp(t,e)}),32)},useDown(t="head",e=0){let i="_"+t;this[i].grabbed?(this._flexFinger(t,Math.max(0,1-e),.5,!0),this.emit("usedown",this[i].glove,this[i].grabbed,{button:e})):this[i]._lastButton?(this._flexFinger(t,0,.5,!0),this[i]._lastClick=this[i]._lastButton,this.emit("press",this[i].glove,this[i]._lastClick,{button:e}),this[i]._lastClick.addState("pressed")):this.emit("usedown",this[i].glove,this[i].grabbed,{button:e})},useUp(t="head",e=0){let i="_"+t;this[i].grabbed?(this._flexFinger(t,Math.max(0,1-e),0,!0),this.emit("useup",this[i].glove,this[i].grabbed,{button:e})):this[i]._lastClick?(this._flexFinger(t,0,0,!0),this.emit("unpress",this[i].glove,this[i]._lastClick),this[i]._lastClick.removeState("pressed"),this[i]._lastClick=null):this.emit("useup",this[i].glove,this[i].grabbed,{button:e})},moveHeadHand(t=0,e=0,i=0,s=0){this._head.anchor.object3D.position.z=Math.min(Math.max(-1.5,this._head.anchor.object3D.position.z+t),-.125);let o=THREE.Quaternion.temp().set(e,i,s,1).normalize();this._head.anchor.object3D.quaternion.premultiply(o)},emit(t,e,i,s={}){s.grabbing=this.el,s.grabbedElement=i,s.gloveElement=e;for(let t of this._hands)this["_"+t].glove===e&&(s.hand=t);e.emit(t,s,!0),i&&i.emit(t,s,!0)},_setReticle(t){if(!this._head.reticle)return;if(this._head._reticleMode===t)return;let e="data:image/gif;base64,R0lGODlhEAAQAPD/AAAAAP///yH5BAUKAAIALAAAAAAQABAAAAIVlI+py+0PIwQgghDqu9lqCYbiSBoFADs=";switch(t){case"grab":e="data:image/gif;base64,R0lGODlhEAAQAPD/AAAAAP///yH5BAUKAAIALAAAAAAQABAAAAI1lC8AyLkQgloMSotrVHsnhHWXdISS+DzRimIWy3Ii7CU0Tdn3mr93bvDBgMFfozg8OiaTQwEAOw==";break;case"push":e="data:image/gif;base64,R0lGODlhEAAQAPD/AAAAAP///yH5BAUKAAIALAAAAAAQABAAAAIylA1wywIRVGMvTgrlRTltl3Wao1RmB0YVxEYqu7ZwGstWbWdcPh94O0rZgjsZEZFIagoAOw=="}this._head.reticle.setAttribute("src",e),this._head._reticleMode=t},_enableHands(){this._setDevice("vrcontroller");for(let t of this._hands){let e="_"+t;this[e].hand.removeEventListener("buttonchanged",this._enableHands);let i=.0625;if(this[e].glove.ensure(".hitbox","a-box",{class:"hitbox",visible:!1,position:"0 0 0.03125",width:i/2,height:i,depth:2*i}),this[e].glove.setAttribute("body","type:kinematic;"),"head"===t)continue;this[e]._occlusionRay=this.el.sceneEl.ensure(".occlusion-ray."+t,"a-entity",{class:"occlusion-ray "+t,raycaster:{deep:!0,objects:"[wall]",autoRefresh:!1}});let s=this[e].glove.querySelector(".palm")||this[e].glove;this[e].ray=s.ensure(".grabbing.ray","a-entity",{class:"grabbing ray",position:"left"===t?"-0.0625 0 0.0625":"0.0625 0 0.0625",rotation:"left"===t?"0 -45 0":"0 45 0",raycaster:{deep:!0,objects:"[wall], [grabbable]",autoRefresh:!1}}),this[e].buttonRay=s.ensure(".button.ray","a-entity",{class:"button ray",position:"0 0.03125 0",raycaster:{deep:!0,objects:"[wall], [button], [gui-interactable]",far:.5,autoRefresh:!1}}),this[e].anchor=this[e].ray.ensure(".grabbing.anchor","a-entity",{class:"grabbing anchor",visible:"false",body:"type:kinematic;autoShape:false;"}),this[e].glove.setAttribute("visible",!0)}this._head.ray=null,this._head.buttonRay=null,this._head.reticle.setAttribute("position","0 0 1"),this._head.reticle.setAttribute("visible","false"),this._head.reticle=null,this.update()},_flexFinger(t,e,i,s=!1){let o="_"+t;if(this[o].userFlex=this[o].userFlex||[],s&&(this[o].priorityFlex=!0),e<5)!s&&this[o].priorityFlex||this.emit("fingerflex",this[o].glove,this[o].grabbed,{hand:t,finger:e,flex:i}),s||(this[o].userFlex[e]=i);else for(e-=5;e<5;e++)!s&&this[o].priorityFlex||this.emit("fingerflex",this[o].glove,this[o].grabbed,{hand:t,finger:e,flex:i}),s||(this[o].userFlex[e]=i)},_restoreUserFlex(t){let e="_"+t;this[e].userFlex=this[e].userFlex||[],this[e].priorityFlex=!1;for(let i=0;i<5;i++){let s=this[e].userFlex[i]||0;this.emit("fingerflex",this[e].glove,this[e].grabbed,{hand:t,finger:i,flex:s})}},_onKeyDown(t){"KeyE"!==t.code||this._keysDown[t.code]||(this._setDevice("desktop"),this.grab()),"KeyM"!==t.code||this._keysDown[t.code]||(this._setDevice("desktop"),this.shoepannel()),this._keysDown[t.code]=!0},_onKeyUp(t){"KeyE"===t.code&&this._keysDown[t.code]&&this.drop(),this._keysDown[t.code]=!1},_onMouseDown(t){this._setDevice("desktop");let e=t.button;this.useDown("head",e?e%2?e+1:e-1:e)},_onWheel(t){this._setDevice("desktop");let e=0,i=0,s=0;return this._keysDown.Digit3&&t.deltaY>0&&(s+=-.125),this._keysDown.Digit3&&t.deltaY<0&&(s+=.125),this._keysDown.Digit2&&t.deltaY>0&&(i+=-.125),this._keysDown.Digit2&&t.deltaY<0&&(i+=.125),this._keysDown.Digit1&&t.deltaY>0&&(e+=.125),this._keysDown.Digit1&&t.deltaY<0&&(e+=-.125),e||i||s?this.moveHeadHand(0,e,i,s):t.deltaY>0?this.moveHeadHand(.125):t.deltaY<0?this.moveHeadHand(-.125):void 0},_onMouseUp(t){let e=t.button;this.useUp("head",e?e%2?e+1:e-1:e)},_onTouchTap(t){this._setDevice("touch"),this.use()},_onTouchHold(t){this._setDevice("touch"),this.toggleGrab()},_onButtonChanged(t){this._setDevice("vrcontroller");let e=t.srcElement.getAttribute("tracked-controls").hand,i=-1,s=0;switch(t.detail.state.touched&&(s=.5),t.detail.state.pressed&&(s=1),t.detail.state.value&&(s=.5+t.detail.state.value/2),this._btnFlex[e+t.detail.id]=s,t.detail.id){case 0:i=1,t.detail.state.pressed&&!this._btnPress[e+t.detail.id]&&this.useDown(e),!t.detail.state.pressed&&this._btnPress[e+t.detail.id]&&this.useUp(e);break;case 1:s<=0||s>=1?(i=7,this._fist=s>.5):(this._flexFinger(e,2,this._fist?0:1),i=3),t.detail.state.pressed&&!this._btnPress[e+t.detail.id]&&this.grab(e),!t.detail.state.pressed&&this._btnPress[e+t.detail.id]&&this.drop(e);break;case 3:i=0,s=Math.max(this._btnFlex[e+3]||0,this._btnFlex[e+4]||0,this._btnFlex[e+5]||0);break;case 4:i=0,s=Math.max(this._btnFlex[e+3]||0,this._btnFlex[e+4]||0,this._btnFlex[e+5]||0),t.detail.state.pressed&&!this._btnPress[e+t.detail.id]&&this.useDown(e,1),!t.detail.state.pressed&&this._btnPress[e+t.detail.id]&&this.useUp(e,1);break;case 5:i=0,s=Math.max(this._btnFlex[e+3]||0,this._btnFlex[e+4]||0,this._btnFlex[e+5]||0),t.detail.state.pressed&&!this._btnPress[e+t.detail.id]&&this.useDown(e,2),!t.detail.state.pressed&&this._btnPress[e+t.detail.id]&&this.useUp(e,2)}this._btnPress[e+t.detail.id]=t.detail.state.pressed,this._flexFinger(e,i,s)},_setDevice(t){this.device!==t&&(this.el.removeState(this.device||"noinput"),this.device=t,this.el.addState(this.device||"noinput"))}}),t("./grabbing/button"),t("./grabbing/climbable"),t("./grabbing/fingerflex"),t("./grabbing/grabbable"),t("./grabbing/receptacle")},{"./grabbing/button":9,"./grabbing/climbable":10,"./grabbing/fingerflex":11,"./grabbing/grabbable":12,"./grabbing/receptacle":13}],9:[function(t,e,i){AFRAME.registerComponent("button",{schema:{}})},{}],10:[function(t,e,i){let s;AFRAME.registerComponent("climbable",{dependencies:["wall"],schema:{},init(){this.el.setAttribute("grabbable","physics:false; kinematicGrab:false; immovable:true;"),this._player=this.el.sceneEl.querySelector("[locomotion]"),this._localAnchor=new THREE.Vector3,this._onBump=this._onBump.bind(this)},play(){this._player.addEventListener("bump",this._onBump)},pause(){this._player.removeEventListener("bump",this._onBump),this._climbing=!1},tick(){if(!this._floating)return;if(this._player.components.locomotion.stopFall(),!this._climbing)return;let t=THREE.Vector3.temp().copy(this._localAnchor),e=THREE.Vector3.temp().set(0,0,0),i=THREE.Vector3.temp();this.el.object3D.localToWorld(t),this._hand.object3D.localToWorld(e),i.copy(t).sub(e).multiplyScalar(.5),this._player.components.locomotion.move(i)},events:{grab(t){s&&s!==this.el&&this._player.components.grabbing.dropObject(s),s=this.el,this._climbing=!0,this._floating=!0,this._handName=t.detail.hand,this._hand=t.detail.gloveElement.parentNode,this._localAnchor.copy(t.detail.intersection.point),this.el.object3D.worldToLocal(this._localAnchor),"head"===this._handName&&(this._hand=this._hand.querySelector(".anchor"),this._hand.object3D.position.set(0,0,-t.detail.intersection.distance)),this._player.components.locomotion.jump(),setTimeout((()=>{this.el.sceneEl.querySelector(".legs")?.object3D.position.copy(this._player.components.locomotion.headPos)})),clearTimeout(this._autoCrouchTO)},drop(t){this._climbing=!1,setTimeout((()=>{this.el.sceneEl.querySelector(".legs")?.object3D.position.copy(this._player.components.locomotion.headPos)})),clearTimeout(this._autoCrouchTO),this._autoCrouchTO=setTimeout((()=>{this._floating=!1,this._player.components.locomotion.toggleCrouch(!0)}),"head"===this._handName?1024:256),s=null}},_onBump(t){this._climbing=!1,clearTimeout(this._autoCrouchTO),this._autoCrouchTO=setTimeout((()=>{this._floating=!1}),1024),this._player.components.grabbing.dropObject(this.el)}})},{}],11:[function(t,e,i){AFRAME.registerComponent("fingerflex",{schema:{min:{type:"number",default:10},max:{type:"number",default:90}},init(){this._fingers=["thumb","index","middle","ring","little"],this._currentFlex=[0,0,0,0,0],this._targetFlex=[0,0,0,0,0]},tick(t,e){for(let t=0;t<5;t++){let e=this._fingers[t],i=this._currentFlex[t],s=this._targetFlex[t];i+=Math.random()*Math.random()*(s-i);let o=this.data.min+i*(this.data.max-this.data.min),a=this.el.querySelector(".bend."+e);for(;a;){let t=a.getAttribute("rotation");t.y=o,a.setAttribute("rotation",t),a=a.querySelector(".bend")}this._currentFlex[t]=i}},events:{fingerflex(t){this._targetFlex[t.detail.finger]=t.detail.flex}}})},{}],12:[function(t,e,i){AFRAME.registerComponent("grabbable",{schema:{physics:{type:"boolean",default:!0},kinematicGrab:{type:"boolean",default:!0},hideOnGrab:{type:"boolean",default:!1},fixed:{type:"boolean",default:!1},fixedPosition:{type:"vec3",default:{x:0,y:0,z:0}},fingerFlex:{type:"array",default:[.5]},immovable:{type:"boolean",default:!1},avoidWalls:{type:"boolean",default:!0}},init(){this.data.physics&&!this.el.components.body&&this.el.setAttribute("body","type:dynamic;")},events:{grab(t){"head"!==t.detail.hand&&(this._grabbed=t.detail,this._glove=t.detail.gloveElement,this._anchor=this._glove.querySelector(".anchor")),this.data.kinematicGrab&&this.el.setAttribute("body","type","kinematic")},drop(t){this._grabbed=!1,this.data.physics&&this.el.setAttribute("body","type","dynamic")},limited(t){if(this._grabbed){let t=THREE.Vector3.temp(),e=THREE.Quaternion.temp();this._glove.copyWorldPosRot(this.el);let i=this._anchor;for(;i!==this._glove;)e.copy(i.object3D.quaternion).conjugate(),this._glove.object3D.quaternion.multiply(e),i=i.parentNode;this._glove.object3D.updateWorldMatrix(!0,!0),t.copy(this._anchor.object3D.position),this._anchor.object3D.parent.localToWorld(t),this._glove.object3D.worldToLocal(t),this._glove.object3D.position.sub(t)}}}})},{}],13:[function(t,e,i){AFRAME.registerComponent("receptacle",{schema:{objects:{type:"string",default:"[grabbable]"},radius:{type:"number",default:.125},onlyGrabbed:{type:"boolean",default:!1},autoDrop:{type:"boolean",default:!1}},init(){this._anchor=this.el.ensure(".receptacle.anchor","a-entity",{class:"receptacle anchor",body:"type:kinematic;autoShape:false;"}),this._refreshTO=setInterval(this.refreshObjects.bind(this),1024)},remove(){clearInterval(this._refreshTO)},tick(){if(!this.nearest)return this.refreshObjects();let t=THREE.Vector3.temp(),e=THREE.Vector3.temp();this.el.object3D.localToWorld(t.set(0,0,0)),this.nearest.object3D.localToWorld(e.set(0,0,0)),e.sub(t),this._lastNearest&&this._lastNearest!==this.nearest?(this.el.is("occupied")&&(this._anchor.removeAttribute("joint__put"),this._anchor.removeAttribute("animation__pos"),this._anchor.removeAttribute("animation__rot"),this.el.removeState("occupied"),this._lastNearest.removeState("put"),this.el.emit("take",{grabbable:this._lastNearest}),this._lastNearest.emit("take",{receptacle:this.el})),this._hover&&(this.el.emit("unhover",{grabbable:this._lastNearest}),this._lastNearest.emit("unhover",{receptacle:this.el})),this._hover=!1,this._grabbed=!1):e.length()>this.data.radius?(this.el.is("occupied")&&(this._anchor.removeAttribute("joint__put"),this._anchor.removeAttribute("animation__pos"),this._anchor.removeAttribute("animation__rot"),this.el.removeState("occupied"),this.nearest.removeState("put"),this.el.emit("take",{grabbable:this.nearest}),this.nearest.emit("take",{receptacle:this.el})),this._hover&&(this.el.emit("unhover",{grabbable:this.nearest}),this.nearest.emit("unhover",{receptacle:this.el})),this._hover=!1,this._grabbed=!1):this.nearest.is("grabbed")||!this._hover?(this._hover||(this.el.emit("hover",{grabbable:this.nearest}),this.nearest.emit("hover",{receptacle:this.el}),this.data.autoDrop&&this._grabber&&this._grabber.dropObject(this.nearest)),this._anchor.removeAttribute("animation__pos"),this._anchor.removeAttribute("animation__rot"),this._anchor.copyWorldPosRot(this.nearest),this._hover=!0,this.nearest.is("grabbed")&&(this._grabbed=!0)):!this._grabbed&&this.data.onlyGrabbed||(this.el.is("occupied")||(this._anchor.copyWorldPosRot(this.nearest),this._anchor.components.body.commit(),this.nearest.components.body&&this._anchor.setAttribute("joint__put",{body2:this.nearest,type:"lock"}),this.el.addState("occupied"),this.nearest.addState("put"),this.el.emit("put",{grabbable:this.nearest}),this.nearest.emit("put",{receptacle:this.el})),this._anchor.getAttribute("animation__pos")||(this._anchor.setAttribute("animation__pos",{property:"position",to:{x:0,y:0,z:0},dur:256}),this._anchor.setAttribute("animation__rot",{property:"rotation",to:{x:0,y:0,z:0},dur:256})),this.nearest.copyWorldPosRot(this._anchor),this._hover=!0),this._lastNearest=this.nearest},refreshObjects(){let t=1/0,e=THREE.Vector3.temp(),i=THREE.Vector3.temp(),s=THREE.Vector3.temp(),o=this.el.sceneEl.querySelectorAll(this.data.objects);this.nearest=null,o&&(this.el.object3D.localToWorld(e.set(0,0,0)),o.forEach((o=>{o.object3D.localToWorld(i.set(0,0,0)),s.copy(i).sub(e),t>s.length()&&(t=s.length(),this.nearest=o)})),this._grabber=this.el.sceneEl.querySelector("[grabbing]")?.components.grabbing)}})},{}],14:[function(t,e,i){!function(){var t=document.createElement("style");t.innerHTML="input, select,textarea{border: 1px solid #000000;margin: 0;background-color: #ffffff;-webkit-appearance: none;}:-webkit-autofill {color: #fff !important;}input[type='checkbox']{width: 20px;height: 20px;display: inline-block;}input[type='radio']{width: 20px;height: 20px;display: inline-block;border-radius: 50%;}input[type='checkbox'][checked],input[type='radio'][checked]{background-color: #555555;}a-entity[htmlembed] img{display:inline-block}a-entity[htmlembed]{display:none}";var e=document.querySelector("head");e.insertBefore(t,e.firstChild)}();e.exports=class{constructor(t,e,i){if(!t)throw"Container Element is Required";var s;this.updateCallback=e,this.eventCallback=i,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.html=t,this.html.style.display="block",this.width=0,this.height=0,this.html.style.display="none",this.html.style.position="absolute",this.html.style.top="0",this.html.style.left="0",this.html.style.overflow="hidden",this.mousemovehtml=t=>{t.stopPropagation()},this.html.addEventListener("mousemove",this.mousemovehtml),this.hashChangeEvent=()=>{this.hashChanged()},window.addEventListener("hashchange",this.hashChangeEvent,!1),this.overElements=[],this.focusElement=null,this.img=new Image,this.img.addEventListener("load",(()=>{this.render()})),this.csshack();var o=new MutationObserver(((t,e)=>{if(!this.nowatch)for(var i=0;i<t.length;i++)if(t[i].target!=this.html||"attributes"!=t[i].type){if(!t[i].target.styleRef||"class"==t[i].attributeName){var o=this.csssig(t[i].target);if(t[i].target.styleRef==o)continue;t[i].target.styleRef=o}s||(s=setTimeout((()=>{this.svgToImg(),s=!1})))}}));o.observe(this.html,{attributes:!0,childList:!0,subtree:!0}),this.observer=o,this.cssgenerated=[],this.cssembed=[],this.serializer=new XMLSerializer,this.hashChanged()}forceRender(){Array.from(document.querySelectorAll("*")).map((t=>t.classCache={})),this.svgToImg()}hashChanged(){if(window.clearedHash!=window.location.hash){Array.from(document.querySelectorAll("*")).map((t=>t.classCache={}));var t=document.querySelector(".targethack");if(t&&t.classList.remove("targethack"),window.location.hash){var e=document.querySelector(window.location.hash);e&&e.classList.add("targethack")}}window.clearedHash=window.location.hash,this.svgToImg()}cleanUp(){this.observer.disconnect(),window.removeEventListener("hashchange",this.hashChangeEvent),this.html.addEventListener("mousemove",this.mousrmovehtml)}csshack(){for(var t=document.styleSheets,e=0;e<t.length;e++)try{for(var i=t[e].cssRules,s=[],o=0;o<i.length;o++){i[o].cssText.indexOf(":hover")>-1&&s.push(i[o].cssText.replace(new RegExp(":hover","g"),".hoverhack")),i[o].cssText.indexOf(":active")>-1&&s.push(i[o].cssText.replace(new RegExp(":active","g"),".activehack")),i[o].cssText.indexOf(":focus")>-1&&s.push(i[o].cssText.replace(new RegExp(":focus","g"),".focushack")),i[o].cssText.indexOf(":target")>-1&&s.push(i[o].cssText.replace(new RegExp(":target","g"),".targethack"));var a=s.indexOf(i[o].cssText);a>-1&&s.splice(a,1)}for(o=0;o<s.length;o++)t[e].insertRule(s[o])}catch(t){}}dbj2(t){for(var e=5381,i=0;i<t.length;i++)e=(e<<5)+e+t.charCodeAt(i);return e}csssig(t){if(t.classCache||(t.classCache={}),!t.classCache[t.className]){for(var e=getComputedStyle(t),i="",s=0;s<e.length;s++)i+=e[e[s]];t.classCache[t.className]=this.dbj2(i)}return t.classCache[t.className]}arrayBufferToBase64(t){for(var e="",i=t.byteLength,s=0;s<i;s++)e+=String.fromCharCode(t[s]);return window.btoa(e)}embedCss(t,e){return new Promise((i=>{var s,o=[];e=(e=(e=(e=e.replace(new RegExp(":hover","g"),".hoverhack")).replace(new RegExp(":active","g"),".activehack")).replace(new RegExp(":focus","g"),".focushack")).replace(new RegExp(":target","g"),".targethack");const a=RegExp(/url\((?!['"]?(?:data):)['"]?([^'"\)]*)['"]?\)/gi);for(;s=a.exec(e);)o.push(this.getDataURL(new URL(s[1],t)).then((t=>i=>{e=e.replace(t[1],i)})(s)));Promise.all(o).then((t=>{i(e)}))}))}getURL(t){return t=new URL(t,window.location).href,new Promise((e=>{var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=()=>{e(i)},i.send()}))}generatePageCSS(){for(var t=Array.from(document.querySelectorAll("style, link[type='text/css'],link[rel='stylesheet']")),e=[],i=0;i<t.length;i++){var s=t[i];if(-1==this.cssgenerated.indexOf(s)){this.csshack();var o=this.cssgenerated.length;this.cssgenerated.push(s),"STYLE"==s.tagName?e.push(this.embedCss(window.location,s.innerHTML).then(((t,e)=>t=>{this.cssembed[e]=t})(0,o))):e.push(this.getURL(s.getAttribute("href")).then((t=>e=>{var i=new TextDecoder("utf-8").decode(e.response);return this.embedCss(window.location,i).then(((t,e)=>t=>{this.cssembed[e]=t})(0,t))})(o)))}}return Promise.all(e)}getDataURL(t){return new Promise((e=>{this.getURL(t).then((i=>{var s=new Uint8Array(i.response),o=i.getResponseHeader("Content-Type").split(";")[0];if("text/css"==o){var a=new TextDecoder("utf-8").decode(s);this.embedCss(t,a).then((t=>{var i=window.btoa(t);i.length>0?e("data:"+o+";base64,"+i):e("")}))}else{var n=this.arrayBufferToBase64(s);e("data:"+o+";base64,"+n)}}))}))}embededSVG(){for(var t=[],e=this.html.querySelectorAll("*"),i=0;i<e.length;i++){var s=e[i].getAttributeNS("http://www.w3.org/1999/xlink","href");if(s&&t.push(this.getDataURL(s).then((t=>e=>{t.removeAttributeNS("http://www.w3.org/1999/xlink","href"),t.setAttribute("href",e)})(e[i]))),"IMG"==e[i].tagName&&"data"!=e[i].src.substr(0,4)&&t.push(this.getDataURL(e[i].src).then((t=>e=>{t.setAttribute("src",e)})(e[i]))),"http://www.w3.org/1999/xhtml"==e[i].namespaceURI&&e[i].hasAttribute("style")){var o=e[i].getAttribute("style");t.push(this.embedCss(window.location,o).then(((t,e)=>i=>{t!=i&&e.setAttribute("style",i)})(o,e[i])))}}var a=this.html.querySelectorAll("style");for(i=0;i<a.length;i++)t.push(this.embedCss(window.location,a[i].innerHTML).then((t=>e=>{t.innerHTML!=e&&(t.innerHTML=e)})(a[i])));return Promise.all(t)}updateFocusBlur(){for(var t=this.html.querySelectorAll("*"),e=0;e<t.length;e++){var i=t[e];i.tabIndex>-1?(i.hasOwnProperty("focus")||(i.focus=(t=>()=>this.setFocus(t))(i)),i.hasOwnProperty("blur")||(i.blur=(t=>()=>this.focusElement==t&&this.setBlur())(i))):(delete i.focus,delete i.blur)}}getParents(){var t=[],e=[],i=this.html.parentNode;do{var s=i.tagName.toLowerCase();"a-"==s.substr(0,2)&&(s="div");var o="<"+("body"==s?'body xmlns="http://www.w3.org/1999/xhtml"':s)+' style="transform: none;left: 0;top: 0;position:static;display: block" class="'+i.className+'"'+(i.id?' id="'+i.id+'"':"")+">";t.unshift(o);var a="</"+s+">";if(e.push(a),"body"==s)break}while(i=i.parentNode);return[t.join(""),e.join("")]}updateCheckedAttributes(){for(var t=this.html.getElementsByTagName("input"),e=0;e<t.length;e++){var i=t[e];i.hasAttribute("checked")?i.checked||i.removeAttribute("checked"):i.checked&&i.setAttribute("checked","")}}svgToImg(){this.updateFocusBlur(),Promise.all([this.embededSVG(),this.generatePageCSS()]).then((()=>{this.html.style.display="block",this.width==this.html.offsetWidth&&this.height==this.html.offsetHeight||(this.width=this.html.offsetWidth,this.height=this.html.offsetHeight,this.canvas.width=this.width,this.canvas.height=this.height,this.eventCallback&&this.eventCallback("resized"));var t=this.serializer.serializeToString(this.html),e=this.getParents();t='<svg width="'+this.width+'" height="'+this.height+'" xmlns="http://www.w3.org/2000/svg"><defs><style type="text/css"><![CDATA[a[href]{color:#0000EE;text-decoration:underline;}'+this.cssembed.join("")+']]></style></defs><foreignObject x="0" y="0" width="'+this.width+'" height="'+this.height+'">'+e[0]+t+e[1]+"</foreignObject></svg>",this.img.src="data:image/svg+xml;utf8,"+encodeURIComponent(t),this.html.style.display="none"}))}render(){this.canvas.width=this.width,this.canvas.height=this.height,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.img,0,0),this.updateCallback&&this.updateCallback(),this.eventCallback&&this.eventCallback("rendered")}transformPoint(t,e,i,s,o){var a=t.transform;if(0==a.indexOf("matrix(")){var n=new THREE.Matrix4,r=a.substring(7,a.length-1).split(", ").map(parseFloat);n.elements[0]=r[0],n.elements[1]=r[1],n.elements[4]=r[2],n.elements[5]=r[3],n.elements[12]=r[4],n.elements[13]=r[5]}else{if(0!=a.indexOf("matrix3d("))return[e,i,z];n=new THREE.Matrix4,r=a.substring(9,a.length-1).split(", ").map(parseFloat);n.elements=r}var h=t["transform-origin"],l=s+(h=h.replace(new RegExp("px","g"),"").split(" ").map(parseFloat))[0],c=o+h[1],d=0;h[2]&&(d+=h[2]);var u=(new THREE.Matrix4).makeTranslation(-l,-c,-d);if(0!=(n=(new THREE.Matrix4).makeTranslation(l,c,d).multiply(n).multiply(u)).determinant())return[e,i];var p=(new THREE.Matrix4).getInverse(n),m=new THREE.Vector3(e,i,0),b=new THREE.Vector3(e,i,-1);m.applyMatrix4(p),b.applyMatrix4(p);var g=b.sub(m).normalize();if(0==g.z)return!1;var y=g.multiplyScalar(-m.z/g.z).add(m);return[y.x,y.y]}getBorderRadii(t,e){for(var i,s=["border-top-left-radius","border-top-right-radius","border-bottom-right-radius","border-bottom-left-radius"],o=[],a=0;a<s.length;a++){for(var n=e[s[a]],r=/(\d*)([a-z%]{1,3})/gi,h=[];i=r.exec(n);)h.push({value:i[1],unit:i[2]});1==h.length&&h.push(h[0]),o.push(h)}const l={px:1,"%":t.offsetWidth/100};var c=[];for(a=0;a<o.length;a++){for(var d=o[a],u=(h=[],0);u<d.length;u++)h.push(d[u].value*l[d[u].unit]);c.push(h)}var p=1,m=1,b=1,g=1,y=c[0][0]+c[1][0];if(y>t.offsetWidth){var f=1/y*t.offsetWidth;p=Math.min(p,f),m=Math.min(m,f)}var v=c[1][1]+c[2][1];v>t.offsetHeight&&(f=1/v*t.offsetHeight,b=Math.min(b,f),m=Math.min(m,f));var E=c[2][0]+c[3][0];E>t.offsetWidth&&(f=1/E*t.offsetWidth,b=Math.min(b,f),g=Math.min(g,f));var _=c[0][1]+c[3][1];return _>t.offsetHeight&&(f=1/_*t.offsetHeight,p=Math.min(p,f),g=Math.min(g,f)),c[0][0]=c[0][0]*p,c[0][1]=c[0][1]*p,c[1][0]=c[1][0]*m,c[1][1]=c[1][1]*m,c[2][0]=c[2][0]*b,c[2][1]=c[2][1]*b,c[3][0]=c[3][0]*g,c[3][1]=c[3][1]*g,c}checkInBorder(t,e,i,s,o,a){if("0px"==e["border-radius"])return!0;var n,r,h=t.offsetWidth,l=t.offsetHeight,c=this.getBorderRadii(t,e);if(i<c[0][0]+o&&s<c[0][1]+a&&(n=(c[0][0]+o-i)/c[0][0])*n+(r=(c[0][1]+a-s)/c[0][1])*r>1)return!1;if(i>o+h-c[1][0]&&s<c[1][1]+a&&(n=(i-(o+h-c[1][0]))/c[1][0])*n+(r=(c[1][1]+a-s)/c[1][1])*r>1)return!1;if(i>o+h-c[2][0]&&s>a+l-c[2][1]&&(n=(i-(o+h-c[2][0]))/c[2][0])*n+(r=(s-(a+l-c[2][1]))/c[2][1])*r>1)return!1;if(i<c[3][0]+o&&s>a+l-c[3][1]&&(n=(c[3][0]+o-i)/c[3][0])*n+(r=(s-(a+l-c[3][1]))/c[3][1])*r>1)return!1;return!0}checkElement(t,e,i,s,o,a,n,r){if(n.offsetParent){var h=window.getComputedStyle(n),l=n.offsetLeft+i,c=n.offsetTop+s,d=n.offsetWidth,u=n.offsetHeight,p=h["z-index"];if("auto"!=p&&(o=0,a=parseInt(p)),"static"!=h.position&&n!=this.html&&"auto"==p&&(o+=1),("block"==h.display||"inline-block"==h.display)&&"none"!=h.transform){var m=this.transformPoint(h,t,e,l,c);if(!m)return;t=m[0],e=m[1],"auto"==p&&(o+=1)}if(t>l&&t<l+d&&e>c&&e<c+u)this.checkInBorder(n,h,t,e,l,c)&&(o>=r.zIndex||a>r.level)&&a>=r.level&&"none"!=h["pointer-events"]&&(r.zIndex=o,r.ele=n,r.level=a);else if("visible"!=h.overflow)return;var b=n.firstChild;if(b)do{1==b.nodeType&&(b.offsetParent==n?this.checkElement(t,e,i+l,s+c,o,a,b,r):this.checkElement(t,e,i,s,o,a,b,r))}while(b=b.nextSibling)}}elementAt(t,e){this.html.style.display="block";var i={zIndex:0,ele:null,level:0};return this.checkElement(t,e,0,0,0,0,this.html,i),this.html.style.display="none",i.ele}moveMouse(){var t=this.moveX,e=this.moveY,i=this.moveButton,s={screenX:t,screenY:e,clientX:t,clientY:e,button:i||0,bubbles:!0,cancelable:!0},o={clientX:t,clientY:e,button:i||0,bubbles:!1},a=this.elementAt(t,e);if(a!=this.lastEle)if(a){a.tabIndex>-1&&this.eventCallback&&this.eventCallback("focusableenter",{target:a}),this.lastEle&&this.lastEle.tabIndex>-1&&this.eventCallback&&this.eventCallback("focusableleave",{target:this.lastEle});var n=[],r=a;this.lastEle&&this.lastEle.dispatchEvent(new MouseEvent("mouseout",s)),a.dispatchEvent(new MouseEvent("mouseover",s));do{if(r==this.html)break;-1==this.overElements.indexOf(r)&&(r.classList&&r.classList.add("hoverhack"),r.dispatchEvent(new MouseEvent("mouseenter",o)),this.overElements.push(r)),n.push(r)}while(r=r.parentNode);for(var h=0;h<this.overElements.length;h++){var l=this.overElements[h];-1==n.indexOf(l)&&(l.classList&&l.classList.remove("hoverhack"),l.dispatchEvent(new MouseEvent("mouseleave",o)),this.overElements.splice(h,1),h--)}}else for(;l=this.overElements.pop();)l.classList&&l.classList.remove("hoverhack"),l.dispatchEvent(new MouseEvent("mouseout",s));a&&-1==this.overElements.indexOf(a)&&this.overElements.push(a),this.lastEle=a,a&&a.dispatchEvent(new MouseEvent("mousemove",s)),this.moveTimer=!1}mousemove(t,e,i){this.moveX=t,this.moveY=e,this.moveButton=i,this.moveTimer||(this.moveTimer=setTimeout(this.moveMouse.bind(this),20))}mousedown(t,e,i){var s={screenX:t,screenY:e,clientX:t,clientY:e,button:i||0,bubbles:!0,cancelable:!0},o=this.elementAt(t,e);o&&(this.activeElement=o,o.classList.add("activehack"),o.classList.remove("hoverhack"),o.dispatchEvent(new MouseEvent("mousedown",s))),this.mousedownElement=o}setFocus(t){t.dispatchEvent(new FocusEvent("focus")),t.dispatchEvent(new CustomEvent("focusin",{bubbles:!0,cancelable:!1})),t.classList.add("focushack"),this.focusElement=t}setBlur(){this.focusElement&&(this.focusElement.classList.remove("focushack"),this.focusElement.dispatchEvent(new FocusEvent("blur")),this.focusElement.dispatchEvent(new CustomEvent("focusout",{bubbles:!0,cancelable:!1})))}clearHover(){var t;for(this.moveTimer&&(clearTimeout(this.moveTimer),this.moveTimer=!1);t=this.overElements.pop();)t.classList&&t.classList.remove("hoverhack"),t.dispatchEvent(new MouseEvent("mouseout",{bubbles:!0,cancelable:!0}));this.lastEle&&this.lastEle.dispatchEvent(new MouseEvent("mouseleave",{bubbles:!0,cancelable:!0})),this.lastEle=null;var e=document.querySelector(".activeElement");e&&(e.classList.remove("activehack"),this.activeElement=null)}mouseup(t,e,i){var s={screenX:t,screenY:e,clientX:t,clientY:e,button:i||0,bubbles:!0,cancelable:!0},o=this.elementAt(t,e);this.activeElement&&(this.activeElement.classList.remove("activehack"),o&&(o.classList.add("hoverhack"),-1==this.overElements.indexOf(o)&&this.overElements.push(o)),this.activeElement=null),o?(o.dispatchEvent(new MouseEvent("mouseup",s)),o!=this.focusElement&&(this.setBlur(),o.tabIndex>-1?this.setFocus(o):this.focusElement=null),o==this.mousedownElement&&(o.dispatchEvent(new MouseEvent("click",s)),"INPUT"==o.tagName&&this.updateCheckedAttributes(),"INPUT"!=o.tagName&&"TEXTAREA"!=o.tagName&&"SELECT"!=o.tagName||this.eventCallback&&this.eventCallback("inputrequired",{target:o}))):(this.focusElement&&this.focusElement.dispatchEvent(new FocusEvent("blur")),this.focusElement=null)}}},{}],15:[function(t,e,i){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");const s=t("./htmlcanvas.js");AFRAME.registerComponent("htmlembed",{schema:{ppu:{type:"number",default:256}},init:function(){var t=new s(this.el,(()=>{e&&(e.needsUpdate=!0)}),((t,e)=>{switch(t){case"resize":this.el.emit("resize");break;case"rendered":this.el.emit("rendered");break;case"focusableenter":this.el.emit("focusableenter",e);break;case"focusableleave":this.el.emit("focusableleave",e);break;case"inputrequired":this.el.emit("inputrequired",e)}}));this.htmlcanvas=t;var e=new THREE.CanvasTexture(t.canvas);e.minFilter=THREE.LinearFilter,e.wrapS=THREE.ClampToEdgeWrapping,e.wrapT=THREE.ClampToEdgeWrapping;const i=new THREE.MeshBasicMaterial({map:e,transparent:!0});var o=new THREE.PlaneGeometry,a=new THREE.Mesh(o,i);this.el.setObject3D("screen",a),this.screen=a,this.el.addEventListener("raycaster-intersected",(t=>{this.raycaster=t.detail.el})),this.el.addEventListener("raycaster-intersected-cleared",(t=>{this.htmlcanvas.clearHover(),this.raycaster=null})),this.el.addEventListener("mousedown",(t=>{t instanceof CustomEvent?this.htmlcanvas.mousedown(this.lastX,this.lastY):t.stopPropagation()})),this.el.addEventListener("mouseup",(t=>{t instanceof CustomEvent?this.htmlcanvas.mouseup(this.lastX,this.lastY):t.stopPropagation()})),this.resize()},resize(){this.width=this.htmlcanvas.width/this.data.ppu,this.height=this.htmlcanvas.height/this.data.ppu,this.screen.scale.x=Math.max(1e-4,this.width),this.screen.scale.y=Math.max(1e-4,this.height)},update(){this.resize()},forceRender(){this.htmlcanvas.forceRender()},tick:function(){if(this.resize(),this.raycaster){var t=this.raycaster.components.raycaster.getIntersection(this.el);if(t){var e=t.point;this.el.object3D.worldToLocal(e);var i=this.width/2,s=this.height/2,o=Math.round((e.x+i)/this.width*this.htmlcanvas.canvas.width),a=Math.round((1-(e.y+s)/this.height)*this.htmlcanvas.canvas.height);this.lastX==o&&this.lastY==a||this.htmlcanvas.mousemove(o,a),this.lastX=o,this.lastY=a}}},remove:function(){this.el.removeObject3D("screen")}})},{"./htmlcanvas.js":14}],16:[function(t,e,i){AFRAME.registerComponent("include",{schema:{type:"string"},async init(){if(this.data&&!this.el.sceneEl._including_){this.el.sceneEl._including_=!0;let t=this.el.outerHTML,e=t.indexOf(" "),i=t.indexOf(" include="),s=t.substr(e,i-e);e=t.indexOf('"',i+10)+1,i=t.indexOf(">"),s+=t.substr(e,i-e);let o=await fetch(this.data);o.status>=200&&o.status<300?this.el.outerHTML=await(await o.text()).replace(">"," >").replace(" "," "+s+" "):this.el.removeAttribute("include"),this.el.sceneEl._including_=!1;let a=this.el.sceneEl.querySelector("[include]");a&&a.components&&a.components.include&&a.components.include.init()}}})},{}],17:[function(t,e,i){AFRAME.registerComponent("injectfluo",{schema:{intensity:{type:"number",default:.3}},init(){console.log(this.el),this.el.innerHTML='<a-light type="point"  0" intensity="'+this.data.intensity+'" penumbra="0.5"></a-light>'},update(t){},tick(t,e){}})},{}],18:[function(t,e,i){AFRAME.registerComponent("injectglove",{init(){this.el.innerHTML.trim()||this.defaultGlove();let t=this.el.getAttribute("side")||this.el.parentNode.getAttribute("side");this.el.ensure(".palm","a-entity",{class:"palm",position:("left"===t?-.01:.01)+" -0.03 0.08",rotation:"-35 0 0"}),this.el.ensure('a-hand[side="right"]',"a-hand",{side:"right"})},defaultGlove(){let t=this.el.getAttribute("side")||this.el.parentNode.getAttribute("side"),e=this.el.getAttribute("color")||this.el.parentNode.getAttribute("color")||"lightblue";this.el.getAttribute("fingerflex")||this.el.setAttribute("fingerflex",{min:"left"===t?-10:10,max:"left"===t?-90:90}),this.el.innerHTML=`<a-box class="palm" color="${e}" position="${"left"===t?-.01:.01} -0.03 0.08" rotation="-35 0 0" width="0.02" height="0.08"\n      depth="0.08">\n      <a-entity position="0 0.04 0.02" rotation="80 0 ${"left"===t?-45:45}">\n        <a-entity class="thumb bend">\n          <a-box color="${e}" position="0 0 -0.02" width="0.02" height="0.02" depth="0.04">\n            <a-entity class="bend" position="0 0 -0.02">\n              <a-box color="${e}" position="0 0 -0.02" width="0.02" height="0.02" depth="0.04">\n              </a-box>\n            </a-entity>\n          </a-box>\n        </a-entity>\n      </a-entity>\n      <a-entity class="index bend" position="0 0.03 -0.04" rotation="3 0 0">\n        <a-box color="${e}" position="0 0 -0.02" width="0.02" height="0.02" depth="0.04">\n          <a-entity class="bend" position="0 0 -0.02">\n            <a-box color="${e}" position="0 0 -0.02" width="0.02" height="0.02" depth="0.04">\n            </a-box>\n          </a-entity>\n        </a-box>\n      </a-entity>\n      <a-entity class="middle bend" position="0 0.01 -0.04" rotation="1 0 0">\n        <a-box color="${e}" position="0 0 -0.02" width="0.02" height="0.02" depth="0.04">\n          <a-entity class="bend" position="0 0 -0.02">\n            <a-box color="${e}" position="0 0 -0.02" width="0.02" height="0.02" depth="0.04">\n            </a-box>\n          </a-entity>\n        </a-box>\n      </a-entity>\n      <a-entity class="ring bend" position="0 -0.01 -0.04" rotation="-1 0 0">\n        <a-box color="${e}" position="0 0 -0.02" width="0.02" height="0.02" depth="0.04">\n          <a-entity class="bend" position="0 0 -0.02">\n            <a-box color="${e}" position="0 0 -0.02" width="0.02" height="0.02" depth="0.04">\n            </a-box>\n          </a-entity>\n        </a-box>\n      </a-entity>\n      <a-entity class="little bend" position="0 -0.03 -0.04" rotation="-3 0 0">\n        <a-box color="${e}" position="0 0 -0.02" width="0.02" height="0.02" depth="0.04">\n          <a-entity class="bend" position="0 0 -0.02">\n            <a-box color="${e}" position="0 0 -0.02" width="0.02" height="0.02" depth="0.04">\n            </a-box>\n          </a-entity>\n        </a-box>\n      </a-entity>\n    </a-box>`}})},{}],19:[function(t,e,i){AFRAME.registerComponent("injectplayer",{init(){}})},{}],20:[function(t,e,i){AFRAME.registerComponent("limit",{schema:{minPos:{type:"vec3"},maxPos:{type:"vec3"},rotationRange:{type:"vec3",default:{x:1,y:1,z:1}}},tick(){let t=THREE.Vector3.temp(),e=this.el.object3D.position,i=this.data.minPos,s=this.data.maxPos,o=this.el.object3D.quaternion,a=THREE.Quaternion.temp().set(-Math.abs(this.data.rotationRange.x),-Math.abs(this.data.rotationRange.y),-Math.abs(this.data.rotationRange.z),-1),n=THREE.Quaternion.temp().set(Math.abs(this.data.rotationRange.x),Math.abs(this.data.rotationRange.y),Math.abs(this.data.rotationRange.z),1);t.copy(e),e.set(Math.min(Math.max(i.x,e.x),s.x),Math.min(Math.max(i.y,e.y),s.y),Math.min(Math.max(i.z,e.z),s.z)),o.set(Math.min(Math.max(a.x,o.x),n.x),Math.min(Math.max(a.y,o.y),n.y),Math.min(Math.max(a.z,o.z),n.z),Math.min(Math.max(a.w,o.w),n.w)).normalize(),t.sub(e),t.length()>0&&(setTimeout((()=>{this.el.components.body?.commit()})),this.el.object3D.updateWorldMatrix(!0,!0),this.el.emit("limited"))},events:{drop(t){}}})},{}],21:[function(t,e,s){AFRAME.registerComponent("locomotion",{dependencies:["position","injectplayer"],schema:{speed:{type:"number",default:4},stepLength:{type:"number",default:1},rotationSpeed:{type:"number",default:1},teleportDistance:{type:"number",default:5},jumpForce:{type:"number",default:4},gravity:{type:"number",default:10},godMode:{type:"boolean",default:!1}},init(){this._onKeyDown=this._onKeyDown.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onAxisMove=this._onAxisMove.bind(this),this._onButtonChanged=this._onButtonChanged.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onEnterVR=this._onEnterVR.bind(this),this._onExitVR=this._onExitVR.bind(this),this._keysDown={},this._kbStick=new THREE.Vector2,this._axes=[0,0,0,0],this._leftTouchCenter=new THREE.Vector2,this._leftTouchDir=new THREE.Vector2,this._rightTouchCenter=new THREE.Vector2,this._rightTouchDir=new THREE.Vector2,this._teleporting=!0,this._bumpOverload=0,this._vertVelocity=1,this.currentFloorPosition=new THREE.Vector3,this.centerPos=new THREE.Vector3,this.headPos=new THREE.Vector3,this.headDir=new THREE.Vector3,this.feetPos=new THREE.Vector3,this.lastStep=new THREE.Vector3,this._config={quantizeMovement:!1,quantizeRotation:!1,quantizeMovementVR:!!this.el.sceneEl.isMobile,quantizeRotationVR:!0},this.el.sceneEl.is("vr-mode")?this._onEnterVR():this._onExitVR(),this._camera=this.el.querySelector("a-camera"),this._leftHand=this.el.querySelector('a-hand[side="left"]'),this._rightHand=this.el.querySelector('a-hand[side="right"]'),this._legs=this.el.sceneEl.ensure(".legs","a-entity",{class:"legs",position:"0 0.5 0",raycaster:{deep:!0,autoRefresh:!1,objects:"[floor]",direction:"0 -1 0",far:.625}}),this._legBumper=this.el.sceneEl.ensure(".leg-bumper","a-entity",{class:"leg-bumper",position:"0 0.5 0",raycaster:{deep:!0,autoRefresh:!1,objects:"[wall]"}}),this._headBumper=this.el.sceneEl.ensure(".head-bumper","a-entity",{class:"head-bumper",position:"0 0.5 0",raycaster:{deep:!0,autoRefresh:!1,objects:"[wall]"}}),this._teleportBeam=this._camera.ensure(".teleport-ray","a-entity",{class:"teleport-ray",raycaster:{deep:!0,autoRefresh:!1,objects:"[wall]"}}),this._teleportCursor=this.el.ensure(".teleport-cursor","a-cylinder",{class:"teleport-cursor",radius:.5,height:.0625,material:"opacity:0.5;"}),this._teleportCursor.setAttribute("visible",!1)},update(t){this._godMode=this.data.godMode},play(){document.addEventListener("keydown",this._onKeyDown),document.addEventListener("keyup",this._onKeyUp),this._leftHand.addEventListener("axismove",this._onAxisMove),this._rightHand.addEventListener("axismove",this._onAxisMove),this._leftHand.addEventListener("buttonchanged",this._onButtonChanged),this._rightHand.addEventListener("buttonchanged",this._onButtonChanged),this.el.sceneEl.canvas.addEventListener("touchstart",this._onTouchStart),this.el.sceneEl.canvas.addEventListener("touchmove",this._onTouchMove),this.el.sceneEl.canvas.addEventListener("touchend",this._onTouchEnd),this.el.sceneEl.addEventListener("enter-vr",this._onEnterVR),this.el.sceneEl.addEventListener("exit-vr",this._onExitVR)},pause(){document.removeEventListener("keydown",this._onKeyDown),document.removeEventListener("keyup",this._onKeyUp),this._leftHand.removeEventListener("axismove",this._onAxisMove),this._rightHand.removeEventListener("axismove",this._onAxisMove),this._leftHand.removeEventListener("buttonchanged",this._onButtonChanged),this._rightHand.removeEventListener("buttonchanged",this._onButtonChanged),this.el.sceneEl.canvas.removeEventListener("touchstart",this._onTouchStart),this.el.sceneEl.canvas.removeEventListener("touchmove",this._onTouchMove),this.el.sceneEl.canvas.removeEventListener("touchend",this._onTouchEnd),this.el.sceneEl.removeEventListener("enter-vr",this._onEnterVR),this.el.sceneEl.removeEventListener("exit-vr",this._onExitVR)},remove(){this.el.sceneEl.removeChild(this._legs),this.el.sceneEl.removeChild(this._legBumper),this.el.sceneEl.removeChild(this._headBumper)},tick(t,e){e/=1e3,this.el.object3D.localToWorld(this.centerPos.set(0,0,0)),this.headPos.copy(this._camera.object3D.position),this._camera.object3D.parent.localToWorld(this.headPos),this.headDir.set(0,0,-1).applyQuaternion(this._camera.object3D.quaternion).applyQuaternion(this.el.object3D.getWorldQuaternion(THREE.Quaternion.temp())),this._legs.object3D.localToWorld(this.feetPos.set(0,0,0)),this.feetPos.y-=.5,this._applyButtons(e),this._applyMoveStick(e),this._applyAuxStick(e);let i=THREE.Vector3.temp().copy(this.headPos).sub(this.feetPos);if(i.y=0,(i.length()>.5||!this.currentFloor)&&(this.currentFloor&&i.multiplyScalar(.1),this._legs.object3D.position.add(i),this.feetPos.add(i)),!this._godMode&&!this._caution){let t=this._legs.components.raycaster;t.refreshObjects();let i=t.intersections[0];if(i&&this._vertVelocity<=0){if(this._vertVelocity=0,this.currentFloor===i.el){let t=THREE.Vector3.temp();t.copy(this.currentFloor.object3D.position).sub(this.currentFloorPosition),this.move(t),this.lastStep.add(t),t.y=0,this._legs.object3D.position.add(t)}else this.currentFloor&&this.currentFloor.emit("leave"),i.el.emit("enter");this.move(THREE.Vector3.temp().set(0,.5-i.distance,0)),this.currentFloor=i.el,this.currentFloorPosition.copy(this.currentFloor.object3D.position)}else this.currentFloor&&this.currentFloor.emit("leave"),this._vertVelocity-=this.data.gravity*e,this.move(THREE.Vector3.temp().set(0,Math.max(-.5,this._vertVelocity*e),0)),this.currentFloor=null}if(this._godMode)this._legBumper.object3D.position.copy(this._legs.object3D.position),this._headBumper.object3D.position.copy(this._legs.object3D.position);else if(this._bumpOverload>4||Math.abs(this.headPos.y-this.feetPos.y)>3)this.feetPos.y=this.centerPos.y,this._legs.object3D.position.y=this.feetPos.y+.5,this.teleport(this._legBumper.object3D.position,!0),this._bumpOverload&&this._bumpOverload--;else{let t=THREE.Vector3.temp();t.copy(this.feetPos).y+=.5,this._bump(t,this._legBumper),t.copy(this.headPos),this._bump(t,this._headBumper)}let s=THREE.Vector3.temp();if(s.copy(this.feetPos).sub(this.lastStep),s.length()>this.data.stepLength)for(this.currentFloor&&(this.el.emit("step"),this.currentFloor.emit("step"));s.length()>this.data.stepLength;)s.multiplyScalar(this.data.stepLength/s.length()),this.lastStep.add(s),s.copy(this.feetPos).sub(this.lastStep);this.el.object3D.updateWorldMatrix(!0,!0)},teleport(t,e){let i=THREE.Vector3.temp();i.copy(t).sub(this.feetPos),this.move(i),this._legs.object3D.position.x=this.feetPos.x=this.headPos.x,this._legs.object3D.position.z=this.feetPos.z=this.headPos.z,this._caution=8,e&&(this._legBumper.object3D.position.copy(this._legs.object3D.position),this._headBumper.object3D.position.copy(this._legs.object3D.position))},jump(){this.currentFloor&&(this._vertVelocity=this.data.jumpForce)},stopFall(){this._legs.object3D.position.x=this.feetPos.x=this.headPos.x,this._legs.object3D.position.z=this.feetPos.z=this.headPos.z,this._vertVelocity=0},toggleCrouch(t){if(!this.currentFloor)return setTimeout((()=>{this.toggleCrouch(t)}),256);let e,i=this.headPos.y-this.feetPos.y;clearTimeout(this._crouchResetTO),this._crouchResetTO=null,Math.abs(this.centerPos.y-this.feetPos.y)>.03125?e=this.feetPos.y-this.centerPos.y:t||(e=i>1?-1:1),this.el.removeAttribute("animation"),e&&this.el.setAttribute("animation",{property:"object3D.position.y",to:this.el.object3D.position.y+e,dur:256})},move(t){this.el.object3D.position.add(t),this.centerPos.add(t),this.headPos.add(t),this._legs.object3D.position.y+=t.y,this.feetPos.y+=t.y},_bump(t,e){let i=THREE.Matrix3.temp(),s=THREE.Vector3.temp();s.copy(t),s.sub(e.object3D.position);let o=s.length();if(o){e.setAttribute("raycaster","far",o+.125),e.setAttribute("raycaster","direction",`${s.x} ${s.y} ${s.z}`);let a=e.components.raycaster;a.refreshObjects();let n=a.intersections[0];if(n){this.el.removeAttribute("animation"),i.getNormalMatrix(n.el.object3D.matrixWorld),s.copy(n.face.normal).applyMatrix3(i).normalize().multiplyScalar(o+.125);let t=this._legs.object3D.position.y;this.move(s),e.object3D.position.add(s),this._legs.object3D.position.y!==t&&(e===this._headBumper&&this._headBumper.object3D.position.copy(this._legBumper.object3D.position),clearTimeout(this._crouchResetTO),this._crouchResetTO=setTimeout((()=>{this.toggleCrouch(!0)}),4096)),this._legs.object3D.position.add(s),this._legs.object3D.position.y=Math.max(t,this.headPos.y-1.5),this._caution=4,this._bumpOverload++,this._vertVelocity=Math.min(0,this._vertVelocity);let a={player:this.el,object:n.el};this.el.emit("bump",a),n.el.emit("bump",a)}else this._caution?this._caution--:(this._bumpOverload&&this._bumpOverload--,e.object3D.position.lerp(t,.25))}},_callMoveStick(){let t=THREE.Vector2.temp().set(0,0),e=THREE.Vector2.temp();for(e.set(0,0),this._keysDown.KeyA&&e.x--,this._keysDown.KeyD&&e.x++,(this._keysDown.KeyW||this._keysDown.ArrowUp)&&e.y--,(this._keysDown.KeyS||this._keysDown.ArrowDown)&&e.y++,this._kbStick.length()>.1?this._kbStick.multiplyScalar((this._kbStick.length()-.1)/this._kbStick.length()):this._kbStick.set(0,0),this._kbStick.add(e.multiplyScalar(.2)),this._kbStick.length()>1&&this._kbStick.normalize(),this._kbStick.length()>t.length()&&t.copy(this._kbStick),this._deadZone(e.set(this._axes[0],this._axes[1])),e.length()>t.length()&&t.copy(e),e.copy(this._leftTouchDir),e.length()>t.length()&&t.copy(e),i=0,len=navigator.getGamepads().length;i<len;i++)gamepad=navigator.getGamepads()[i],gamepad&&(this._deadZone(e.set(gamepad.axes[0],gamepad.axes[1])),e.length()>t.length()&&(this._setDevice("gamepad"),t.copy(e)));return t.length()>1&&t.normalize(),(this._keysDown.ShiftLeft||this._keysDown.ShiftRight)&&t.multiplyScalar(.25),t},_applyMoveStick(t){let e=this._callMoveStick();e.multiplyScalar(this.data.speed),e.multiplyScalar(t);let i=THREE.Vector2.temp().set(this.headDir.z,-this.headDir.x).angle()-Math.PI,s=Math.cos(i)*e.x-Math.sin(i)*e.y,o=Math.sin(i)*e.x+Math.cos(i)*e.y,a=THREE.Vector3.temp().set(s,0,o);this.quantizeMovement&&(this._quantTime=this._quantTime||0,this._quantDelta=this._quantDelta||new THREE.Vector3,this._quantTime+=t,this._quantDelta.add(a),this._quantTime>.25?(this._quantTime-=.25,a.copy(this._quantDelta),this._quantDelta.set(0,0,0)):a.set(0,0,0)),this.move(a)},_callAuxStick(){let t=THREE.Vector2.temp().set(0,0),e=THREE.Vector2.temp();for(e.set(0,0),this._keysDown.ArrowLeft&&e.x--,this._keysDown.ArrowRight&&e.x++,this._keysDown.KeyQ&&e.y--,this._keysDown.KeyC&&e.y++,e.length()>t.length()&&t.copy(e),this._fourWay(this._deadZone(e.set(this._axes[2],this._axes[3]))),e.length()>t.length()&&t.copy(e),this._fourWay(e.copy(this._rightTouchDir)),e.length()>t.length()&&t.copy(e),i=0,len=navigator.getGamepads().length;i<len;i++)gamepad=navigator.getGamepads()[i],gamepad&&(this._fourWay(this._deadZone(e.set(gamepad.axes[2],gamepad.axes[3]))),e.length()>t.length()&&(this._setDevice("gamepad"),t.copy(e)));return t.length()>1&&t.normalize(),(this._keysDown.ShiftLeft||this._keysDown.ShiftRight)&&t.multiplyScalar(.25),t},_applyAuxStick(t){let e=this._callAuxStick(),i=0;if(this.quantizeRotation?Math.round(e.x)?this._rotating||(this._rotating=!0,i=-Math.round(e.x)*Math.PI/4):this._rotating=!1:i=-e.x*this.data.rotationSpeed*t,i){let t=THREE.Vector2.temp(),e=THREE.Vector2.temp(),s=THREE.Vector3.temp();t.set(this.feetPos.x,this.feetPos.z),e.set(this.centerPos.x,this.centerPos.z),t.rotateAround(e,-i),s.set(this.feetPos.x-t.x,0,this.feetPos.z-t.y),this.el.object3D.rotateY(i),this.el.object3D.position.add(s),this.centerPos.add(s)}if(this._godMode)this.el.object3D.position.y+=-e.y*this.data.speed*t,this._legs.object3D.position.y+=-e.y*this.data.speed*t;else if(Math.round(e.y)>0?this._crouching||(this._crouching=!0,this.toggleCrouch()):this._crouching=!1,Math.round(e.y)<0){!this._teleporting&&this.data.teleportDistance&&(this._teleportCursor.setAttribute("visible",!0),this._teleporting=!0);let t=THREE.Quaternion.temp();if(this._teleportCursor.object3D.getWorldQuaternion(t),this._teleportCursor.object3D.quaternion.multiply(t.conjugate().normalize()).multiply(t.copy(this.el.object3D.quaternion).multiply(this._camera.object3D.quaternion)),this._teleportCursor.object3D.quaternion.x=0,this._teleportCursor.object3D.quaternion.z=0,this._teleportCursor.object3D.quaternion.normalize(),ray=this._teleportBeam.components.raycaster,ray.refreshObjects(),hit=ray.intersections[0],hit&&hit.el.components.floor){let e=THREE.Vector3.temp(),i=THREE.Vector3.temp(),s=THREE.Matrix3.temp();i.copy(hit.point).sub(this.feetPos),i.y>1.5&&i.multiplyScalar(0),i.length()>this.data.teleportDistance&&i.normalize().multiplyScalar(this.data.teleportDistance),i.add(this.feetPos),this._teleportCursor.object3D.position.copy(i),this._teleportCursor.object3D.parent.worldToLocal(this._teleportCursor.object3D.position),s.getNormalMatrix(hit.el.object3D.matrixWorld),i.copy(hit.face.normal).applyMatrix3(s).normalize(),i.applyQuaternion(t.copy(this.el.object3D.quaternion).conjugate()),e.set(0,1,0),t.setFromUnitVectors(e,i),this._teleportCursor.object3D.quaternion.premultiply(t)}else this._teleportCursor.object3D.position.copy(this.feetPos),this._teleportCursor.object3D.parent.worldToLocal(this._teleportCursor.object3D.position)}else if(this._teleporting){let t=THREE.Vector3.temp();this._teleportCursor.object3D.localToWorld(t.set(0,0,0)),this.teleport(t),this._teleportCursor.setAttribute("visible",!1),this._teleportCursor.setAttribute("position","0 0 0"),this._teleporting=!1}},_callButtons(){let t=0;for(this._keysDown.Space&&(t|=1),this._keysDown.KeyG&&(t|=2),this._vrRightClick&&(t|=1),this._vrLeftClick&&(t|=2),i=0,len=navigator.getGamepads().length;i<len;i++)gamepad=navigator.getGamepads()[i],gamepad&&(gamepad.buttons[3]?.pressed&&(this._setDevice("gamepad"),t|=1),gamepad.buttons[11]?.pressed&&(this._setDevice("gamepad"),t|=1),gamepad.buttons[10]?.pressed&&(this._setDevice("gamepad"),t|=2));return t},_applyButtons(){let t=this._callButtons();t?(this._toggling||(1&t&&this.jump(),this.data.godMode&&2&t&&(this._godMode=!this._godMode),this._godMode&&(this._vertVelocity=0)),this._toggling=!0):this._toggling=!1},_deadZone:(t,e=.25)=>(t.length()>e?t.multiplyScalar((t.length()-e)/(1-e)/t.length()):t.set(0,0),t),_fourWay(t){let e=t.length();return Math.abs(t.x)>Math.abs(t.y)?t.y=0:t.x=0,t.multiplyScalar(e/t.length()),t},_onKeyDown(t){this._setDevice("desktop"),this._keysDown[t.code]=!0},_onKeyUp(t){this._keysDown[t.code]=!1},_onAxisMove(t){this._setDevice("vrcontroller"),"left"===t.srcElement.getAttribute("tracked-controls").hand?(this._axes[0]=t.detail.axis[2],this._axes[1]=t.detail.axis[3]):(this._axes[2]=t.detail.axis[2],this._axes[3]=t.detail.axis[3]),this._handEnabled||(this._teleportBeam.parentElement.removeChild(this._teleportBeam),this._teleportBeam=this._rightHand.ensure(".teleportBeam","a-entity",{class:"teleportBeam",rotation:"-45 0 0",raycaster:{deep:!0,autoRefresh:!1,objects:"[wall]"}}),this._handEnabled=!0)},_onButtonChanged(t){this._setDevice("vrcontroller"),"left"===t.srcElement.getAttribute("tracked-controls").hand?3==t.detail.id&&(this._vrLeftClick=t.detail.state.pressed):3==t.detail.id&&(this._vrRightClick=t.detail.state.pressed)},_onTouchStart(t){this._setDevice("touch");let e=this.el.sceneEl.canvas.clientWidth;for(let i=0;i<t.changedTouches.length;i++){let s=t.changedTouches[i];s.clientX<e/2&&(this._leftTouchId=s.identifier,this._leftTouchCenter.set(s.clientX,s.clientY)),s.clientX>e/2&&(this._rightTouchId=s.identifier,this._rightTouchCenter.set(s.clientX,s.clientY))}t.preventDefault()},_onTouchMove(t){for(let e=0;e<t.changedTouches.length;e++){let i=t.changedTouches[e],s=null,o=null;this._leftTouchId===i.identifier&&(s=this._leftTouchCenter,o=this._leftTouchDir),this._rightTouchId===i.identifier&&(s=this._rightTouchCenter,o=this._rightTouchDir),o&&(o.set(i.clientX,i.clientY),o.sub(s),o.length()>32&&(o.multiplyScalar((o.length()-32)/o.length()),s.add(o),o.multiplyScalar(32/o.length())),o.divideScalar(32))}t.preventDefault()},_onTouchEnd(t){for(let e=0;e<t.changedTouches.length;e++){let i=t.changedTouches[e];this._leftTouchId===i.identifier&&(this._leftTouchId=null,this._leftTouchDir.set(0,0)),this._rightTouchId===i.identifier&&(this._rightTouchId=null,this._rightTouchDir.set(0,0))}},_onEnterVR(t){this.isVR=!0,this.quantizeMovement=this._config.quantizeMovementVR,this.quantizeRotation=this._config.quantizeRotationVR},_onExitVR(t){this.isVR=!1,this.quantizeMovement=this._config.quantizeMovement,this.quantizeRotation=this._config.quantizeRotation},_setDevice(t){this.device!==t&&(this.el.removeState(this.device||"noinput"),this.device=t,this.el.addState(this.device||"noinput"))}}),t("./locomotion/floor"),t("./locomotion/wall"),t("./locomotion/start")},{"./locomotion/floor":22,"./locomotion/start":23,"./locomotion/wall":24}],22:[function(t,e,i){AFRAME.registerComponent("floor",{schema:{physics:{type:"boolean",default:!0}},update(){this.el.setAttribute("wall",this.data)}})},{}],23:[function(t,e,i){AFRAME.registerComponent("start",{init(){let t=this.el.sceneEl.querySelector("[locomotion]").components.locomotion;if(!t)return setTimeout((()=>{this.init()}),256);let e=new THREE.Vector3;setTimeout((()=>{this.el.object3D.localToWorld(e.set(0,0,0)),t.teleport(e,!0),setTimeout((()=>{t.toggleCrouch(!0)}),256)}),256)}})},{}],24:[function(t,e,i){AFRAME.registerComponent("wall",{schema:{physics:{type:"boolean",default:!0}},update(){this.data.physics&&!this.el.components.body&&this.el.setAttribute("body","type:static")}})},{}],25:[function(t,e,i){AFRAME.registerComponent("onevent",{multiple:!0,schema:{event:{type:"string"},entity:{type:"selector"},property:{type:"string"},value:{type:"string"}},init(){this.trigger=this.trigger.bind(this)},update(t){this.pause(),this._event=this.data.event||this.id||"",this._entity=this.data.entity||this.el,this._property=this.data.property||"",this._value=this.data.value||"",this.el.isPlaying&&this.play()},play(){this._event&&this.el.addEventListener(this._event,this.trigger)},pause(){this._event&&this.el.removeEventListener(this._event,this.trigger)},trigger(t){let e=this._property.split(".");e.push(this._value),this._entity.setAttribute(...e)}})},{}],26:[function(t,e,i){AFRAME.registerComponent("onstate",{multiple:!0,schema:{state:{type:"string"},entity:{type:"selector"},property:{type:"string"},on:{type:"string"},off:{type:"string"}},init(){this.trigger=this.trigger.bind(this)},update(t){this._state=this.data.state||this.id||"",this._entity=this.data.entity||this.el,this._property=this.data.property||"",this._on=this.data.on||"",this._off=this.data.off||""},play(){this.trigger(),this.el.addEventListener("stateadded",this.trigger),this.el.addEventListener("stateremoved",this.trigger)},pause(){this.el.removeEventListener("stateadded",this.trigger),this.el.removeEventListener("stateremoved",this.trigger)},trigger(t){if(t&&t.detail!==this._state)return;let e=this._property.split(".");e.push(this.el.is(this._state)?this._on:this._off),this._entity.setAttribute(...e)}})},{}],27:[function(t,e,i){const s=t("../libs/cmdCodec"),o=t("../../package");AFRAME.registerSystem("physics",{schema:{workerUrl:{type:"string",default:`https://cdn.jsdelivr.net/npm/a-recit@${o.version}/dist/cannonWorker.min.js`},gravity:{type:"vec3",default:{x:0,y:-10,z:0}},debug:{type:"boolean",default:!1}},update(){if(this.data.workerUrl){if(!this.worker){if(this.data.workerUrl.includes("//")){let t=`importScripts(${JSON.stringify(this.data.workerUrl)})`;this.worker=new Worker(`data:text/javascript;base64,${btoa(t)}`)}else this.worker=new Worker(this.data.workerUrl);this.worker.postMessage("log "+s.stringifyParam("Physics worker ready!")),this.worker.addEventListener("message",this.onMessage.bind(this))}this.bodies=this.bodies||[],this.movingBodies=this.movingBodies||[],this.joints=this.joints||[],this.buffers=[new Float64Array(8),new Float64Array(8)],this.worker.postMessage("world gravity = "+s.stringifyParam(this.data.gravity)),this._debug=this.data.debug}else this.remove()},remove(){this.worker&&this.worker.terminate(),this.worker=null,this.bodies=[],this.movingBodies=[]},tick(t,e){if(!this.worker)return;if(this.buffers.length<2)return;let i=this.buffers.shift();if(i.length<8*this.movingBodies.length){let t=i.length;for(;t<8*this.movingBodies.length;)t*=2;let e=this.movingBodies;i=new Float64Array(t),i.fill(NaN);let s=THREE.Vector3.temp(),o=THREE.Quaternion.temp();for(let t=0;t<e.length;t++){let a=8*t;e[t]&&(e[t].object3D.localToWorld(s.set(0,0,0)),i[a++]=s.x,i[a++]=s.y,i[a++]=s.z,a++,e[t].object3D.getWorldQuaternion(o),i[a++]=o.x,i[a++]=o.y,i[a++]=o.z,i[a++]=o.w)}}this.worker.postMessage(i,[i.buffer])},onMessage(t){if("string"==typeof t.data){let e=s.parse(t.data);switch(e.shift()){case"world":this.command(e)}}else if(t.data instanceof Float64Array)for(this.buffers.push(t.data);this.buffers.length>2;)this.buffers.shift()},command(t){switch("number"==typeof t[0]&&t.shift(),t.shift()){case"body":let e=t.shift(),i=this.bodies[e];i&&i.components.body.command(t)}},eval(t){this.worker.postMessage("world eval "+s.stringifyParam(t))}}),t("./physics/body"),t("./physics/shape"),t("./physics/joint")},{"../../package":1,"../libs/cmdCodec":39,"./physics/body":28,"./physics/joint":29,"./physics/shape":30}],28:[function(t,e,i){const s=t("../../libs/cmdCodec");AFRAME.registerComponent("body",{dependencies:["position","rotation","scale"],schema:{type:{type:"string",default:"dynamic"},mass:{type:"number",default:1},friction:{type:"number",default:.3},restitution:{type:"number",default:.3},belongsTo:{type:"int",default:1},collidesWith:{type:"int",default:1},emitsWith:{type:"int",default:0},sleeping:{type:"boolean",default:!1},autoShape:{type:"boolean",default:!0}},init(){let t=this.el.sceneEl.systems.physics.worker,e=this.el.sceneEl.systems.physics.bodies,i=this.el.sceneEl.systems.physics.movingBodies,o=this.el.sceneEl.systems.physics.buffers[0];if(!t)return;this.id=e.indexOf(null),this.id<0&&(this.id=e.length),e[this.id]=this.el,"static"!==this.data.type?(this.mid=i.indexOf(null),this.mid<0&&(this.mid=i.length),i[this.mid]=this.el):this.mid=null;let a={mid:this.mid};if(a.type=this.data.type,a.position=this.el.object3D.localToWorld(THREE.Vector3.temp().set(0,0,0)),a.quaternion=this.el.object3D.getWorldQuaternion(THREE.Quaternion.temp()),null!==this.mid){let t=8*this.mid;o[t++]=a.position.x,o[t++]=a.position.y,o[t++]=a.position.z,o[t++]=this.data.sleeping,o[t++]=a.quaternion.x,o[t++]=a.quaternion.y,o[t++]=a.quaternion.z,o[t++]=a.quaternion.w}if(this.shapes=[],this.sleeping=!0,t.postMessage("world body "+this.id+" create "+s.stringifyParam(a)),setTimeout((()=>{a.position=this.el.object3D.localToWorld(THREE.Vector3.temp().set(0,0,0)),a.quaternion=this.el.object3D.getWorldQuaternion(THREE.Quaternion.temp()),t.postMessage("world body "+this.id+" position = "+s.stringifyParam(a.position)),t.postMessage("world body "+this.id+" quaternion = "+s.stringifyParam(a.quaternion)),this.el.components.shape&&this.el.components.shape.play();let e=this.el.querySelectorAll("[shape]");e&&e.forEach((t=>{t.components.shape&&t.components.shape.play()})),this.el.components.joint&&this.el.components.joint.play();for(let t in this.el.components)"joint__"===t.substr(0,7)&&this.el.components[t].play()})),this.data.autoShape&&!this.el.components.shape)if(this.el.firstElementChild){let t=this.el.querySelectorAll("a-box, a-sphere, a-cylinder");t&&t.forEach((t=>{t.components.shape||t.setAttribute("shape",!0)}))}else this.el.setAttribute("shape",!0);this._initiated=!0},play(){this._initiated||(this.init(),this.update({}))},update(t){let e=this.el.sceneEl.systems.physics.worker;e&&(this.data.type!==t.type&&e.postMessage("world body "+this.id+" type = "+s.stringifyParam(this.data.type)),this.data.mass!==t.mass&&e.postMessage("world body "+this.id+" mass = "+s.stringifyParam(this.data.mass)),this.data.friction!==t.friction&&e.postMessage("world body "+this.id+" friction = "+s.stringifyParam(this.data.friction)),this.data.restitution!==t.restitution&&e.postMessage("world body "+this.id+" restitution = "+s.stringifyParam(this.data.restitution)),this.data.belongsTo!==t.belongsTo&&e.postMessage("world body "+this.id+" belongsTo = "+s.stringifyParam(this.data.belongsTo)),this.data.collidesWith!==t.collidesWith&&e.postMessage("world body "+this.id+" collidesWith = "+s.stringifyParam(this.data.collidesWith)),this.data.emitsWith!==t.emitsWith&&e.postMessage("world body "+this.id+" emitsWith = "+s.stringifyParam(this.data.emitsWith)),setTimeout((()=>{e.postMessage("world body "+this.id+" sleeping = "+!!this.data.sleeping)})))},sleep(){let t=this.el.sceneEl.systems.physics.worker;t&&(t.postMessage("world body "+this.id+" sleeping = true"),this.sleeping=!0)},applyWorldImpulse(t,e){let i=this.el.sceneEl.systems.physics.worker;i&&i.postMessage("world body "+this.id+" impulse "+s.stringifyParam(t)+" "+s.stringifyParam(e))},applyLocalImpulse(t,e){let i=this.el.object3D.localToWorld(THREE.Vector3.temp().copy(e)),s=this.el.object3D.localToWorld(THREE.Vector3.temp().copy(t)).sub(this.el.object3D.localToWorld(THREE.Vector3.temp().set(0,0,0)));this.applyWorldImpulse(s,i)},pause(){let t=this.el.sceneEl.systems.physics.worker,e=this.el.sceneEl.systems.physics.bodies,i=this.el.sceneEl.systems.physics.movingBodies;if(!t)return;this.el.components.joint&&this.el.components.joint.pause();for(let t in this.el.components)"joint__"===t.substr(0,7)&&this.el.components[t].pause();let s=this.el.querySelectorAll("[shape]");s&&s.forEach((t=>{t.components.shape&&t.components.shape.pause()})),this.el.components.shape&&this.el.components.shape.pause(),e[this.id]=null,null!==this.mid&&(i[this.mid]=null),t.postMessage("world body "+this.id+" remove"),this._initiated=!1},tick(){let t=this.el.sceneEl.systems.physics.worker,e=this.el.sceneEl.systems.physics.buffers[0];if(t&&null!==this.mid){let t=8*this.mid;if(e.length<=t)return;if("kinematic"===this.data.type){let i=this.el.object3D.localToWorld(THREE.Vector3.temp().set(0,0,0));e[t++]=i.x,e[t++]=i.y,e[t++]=i.z,this.sleeping=!!e[t++];let s=this.el.object3D.getWorldQuaternion(THREE.Quaternion.temp());e[t++]=s.x,e[t++]=s.y,e[t++]=s.z,e[t++]=s.w}else if(e[t+1]){let i=THREE.Quaternion.temp();this.el.object3D.position.set(e[t++],e[t++],e[t++]),this.el.object3D.parent.worldToLocal(this.el.object3D.position),this.sleeping=!!e[t++],this.el.object3D.getWorldQuaternion(i),this.el.object3D.quaternion.multiply(i.conjugate().normalize()),i.set(e[t++],e[t++],e[t++],e[t++]),this.el.object3D.quaternion.multiply(i.normalize())}}},command(t){switch(t.shift()){case"emits":let e=t.shift();switch(e.event){case"collision":let t=this.el.sceneEl.systems.physics.bodies;if(e.body1=t[e.body1],e.body2=t[e.body2],!e.body1||!e.body2)return;e.shape1=e.body1.components.body.shapes[e.shape1],e.shape2=e.body2.components.body.shapes[e.shape2]}this.el.emit(e.event,e)}},eval(t){this.el.sceneEl.systems.physics.worker.postMessage("world body "+this.id+" eval "+s.stringifyParam(t))},commit(){let t=this.el.sceneEl.systems.physics.worker,e=THREE.Vector3.temp(),i=THREE.Quaternion.temp();this.el.object3D.localToWorld(e.set(0,0,0)),t.postMessage("world body "+this.id+" position "+s.stringifyParam(e)),this.el.object3D.getWorldQuaternion(i),t.postMessage("world body "+this.id+" quaternion "+s.stringifyParam(i))}})},{"../../libs/cmdCodec":39}],29:[function(t,e,i){const s=t("../../libs/cmdCodec");AFRAME.registerComponent("joint",{multiple:!0,schema:{type:{type:"string",default:"ball"},body1:{type:"selector"},body2:{type:"selector"},pivot1:{type:"vec3",default:{x:0,y:0,z:0}},pivot2:{type:"vec3",default:{x:0,y:0,z:0}},axis1:{type:"vec3",default:{x:0,y:1,z:0}},axis2:{type:"vec3",default:{x:0,y:1,z:0}},min:{type:"number",default:0},max:{type:"number",default:1},collision:{type:"boolean",default:!0}},play(){if(null!=this._id)return;let t=this.el.sceneEl.systems.physics.worker,e=this.el.sceneEl.systems.physics.joints;if(!t)return;if(!this.data.body1.components.body)return this._retry=setTimeout((()=>{this.play()}),256);if(!this.data.body2.components.body)return this._retry=setTimeout((()=>{this.play()}),256);this._id=e.indexOf(null),this._id<0&&(this._id=e.length),e[this._id]=this.el;let i={};i.type=this.data.type,i.body1=this.data.body1?this.data.body1.components.body.id:this.el.components.body.id,i.body2=this.data.body2.components.body.id,i.pivot1=THREE.Vector3.temp().copy(this.data.pivot1),i.pivot2=THREE.Vector3.temp().copy(this.data.pivot2),i.axis1=this.data.axis1,i.axis2=this.data.axis2,i.min=this.data.min,i.max=this.data.max,i.collision=this.data.collision;let o=this.el.object3D.getWorldScale(THREE.Vector3.temp());i.pivot1.multiply(o),i.pivot2.multiply(o),t.postMessage("world joint "+this._id+" create "+s.stringifyParam(i))},update(t){this.el.sceneEl.systems.physics.worker&&(this.data.body1=this.data.body1||this.el)},pause(){clearTimeout(this._retry);let t=this.el.sceneEl.systems.physics.worker,e=this.el.sceneEl.systems.physics.joints;t&&(e[this._id]=null,t.postMessage("world joint "+this._id+" remove"),this._id=null)},eval(t){this.el.sceneEl.systems.physics.worker.postMessage("world joint "+this._id+" eval "+s.stringifyParam(t))}})},{"../../libs/cmdCodec":39}],30:[function(t,e,i){const s=t("../../libs/cmdCodec");AFRAME.registerComponent("shape",{schema:{},play(){if(null!=this.id)return;let t=this.el.sceneEl.systems.physics.worker;if(!t)return;for(this.body=this.el;this.body&&!this.body.matches("[body]");)this.body=this.body.parentElement;if(!this.body)return this._retry=setTimeout((()=>{this.play()}),256);this.bodyId=this.body.components.body.id;let e=this.body.components.body.shapes;this.id=e.indexOf(null),this.id<0&&(this.id=e.length),e[this.id]=this.el;let i={};i.position=this.el.object3D.getWorldPosition(THREE.Vector3.temp()),this.body.object3D.worldToLocal(i.position),i.quaternion=this.el.object3D.getWorldQuaternion(THREE.Quaternion.temp());let o=this.body.object3D.getWorldQuaternion(THREE.Quaternion.temp());switch(i.quaternion.multiply(o.conjugate().normalize()).normalize(),i.size=THREE.Vector3.temp().set(1,1,1),this.el.tagName.toLowerCase()){case"a-sphere":i.type="sphere",i.size.multiplyScalar(2*this.el.components.geometry.data.radius);break;case"a-cylinder":i.type="cylinder",i.size.multiplyScalar(2*this.el.components.geometry.data.radius).y=this.el.components.geometry.data.height;break;case"a-box":i.type="box",i.size.set(this.el.components.geometry.data.width,this.el.components.geometry.data.height,this.el.components.geometry.data.depth)}let a=this.el.object3D.getWorldScale(THREE.Vector3.temp());i.size.multiply(a),i.position.multiply(a),t.postMessage("world body "+this.bodyId+" shape "+this.id+" create "+s.stringifyParam(i))},pause(){if(clearTimeout(this._retry),!this.body)return;let t=this.el.sceneEl.systems.physics.worker;if(!t)return;let e=this.body.components.body.shapes;t.postMessage("world body "+this.bodyId+" shape "+this.id+" remove"),e[this.id]=null,this.id=null},eval(t){this.el.sceneEl.systems.physics.worker.postMessage("world body "+this.bodyId+" shape "+this.id+" eval "+s.stringifyParam(t))}})},{"../../libs/cmdCodec":39}],31:[function(t,e,i){AFRAME.registerComponent("injectbeaker",{schema:{name:{default:" Appareil"},volume:{type:"string",default:"100ml"},solute:{type:"number",default:.1},percent:{type:"number",default:.2},opacity:{default:" 0.2"},colorliq:{default:"#eef"},position:{default:"0 0 0"},rotation:{default:"0 0 0"},scale:{default:"1 1 1"}},init(){switch(console.log(this),this.data.volume){case"100ml":this.beackergltf="#b100",this.beackervolumeheight=.07,this.beackervolumediameter=.028;break;case"250ml":this.beackergltf="#b250",this.beackervolumeheight=250,this.beackervolumediameter=.028;break;case"500ml":this.beackergltf="#b500",this.beackervolumeheight=500,this.beackervolumediameter=100;break;default:this.beackergltf="#b100",this.beackervolumeheight=.07,this.beackervolumediameter=.028}this.el.ensure("a-gltf-model","a-gltf-model",{src:this.beackergltf,class:"matlabo1",scale:"1 1 1"}),this.el.setAttribute("class","laboratory"),this.el.setAttribute("shape","cylinder"),this.el.setAttribute("body","type","kinematic"),this.el.setAttribute("body","restitution","0"),this.containlevel=this.data.percent*this.beackervolumeheight,this.containlevely=0+this.containlevel/2,console.log("les données  couleur = "+this.data.colorliq+"   water level y  ="+this.containlevely+"   containlevel  ="+this.containlevel+"  this.data.volume ="+this.data.volume);this.el.querySelector("a-gltf-model").ensure("a-cylinder","a-cylinder",{color:this.data.colorliq,class:"cyl",height:this.containlevel,radius:this.beackervolumediameter,position:{x:0,y:this.containlevely,z:0},opacity:this.data.opacity,transparent:"true"})},update(t){this.el.addEventListener("click",this.levelw),this.el.addEventListener("drop",this.dropb)},tick(){},levelw(){console.log("ceci = "+this),this.schema=this.el.querySelector(".cyl"),this.data.percent=this.el.components.injectbeaker.el.childNodes[2].childNodes[2].components["gui-slider"].data.percent,this.data.percentsolute=this.el.components.injectbeaker.el.childNodes[2].children[4].components["gui-slider"].data.percent,this.dataopacity=this.data.percentsolute/this.data.percent,console.log("opafitu ="+this.dataopacity),console.log("volume"+this.data.volume),console.log("solute ="+this.data.percentsolute),console.log("percent"+this.el.components.injectbeaker.el.childNodes[2].children[2].components["gui-slider"].data.percent),this.containlevel=this.data.percent*this.data.volume,this.containlevely=0+this.containlevel/2,this.el.emit("timetochange"),console.log(this.containlevel),this.schema.setAttribute("height",this.containlevel),this.schema.setAttribute("opacity",this.dataopacity),this.schema.setAttribute("position",{x:0,y:this.containlevely,z:0}),console.log(this.el.getAttribute("containlevel"))},dropb(){this.pannel=this.el.querySelector("a-gui-flex-container"),console.log(this.el.getAttribute("rotation")),this.el.is("grabbed")||(this.pannel.setAttribute("rotation","0 0 90"),console.log("je dropp!!!"),console.log(this.el.getAttribute("rotation")))}})},{}],32:[function(t,e,i){AFRAME.registerComponent("injectcylindergraduate",{schema:{name:{default:" Appareil"},solute:{type:"number",default:.1},percent:{type:"number",default:1},opacity:{default:" 0.2"},colorliq:{default:"#eef"},position:{default:"0 0 0"},rotation:{default:"0 0 0"},scale:{default:"1 1 1"}},init(){console.log(this);this.el;this.containlevel=.165*this.data.percent,this.containlevely=.015+this.containlevel/2,console.log("les données  couleur = "+this.data.colorliq+"   water level y  ="+this.containlevely+"   containlevel  ="+this.containlevel),this.el.setAttribute("class","laboratory"),this.el.setAttribute("shape","cylinder"),this.el.setAttribute("body","type","kinematic"),this.el.setAttribute("body","restitution","0"),this.el.ensure("a-gltf-model","a-gltf-model",{src:"#cy100",class:"matlabo1",scale:"1 1 1"}),this.el.querySelector("a-gltf-model").ensure("a-cylinder","a-cylinder",{color:this.data.colorliq,class:"cyl",height:this.containlevel,radius:"0.01",position:{x:0,y:this.containlevely,z:0},opacity:this.data.opacity,transparent:"true"}),this.levelw=AFRAME.utils.bind(this.levelw,this),this.dropb=AFRAME.utils.bind(this.dropb,this),this.levelw,this.el.addEventListener("click",this.levelw)},update(t){this.el.addEventListener("click",this.levelw),this.el.addEventListener("drop",this.dropb)},tick(){},levelw(){console.log(this),this.schema=this.el.querySelector(".cyl"),this.data.percent=this.el.components.injectcylindergraduate.el.childNodes[2].children[2].components["gui-slider"].data.percent,this.data.percentsolute=this.el.components.injectcylindergraduate.el.childNodes[2].children[4].components["gui-slider"].data.percent,this.dataopacity=this.data.percentsolute/this.data.percent,console.log("opafitu ="+this.dataopacity),console.log("volume"+this.data.volume),console.log("solute ="+this.data.percentsolute),console.log("percent"+this.el.components.injectcylindergraduate.el.childNodes[2].children[2].components["gui-slider"].data.percent),this.containlevel=this.data.percent*this.data.volume*.00165,this.containlevely=.015+this.containlevel/2,this.el.emit("timetochange"),console.log(this.containlevel),this.schema.setAttribute("height",this.containlevel),this.schema.setAttribute("opacity",this.dataopacity),this.schema.setAttribute("position",{x:0,y:this.containlevely,z:0}),console.log(this.el.getAttribute("containlevel"))},dropb(){this.pannel=this.el.querySelector("a-gui-flex-container"),console.log(this.el.getAttribute("rotation")),this.el.is("grabbed")||(this.pannel.setAttribute("rotation","0 0 90"),console.log("je dropp!!!"),console.log(this.el.getAttribute("rotation")))}})},{}],33:[function(t,e,i){AFRAME.registerComponent("injecterlenmeyer",{schema:{name:{default:" Appareil"},volume:{type:"number",default:100},solute:{type:"number",default:.1},percent:{type:"number",default:1},opacity:{default:" 0.2"},colorliq:{default:"#eef"},position:{default:"0 0 0"},rotation:{default:"0 0 0"},scale:{default:"1 1 1"}},init(){console.log(this),this.datawaterlevel=this.data.percent*this.data.volume*1.12,this.waterlevely=-.1*(1-this.data.percent)+this.datawaterlevel,console.log("les données  couleur = "+this.data.colorliq+"   water level y  ="+this.waterlevely+"   waterlevel  ="+this.datawaterlevel+"  this.data.volume ="+this.data.volume),this.el.setAttribute("class","laboratory"),this.el.setAttribute("shape","cylinder"),this.el.setAttribute("body","type","kinematic"),this.el.setAttribute("body","restitution","0"),this.el.ensure("a-gltf-model","a-gltf-model",{src:"#erl100",class:"matlabo1",scale:"1 1 1"}),this.el.querySelector("a-gltf-model").ensure("a-cone","a-cone",{color:this.data.colorliq,class:"cyl","radius-bottom":"0.04","radius-top":"0.017",height:this.datawaterlevel,position:{x:0,y:this.waterlevely,z:0},opacity:this.data.opacity,transparent:"true"}),this.levelw=AFRAME.utils.bind(this.levelw,this),this.dropb=AFRAME.utils.bind(this.dropb,this),this.levelw,this.el.addEventListener("click",this.levelw)},update(t){this.el.addEventListener("click",this.levelw),this.el.addEventListener("drop",this.dropb)},tick(){},update(t){this.el.addEventListener("click",this.levelw),this.el.addEventListener("drop",this.dropb)},tick(){},levelw(){console.log(this),this.schema=this.el.querySelector(".cyl"),this.data.percent=this.el.components.injecterlenmeyer.el.childNodes[2].children[2].components["gui-slider"].data.percent,this.data.percentsolute=this.el.components.injecterlenmeyer.el.childNodes[2].children[4].components["gui-slider"].data.percent,this.dataopacity=this.data.percentsolute/this.data.percent,console.log("opafitu ="+this.dataopacity),console.log("volume"+this.data.volume),console.log("solute ="+this.data.percentsolute),console.log("percent"+this.el.components.injecterlenmeyer.el.childNodes[2].children[2].components["gui-slider"].data.percent),this.waterlevel=this.data.percent*this.data.volume*1.12,console.log(this.waterlevel),this.waterlevely=-.1*(1-this.data.percent)+this.datawaterlevel,this.schema.setAttribute("radius-bottom",.04),this.schema.setAttribute("radius-top","0.017"),this.el.emit("timetochange"),console.log("niveau liquide = "+this.waterlevel),this.schema.setAttribute("height",this.waterlevel),this.schema.setAttribute("opacity",this.dataopacity),this.schema.setAttribute("position",{x:0,y:this.waterlevely,z:0}),console.log(this.el.getAttribute("waterlevel"))},dropb(){this.pannel=this.el.querySelector("a-gui-flex-container"),console.log(this.el.getAttribute("rotation")),this.el.is("grabbed")||(this.pannel.setAttribute("rotation","0 0 90"),console.log("je dropp!!!"),console.log(this.el.getAttribute("rotation")))}})},{}],34:[function(t,e,i){AFRAME.registerComponent("injectglasses",{schema:{volume:{default:"500ml"},waterlevel:{default:"0.2"},opacity:{default:" 0.2"},colorliq:{default:"#eef"},position:{default:"0 0 0"},rotation:{default:"0 0 0"},scale:{default:"1 1 1"}},init(){this.el;console.log("lesd données"+this.data.colorliq),this.el.setAttribute("class","science"),this.el.setAttribute("shape","cylinder"),this.el.setAttribute("body","type","kinematic"),this.el.setAttribute("body","restitution","0"),this.el.innerHTML='<a-entity id="matlabo7" gltf-model="#lunettes" ><a-box id="sete" visible="true"  material="color:blue; transparent:true; opacity:0.3:" position="0 0 0" width="0.2" height="0.1"  depth="0.05" event-set__hoveron="_event: hover-start;  material.opacity: 0.7; transparent: true;" ></a-box> </a-entity>'},update(t){},tick(){}})},{}],35:[function(t,e,i){AFRAME.registerComponent("injecttesttube",{schema:{name:{default:" Appareil"},solute:{type:"number",default:.1},percent:{type:"number",default:.2},opacity:{default:" 0.2"},colorliq:{default:"#eef"},position:{default:"0 0 0"},rotation:{default:"0 0 0"},scale:{default:"1 1 1"}},init(){console.log(this);this.el;this.containlevel=.08*this.data.percent,this.containlevely=0+this.containlevel/2,console.log("les données  couleur = "+this.data.colorliq+"   water level y  ="+this.containlevely+"   containlevel  ="+this.containlevel+"  this.data.volume ="+this.data.volume),this.el.setAttribute("class","science"),this.el.setAttribute("shape","cylinder"),this.el.setAttribute("body","type","kinematic"),this.el.setAttribute("body","restitution","0"),this.el.ensure("a-gltf-model","a-gltf-model",{src:"#eprou1",class:"matlabo1",scale:"1 1 1"}),this.el.querySelector("a-gltf-model").ensure("a-cylinder","a-cylinder",{color:this.data.colorliq,class:"cyl",height:this.containlevel,radius:"0.007",position:{x:0,y:this.containlevely,z:0},opacity:this.data.opacity,transparent:"true"}),this.levelw=AFRAME.utils.bind(this.levelw,this),this.dropb=AFRAME.utils.bind(this.dropb,this),this.levelw,this.el.addEventListener("click",this.levelw)},update(t){this.el.addEventListener("click",this.levelw),this.el.addEventListener("drop",this.dropb)},tick(){},levelw(){console.log("ceci = "+this),this.schema=this.el.querySelector(".cyl"),this.data.percent=this.el.components.injecttesttube.el.childNodes[2].childNodes[2].components["gui-slider"].data.percent,this.data.percentsolute=this.el.components.injecttesttube.el.childNodes[2].children[4].components["gui-slider"].data.percent,this.dataopacity=this.data.percentsolute/this.data.percent,console.log("opafitu ="+this.dataopacity),console.log("volume"+this.data.volume),console.log("solute ="+this.data.percentsolute),console.log("percent"+this.el.components.injecttesttube.el.childNodes[2].children[2].components["gui-slider"].data.percent),this.containlevel=this.data.percent*this.data.volume,this.containlevely=0+this.containlevel/2,this.el.emit("timetochange"),console.log(this.containlevel),this.schema.setAttribute("height",this.containlevel),this.schema.setAttribute("opacity",this.dataopacity),this.schema.setAttribute("position",{x:0,y:this.containlevely,z:0}),console.log(this.el.getAttribute("containlevel"))},dropb(){this.pannel=this.el.querySelector("a-gui-flex-container"),console.log(this.el.getAttribute("rotation")),this.el.is("grabbed")||(this.pannel.setAttribute("rotation","0 0 90"),console.log("je dropp!!!"),console.log(this.el.getAttribute("rotation")))}})},{}],36:[function(require,module,exports){AFRAME.registerComponent("script",{schema:{src:{type:"string"},call:{type:"string"},args:{type:"array"}},async update(oldData){if(this.data.src!==oldData.src){this.script&&(this.el.isPlaying&&this.script.pause?.(),this.script.remove?.()),this.script=null;let response=await fetch(this.data.src);if(response.status>=200&&response.status<300){if(this.script=eval(await await response.text()),this.script.el=this.el,this.script.events)for(let t in this.script.events)this.script.events[t]=this.script.events[t].bind(this.script)}else console.error("Could not load",this.data.src);this.script.init?.(),this.el.isPlaying&&this.script.play?.()}this.script&&this.data.call?.trim()&&(this.script[this.data.call.trim()](...this.data.args),this.el.setAttribute("script","call",""))},remove(){this.script&&this.script.remove?.(...arguments)},tick(){this.script&&this.script.tick?.(...arguments)},tock(){this.script&&this.script.tock?.(...arguments)},play(){if(this.script){if(this.script.events)for(let t in this.script.events)this.el.addEventListener(t,this.script.events[t]);this.script.play?.(...arguments)}},pause(){if(this.script){if(this.script.events)for(let t in this.script.events)this.el.removeEventListener(t,this.script.events[t]);this.script.pause?.(...arguments)}}})},{}],37:[function(t,e,i){AFRAME.registerComponent("trigger",{schema:{objects:{type:"string",default:".head-bumper"}},init(){this._refreshTO=setInterval(this.refreshObjects.bind(this),1024)},remove(){clearInterval(this._refreshTO)},tick(){if(!this.objects)return this.refreshObjects();let t,e=THREE.Vector3.temp(),i=this.el.components.geometry.data.width,s=this.el.components.geometry.data.height,o=this.el.components.geometry.data.depth,a=this.el.components.geometry.data.radius;for(let n of this.objects){switch(n.object3D.localToWorld(e.set(0,0,0)),this.el.object3D.worldToLocal(e),this.el.tagName.toLowerCase()){case"a-sphere":t=e.length()<a;break;case"a-box":t=Math.abs(e.x)<i/2&&Math.abs(e.y)<s/2&&Math.abs(e.z)<o/2;break;case"a-cylinder":t=Math.abs(e.y)<s/2,e.y=0,t=t&&e.length()<a}if(t&&this.triggered.indexOf(n)<0){let t={trigger:this.el,object:n};this.el.addState("triggered"),this.el.emit("trigger",t),n.emit("trigger",t),this.triggered.push(n)}if(!t&&this.triggered.indexOf(n)>=0){let t={trigger:this.el,object:n};this.el.emit("untrigger",t),n.emit("untrigger",t),this.triggered.splice(this.triggered.indexOf(n),1),this.triggered.length||this.el.removeState("triggered")}}},refreshObjects(){this.objects=this.objects||[],this.triggered=this.triggered||[],this.objects.splice(0,this.objects.length);let t=this.el.sceneEl.querySelectorAll(this.data.objects);if(t){t.forEach((t=>{this.objects.push(t)}));for(let t=0;t<this.triggered.length;t++){let e=this.triggered[t];this.objects.indexOf(e)<0&&(this.triggered.splice(t,1),t--)}}}})},{}],38:[function(t,e,i){const s=AFRAME.components.raycaster.Component.prototype.update,o=AFRAME.components.raycaster.Component.prototype.refreshObjects;function a(t){if(t.indexOf("*")>=0)return t;return(t+", ").replaceAll(","," *,")+t}AFRAME.components.raycaster.schema.deep=AFRAME.components.raycaster.schema.showLine,AFRAME.components.raycaster.Component.prototype.update=function(t){return this.data.deep&&t.objects!==this.data.objects&&(this._matchSelector=this.data.objects,this.data.objects=a(this.data.objects)),s.apply(this,arguments)},AFRAME.components.raycaster.Component.prototype.refreshObjects=function(){let t=o.apply(this,arguments);if(this.data.deep){let t=this.intersections;for(let e of t)for(e.el=e.object.el;e.el&&!e.el.matches(this._matchSelector);)e.el=e.el.parentNode}return t}},{}],39:[function(t,e,i){e.exports={parse(t){let e=t.split(" "),i=[];for(let t of e)if(t)try{i.push(JSON.parse(t))}catch(e){"="!==t&&i.push(t)}return i},stringifyParam:t=>JSON.stringify(t).replaceAll(" ","\\u0020").replaceAll('"_','"')}},{}],40:[function(t,e,i){AFRAME.AEntity.prototype.copyWorldPosRot=function(t){let e=THREE.Quaternion.temp(),i=t.object3D,s=this.object3D;i&&s&&s.parent&&(i.localToWorld(s.position.set(0,0,0)),s.parent.worldToLocal(s.position),s.getWorldQuaternion(e),s.quaternion.multiply(e.conjugate().normalize()),i.getWorldQuaternion(e),s.quaternion.multiply(e.normalize()),s.updateWorldMatrix(!0,!0))}},{}],41:[function(t,e,i){Element.prototype.ensure=function(t,e=t,i={},s=""){let o,a,n;if(o=this.querySelector(t),!o){for(a in o=document.createElement(e),this.appendChild(o),i)n=i[a],o.setAttribute(a,n);o.innerHTML=s}return o}},{}],42:[function(t,e,i){function s(t){t._pool=[],t._inUse=[],t.temp=function(){let e=t._pool.pop()||new t;return t._inUse.push(e),t._gc||(t._gc=setTimeout(t._recycle)),e},t._recycle=function(){for(;t._inUse.length;)t._pool.push(t._inUse.pop());t._gc=!1}}s(THREE.Vector2),s(THREE.Vector3),s(THREE.Quaternion),s(THREE.Matrix3),s(THREE.Matrix4)},{}],43:[function(t,e,i){let s=Element.prototype.addEventListener,o=Element.prototype.removeEventListener,a=t=>{if(t._tgest)return t._tgest;let e,i,s,o;t._tgest={handlers:{swipeup:[],swipedown:[],swipeleft:[],swiperight:[],tap:[],hold:[]}};let a=(e,i)=>{if(t._tgest.handlers[e])for(let s of t._tgest.handlers[e])s(i);else console.log(e,t._tgest.handlers[e])};return t.addEventListener("touchstart",(t=>{e=t.changedTouches[0].screenX,i=t.changedTouches[0].screenY,o=!1,s=setTimeout((()=>{o=!0,a("hold",t)}),512)})),t.addEventListener("touchmove",(t=>{let n=t.changedTouches[0].screenX,r=t.changedTouches[0].screenY;if(Math.sqrt(Math.pow(e-n,2)+Math.pow(i-r,2))>32){if(clearTimeout(s),o)return;Math.abs(e-n)>Math.abs(i-r)?a(n<e?"swipeleft":"swiperight",t):a(r<i?"swipeup":"swipedown",t),o=!0}})),t.addEventListener("touchend",(t=>{clearTimeout(s);let n=t.changedTouches[0].screenX,r=t.changedTouches[0].screenY;if(Math.sqrt(Math.pow(e-n,2)+Math.pow(i-r,2))<32){if(o)return;a("tap",t)}})),t._tgest};Element.prototype.addEventListener=function(t,e){switch(t){case"swipeup":case"swipedown":case"swipeleft":case"swiperight":case"tap":case"hold":a(this).handlers[t].push(e);break;default:return s.call(this,t,e)}},Element.prototype.removeEventListener=function(t,e){switch(t){case"swipeup":case"swipedown":case"swipeleft":case"swiperight":case"tap":case"hold":let i=a(this),s=i.handlers[t].indexOf(e);s>=0&&i.handlers[t].splice(s,1);break;default:return o.call(this,t,e)}}},{}],44:[function(t,e,i){AFRAME.registerPrimitive("a-beaker",{defaultComponents:{injectbeaker:{},position:{},rotation:{},scale:{}},mappings:{name:"injectbeaker.name",solute:"injectbeaker.solute",volume:"injectbeaker.volume",percent:"injectbeaker.percent",opacity:"injectbeaker.opacity",colorliq:"injectbeaker.colorliq"}})},{}],45:[function(t,e,i){AFRAME.registerPrimitive("a-cylindergraduate",{defaultComponents:{injectcylindergraduate:{},position:{},rotation:{},scale:{}},mappings:{name:"injectcylindergraduate.name",solute:"injectcylindergraduate.solute",volume:"injectcylindergraduate.volume",percent:"injectcylindergraduate.percent",opacity:"injectcylindergraduate.opacity",colorliq:"injectcylindergraduate.colorliq"}})},{}],46:[function(t,e,i){AFRAME.registerPrimitive("a-erlenmeyer",{defaultComponents:{injecterlenmeyer:{},position:{},rotation:{},scale:{}},mappings:{name:"injecterlenmeyer.name",solute:"injecterlenmeyer.solute",volume:"injecterlenmeyer.volume",percent:"injecterlenmeyer.percent",opacity:"injecterlenmeyer.opacity",colorliq:"injecterlenmeyer.colorliq"}})},{}],47:[function(t,e,i){AFRAME.registerPrimitive("a-fluorescent",{defaultComponents:{geometry:{primitive:"cylinder",radius:.05,height:1},material:{color:"white",roughness:0,metalness:.5,opacity:.7,shader:"standard",emissive:"white",emissiveIntensity:45,ambientOcclusionMapIntensity:1},rotation:{},position:{},scale:{},injectfluo:{}},mappings:{intensity:"injectfluo.intensity"}})},{}],48:[function(t,e,i){AFRAME.registerPrimitive("a-glasses",{defaultComponents:{injectglasses:{},position:{},rotation:{},scale:{}},mappings:{volume:"injectglasses.volume",waterlevel:"injectglasses.waterleve",opacity:"injectglasses.opacity",colorliq:"injectglasses.colorliq"}})},{}],49:[function(t,e,i){AFRAME.registerPrimitive("a-glove",{defaultComponents:{injectglove:{}}})},{}],50:[function(t,e,i){AFRAME.registerPrimitive("a-hand",{mappings:{side:"tracked-controls.hand"}})},{}],51:[function(t,e,i){AFRAME.registerPrimitive("a-laboratory",{})},{}],52:[function(t,e,i){AFRAME.registerPrimitive("a-main",{})},{}],53:[function(t,e,i){AFRAME.registerPrimitive("a-player",{defaultComponents:{injectplayer:{}}})},{}],54:[function(t,e,i){AFRAME.registerPrimitive("a-testtube",{defaultComponents:{injecttesttube:{},position:{},rotation:{},scale:{}},mappings:{name:"injecttesttube.name",solute:"injecttesttube.solute",volume:"injecttesttube.volume",percent:"injecttesttube.percent",opacity:"injecttesttube.opacity",colorliq:"injecttesttube.colorliq"}})},{}],55:[function(t,e,i){AFRAME.registerState({initialState:{device:"desktop"},handlers:{setDevice:function(t,e){t.device=e}}}),AFRAME.registerComponent("device-changer",{init:function(){this.el.addEventListener("click",(t=>{this.el.sceneEl.emit("setDevice",t.target.getAttribute("name").value.toLowerCase())}))}})},{}],56:[function(t,e,i){AFRAME.registerComponent("laboratory",{schema:{},init(){document.querySelector("a-scene"),document.querySelector("laboratory");this.run=AFRAME.utils.bind(this.run,this),this.run()},update(){},remove(){},tick(t,e){},run(){var t=document.querySelector("a-laboratory"),e=Array.prototype.slice.call(t.querySelectorAll(".laboratory"));console.log("laboratoryitems "+e);var i=[];e.forEach((function(e,s){var o="";console.log(e.getAttribute("id")),console.log(e),console.log(e.getAttribute("name")),i[e.getAttribute("id")]=e.getAttribute("id"),o+=' \n                <a-gui-label\n                    id = "labela'+s+'"\n                    width="2.5" height="0.75"\n                    value="'+e.getAttribute("name")+'"\n                    font-family="assets/fonts/DiplomataSC-Regular.ttf"\n                    font-size="0.35"\n                    line-height="0.8"\n                    letter-spacing="0"\n                    margin="0 0 0.05 0"\n                >\n                </a-gui-label>\n                <a-gui-label\n                    width="2.5" height="0.75"\n                    value="V total"\n                    font-family="assets/fonts/DiplomataSC-Regular.ttf"\n                    font-size="0.35"\n                    line-height="0.8"\n                    letter-spacing="0"\n                    margin="0 0 0.05 0"\n                >\n                </a-gui-label>\n                <a-gui-slider \t\n                    id = "slider_v_'+e.getAttribute("id")+'"\n                    width="2.5" height="0.75"\n                    onclick="slideActionFunction"\n                    percent='+e.getAttribute("percent")+'\n                    margin="0 0 0.05 0"\n                    >\n                </a-gui-slider>\n                <a-gui-label\n                    width="2.5" height="0.75"\n                    value="Masse soluté"\n                    font-family="assets/fonts/DiplomataSC-Regular.ttf"\n                    font-size="0.35"\n                    line-height="0.8"\n                    letter-spacing="0"\n                    margin="0 0 0.05 0"\n                >\n                </a-gui-label>\n                <a-gui-slider \t\n                        id = "slider_sol_'+e.getAttribute("id")+'"\n                        width="2.5" height="0.75"\n                        onclick="slideActionFunction"\n                        percent='+e.getAttribute("opacity")+'\n                        margin="0 0 0.05 0"\n                >\n                </a-gui-slider>\n                ',t.ensure(".a-gui-flex-container"+s,"a-gui-flex-container",{"flex-direction":"column","justify-content":"center","align-items":"normal","component-padding":"0.1",opacity:"0.7",width:"3",height:"4.5",position:0+.3*s+" 1.5 -1",rotation:"0 0 0",scale:"0.1 0.1 0.1"},o)}))}})},{}]},{},[2]);
