<!doctype html>
<html lang="fr">
    
    <head>
        <title>WebXR Application</title>
        <link rel="icon" type="image/png" href="favicon.ico"/>
        <meta name="description" content="3D Application">
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="./js/aframe-v1.3.0.min.js"></script>
        <script src="./js/aframe-environment-component.min.js"></script>
        <script src="./js/aframe-extras.min.js"></script>
        <script src="./js/aframe-animation-timeline-component.min.js"></script>
        <script src="./js/a-recit.js"></script>
        <script src="./js/aframe-proxemic-component.js"></script> 
        <script src="./js/aframe-haptics-component.min.js"></script>
        <script src="./js/aframe-gui.js"></script>
        <script src="./js/gui-env.js"></script>
        <script type="text/javascript" src="./js/webxr.js"></script>
        <script type="text/javascript" src="./js/joystick.js"></script>
        <script type="text/javascript" src="./js/camera-cube-env.js"></script>
      
        <!-- CSS only -->
        <link rel="stylesheet" type="text/css" href="./style.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"
          integrity="sha512-5A8nwdMOWrSz20fDsjczgUidUBR8liPYU+WymTZP1lmY9G6Oc7HlZv156XqnsgNUzTyMefFTcsFH/tnJE/+xBg=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
          integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />
        <!-- Custom CSS -->
      <style>
        .a-enter-ar-button, .a-enter-vr-button {
         left:40px;
          top:100px; 
          
          padding:12px;
        }
      </style>
      
      
        <!-- Bootstrap Dependencies -->
        <link rel="stylesheet" href="./bootstrap/bootstrap4.min.css">
        <script src="./bootstrap/jquery-3.2.1.slim.min.js" "></script>
       <script src=" ./bootstrap/popper.min.js"></script>
        <script src="./bootstrap/bootstrap.min.js"></script>
        <link rel="stylesheet" href="./assets/css/style.css" />
      
      
        <!-- ==================== 
          REGISTER OUR COMPONENT
        ========================= -->
      
      
        <script>
          AFRAME.registerComponent('boutonmontecharge', {
            schema: {
              montecr: {}
            },
            init: function () {
              this.el.sceneEl.sta = 1
              
      
              console.log(this.data.montecr)
              this.el.addEventListener("click", e => {
                switch (this.el.sceneEl.sta) {
                  case 1:
                    this.el.setAttribute("animation-mixer", "clip: monte; loop:once;")
                    this.el.sceneEl.emit('monter', null, true);
                    console.log("emit monter");
                    this.el.sceneEl.sta = 2
                    break;
                  case 2:
                  this.el.setAttribute("animation-mixer", "clip: descend; loop:once;")
                    this.el.sceneEl.emit('descendre', null, true);
                    console.log("emit descendre");
                    this.el.sceneEl.sta = 1
                    break;
                }
              })
              this.el.addEventListener("press", e => {
                switch (this.el.sceneEl.sta) {
                  case 1:
                  this.el.setAttribute("animation-mixer", "clip: monte; loop:once;")
                    this.el.sceneEl.emit('monter', null, true);
                    console.log("emit monter");
                    this.el.sceneEl.sta = 2
                    break;
                  case 2:
                  this.el.setAttribute("animation-mixer", "clip: descend; loop:once;")
                    this.el.sceneEl.emit('descendre', null, true);
                    console.log("emit descendre");
                    this.el.sceneEl.sta = 1
                    break;
                  
                }
              })
      
            },
      })
         
      function init()  {
        var scene = document.querySelector('a-scene');
        var plyr = scene.querySelector('a-player');
        console.log(plyr)
        var cam1 = document.querySelector('#camera1');
        
        var cam2 = document.querySelector('#camera2');
       
        {cam1.setAttribute('camera', 'active', true);
        plyr.setAttribute('visible', false);
        cam2.setAttribute('camera', 'active', false);
        console.log("camera 1 activate first")}
        
      }
      
        
      
      
      
      
      
      
        </script>
      
      
      </head>
      
      <body>
      
      
        <div id="aframe">
      
        <a-scene id="a-scene" onload="init();" 
          preloader
              
          animation-timeline__1="timeline: #animnacelle; loop: false; startEvents: monter " 
          animation-timeline__2="timeline: #animnacelle2; loop: false; startEvents: descendre " 
          joystick 
          isMobile
          physics="workerUrl:./js/cannonWorker.min.js; gravity:0 -10 0; debug: true;"
          shadow="enabled:true; type: basic; autoUpdate: true;"
          renderer="colorManagement: false; physicallyCorrectLights: false; precision: mediump; antialias: false; alpha: true; logarithmicDepthBuffer: true; ">
          <a-assets timeout="100000">
            <a-timeline id="animnacelle">
              <a-timeline-group>
                <a-timeline-animation select="#l1" name="pasvoir">
                </a-timeline-animation>
                <a-timeline-animation select="#l2" name="pasvoir">
                </a-timeline-animation>
                <a-timeline-animation select="#poulie13" name="tournepoulie">
                </a-timeline-animation>
                <a-timeline-animation select="#box1" name="mouvedown">
                </a-timeline-animation>
                <a-timeline-animation select="#box2" name="mouveup">
                </a-timeline-animation>
                <a-timeline-animation select="#c1" name="mouveup">
                </a-timeline-animation>
                <a-timeline-animation select="#c1" name="mouveup2">
                </a-timeline-animation>
                <a-timeline-animation select="#nacelle1" name="mouveup">
                </a-timeline-animation>
                <a-timeline-animation offset="2900" select="#l1" name="voir">
                
              </a-timeline-animation>
              </a-timeline-group>
              
            </a-timeline>
            <a-timeline id="animnacelle2">
              <a-timeline-group offset="">
                <a-timeline-animation select="#l1" name="pasvoir">
                </a-timeline-animation>
                <a-timeline-animation select="#l2" name="pasvoir">
                </a-timeline-animation>
                <a-timeline-animation select="#nacelle1" name="mouvedown">
                </a-timeline-animation>
                <a-timeline-animation select="#box2" name="mouvedown">
                </a-timeline-animation>
                <a-timeline-animation select="#box1" name="mouveup">
                </a-timeline-animation>
                <a-timeline-animation select="#c1" name="mouvedown">
                </a-timeline-animation>   
                <a-timeline-animation select="#c1" name="mouvedown2">
                </a-timeline-animation>
                <a-timeline-animation select="#poulie13" name="tournepoulierecule"></a-timeline-animation>
                <a-timeline-animation offset="2900" select="#l2" name="voir"></a-timeline-animation>
                  <a-timeline-animation offset="50" select="#l2" name="pasvoir"></a-timeline-animation>
              </a-timeline-animation>
              </a-timeline-group>
              
           </a-timeline>
            <a-mixin id="mouvenacelle"
              animation__mouveup="property: position; from:0.0135 .02 -0.005; to: 0.0135 .15 -0.005 ; loop: false;  dur: 3000; autoplay:false; "
              animation__mouvedown="property: position; from:0.0135 .15 -0.005; to: 0.0135 .02 -0.005 ; loop: false; dur: 3000; autoplay:false  ">
            </a-mixin>
            
            <a-mixin id="mouvebouton"
              animation__mouveup="property: rotation; from:0 -0.002 0.0055; to: 0 0 0.0055; loop: false;  dur: 3000; autoplay:false; "
              animation__mouvedown="property: position; from:0 0 0.0055; to: 0 -0.002 0.0055; loop: false; dur: 3000; autoplay:false  ">
            </a-mixin><a-mixin id="mouvebouton2"
              animation__mouveup="property: position; from:0 -0.002 0.0055; to: 0 0 0.0055; loop: false;  dur: 3000; autoplay:false; "
              animation__mouvedown="property: position; from:0 0 0.0055; to: 0 -0.002 0.0055; loop: false; dur: 3000; autoplay:false  ">
            </a-mixin>
            <a-mixin id="mouvebouton1"
              animation__mouveup="property: position; from:0 -0.002 -0.0055; to: 0 0 -0.0055; loop: false;  dur: 3000; autoplay:false; "
              animation__mouvedown="property: position; ffrom:0 0 -0.0055; to: 0 -0.002 -0.0055; loop: false; dur: 3000; autoplay:false  ">
            </a-mixin>
            <a-mixin id="mouvec1"
              animation__mouveup="property: height; from:0.165 ; to:0.035 ; loop: false;  dur: 3000; autoplay:false; "
              animation__mouveup2="property: position; from:0.0 .156 -0.016 ; to:0.0 .23 -0.016 ; loop: false;  dur: 3000; autoplay:false; "
              animation__mouvedown="property:   height; from:0.035 ; to:0.165 ; loop: false;  dur: 3000; autoplay:false;"
              animation__mouvedown2="property:   position; from:0.0 .23 -0.016 ; to:0.0 .156 -0.016 ; loop: false;  dur: 3000; autoplay:false;">
            </a-mixin>
            <a-mixin id="tourne"
              animation__tournepoulie="property: rotation; from: 0 0 0; to: 0 0 720; loop: false; dur: 3000; autoplay:false"
              animation__tournepoulierecule="property: rotation; from: 0 0 720; to: 0 0 0; loop: false; dur: 3000; autoplay:false">
            </a-mixin>
            <a-mixin id="voir1"
              animation__voir="property: visible; from: false; to: true; loop: false; dur: 1; autoplay:false"
              animation__pasvoir="property: visible; from: true; to: false; loop: false; dur: 1; autoplay:false">
            </a-mixin>
           
      
            <img id="floor" preload="true" src="./assets/floor.png">
            <img id="m1" preload="true" src="./assets/m1.png">
            <a-asset-item id="montenacelle" preload="true" response-type="arraybuffer"
                 src="./assets/bank/monte-charge_nacelle.gltf"></a-asset-item>
            <a-asset-item id="monte" preload="true" response-type="arraybuffer"
                src="./assets/bank/monte-charge_base2.gltf"></a-asset-item>
            <a-asset-item id="poulie" preload="true" response-type="arraybuffer"
                src="./assets/bank/poulie3.gltf"></a-asset-item>
            <a-asset-item id="mcbouton" bouton_montecharge preload="true" response-type="arraybuffer"
              src="./assets/bank/bouton3a1.gltf"></a-asset-item>
            <a-asset-item id="poste" preload="true" response-type="arraybuffer"
              src="./assets/bank/cube3.gltf"></a-asset-item>
          </a-assets>
          <a-box id="montcharge23A" height="0.001" width="0.001" depth="0.001""  position=".32 1.5 -1.9"></a-box>
  
            <a-camera id="camera1" camera="
                        active: true;
                        fov: 80;
                        zoom: 2;
                      " 
                      look-controls=" enabled: false; "
                      wasd-controls="enabled: false; "
                      position="1 1.6 1" 
                        orbit-controls="
                        target: #montcharge23A;
                        invertZoom: true;
                        autoRotate: false;
                        enableDamping: false;
                        dampingFactor: 0.125;
                        rotateTo: 0 3 3;
                        initialPosition: -1 0 0;
                        rotateSpeed:1;
                        minDistance: 0.1;
                        maxDistance: 1.8;
                      " cursor="rayOrigin: mouse" raycaster="objects:[button], [gui-interactable]" mouse-cursor="">
            </a-camera>
            <a-player locomotion grabbing enabled=false visible=false position="0 0.2 2">
                      
              <a-camera id="camera2" camera="
                        active: false; " 
                        look-controls=" enabled: false; pointerLockEnabled: true, touchEnabled: true "
                        wasd-controls="enabled: false; acceleration:12; "
                        position="0 1.6 0"
                        >   
                  
              </a-camera>
              <a-hand side="left" color="red"></a-hand>
              <a-hand side="right"oculus-touch-controls="hand: right" haptics="events: press; dur: 500; force: 1.0" color="blue"></a-hand>
          </a-player>
      
      
         <a-main> 
          <a-plane floor material="src:#floor; repeat: 700 700; transparent: true;" height="500" width="500"
            rotation="-90 0 0"></a-plane>
          <a-sky color="grey"></a-sky>
          <a-entity light="type: ambient;  intensity: 1"></a-entity>
          
      
            <a-gltf-model src="#poste" position="0.447 0 -2.131" rotation="0 -90 0"></a-gltf-model>
          <a-fluorescent id="flu1" position="0.5 4 4" rotation="90 90 0" intensity="2.5"></a-fluorescent>
          <a-fluorescent id="flu1" position="0 4 -6" rotation="90 90 0" intensity="2.5"></a-fluorescent>
            <a-entity id="montcharge23" position="0.2 0.92 -1.8" scale= "3 3 3">
              <a-gltf-model src="#monte" position="0.006 0 -0.012" rotation="0 0 0"></a-gltf-model>
              <a-gltf-model id="nacelle1" src="#montenacelle" mixin="mouvenacelle" position="0.0135 .02 -0.005"
                rotation="0 0 0"></a-gltf-model>
              <a-gltf-model id="bouton13" src="#mcbouton" position="0.093 0.22 -0.0015" boutonmontecharge button
                rotation="0 0 0"></a-gltf-model>
              
              <a-gltf-model id="poulie13" src="#poulie" body="type:kinematic" shape="cylinder" mixin="tourne"
                position="-0.0061 0.243 -0.01" rotation="0 0 0">
                <a-torus color="#000"  radius="0.007" radius-tubular="0.001" position="0 0 -0.007"></a-torus>
              </a-gltf-model>
          <!--à afficher-->
              <a-cylinder id="c1" color="#000" radius="0.001" height="0.16"  
                position="0.0 .156 -0.016"  mixin="mouvec1">
              </a-cylinder>
             
          
            <a-entity id="l1" mixin="voir1" position="0.09 0.125 0.04" visible ="false">
                  <a-sphere id="box3" color="red" radius=".01" opacity="0.4" ></a-sphere>
                  <a-light type="point" intensity="1" color="red" rotation=" 0 180 0" ></a-light>
      
            </a-entity>
            <a-entity id="l2" mixin="voir1"  position="0.09 0.02 0.04" visible ="false">
              <a-sphere id="box3" color="red" radius=".01" opacity="0.4" ></a-sphere>
              <a-light type="point" intensity="1" color="red" rotation=" 0 180 0" ></a-light>
      
        </a-entity>
          </a-main>
      
         
      
        </a-scene>
      </div>
      
      <div style="position:absolute; top:0; left:0; padding:12px;">
        <button class="btn btn-danger" onclick="handleSwitchCamera()" id="changeCamera">Changer la caméra</button>
        <label id="label1" class="form-control"  for="html">Mode ordinateur de bureau</label>
 </div>
        <script>
          function handleSwitchCamera() {
            console.log("got it!")
            var consinge = document.querySelector('#label1');
            var scene = document.querySelector('a-scene');
        var plyr = scene.querySelector('a-player');
        console.log(plyr)
        var cam1 = document.querySelector('#camera1');
        
        var cam2 = document.querySelector('#camera2');
        console.log(cam1.getAttribute("camera").active)
        console.log(cam2)
        if (cam1.getAttribute("camera").active) {
          plyr.setAttribute('visible', true);
          plyr.setAttribute('enabled', true);
          cam2.setAttribute('camera', 'active', true);
          cam2.setAttribute('look-controls','enabled',true );
          cam2.setAttribute('wasd-controls','enabled',true );
          consinge.innerHTML = "Mode Réalité virtuelle";
          cam1.setAttribute('camera', 'active', false);
          console.log("Camera 2 activate")}
        
        else {cam1.setAttribute('camera', 'active', true);
        plyr.setAttribute('visible', false);
        cam2.setAttribute('camera', 'active', false);
        cam2.setAttribute('look-controls','enabled',false );
        cam2.setAttribute('wasd-controls','enabled',false );
        consinge.innerHTML = "Mode ordinateur";
        console.log("Camera 1 activate")}
        }
       
        </script>
     
      
      
      
      
      </body>
      
      </html>