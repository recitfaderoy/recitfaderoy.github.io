!function(e){"use strict";class t extends e.Mesh{constructor(t){const o=new i(t),s=new e.PlaneGeometry(.001*o.image.width,.001*o.image.height),n=new e.MeshBasicMaterial({map:o,toneMapped:!1,transparent:!0});function r(e){n.map.dispatchDOMEvent(e)}super(s,n),this.addEventListener("mousedown",r),this.addEventListener("mousemove",r),this.addEventListener("mouseup",r),this.addEventListener("click",r),this.dispose=function(){s.dispose(),n.dispose(),n.map.dispose(),this.removeEventListener("mousedown",r),this.removeEventListener("mousemove",r),this.removeEventListener("mouseup",r),this.removeEventListener("click",r)}}}class i extends e.CanvasTexture{constructor(t){super(s(t)),this.dom=t,this.anisotropy=16,this.encoding=e.sRGBEncoding,this.minFilter=e.LinearFilter,this.magFilter=e.LinearFilter;const i=new MutationObserver((()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout((()=>this.update()),16))}));i.observe(t,{attributes:!0,childList:!0,subtree:!0,characterData:!0}),this.observer=i}dispatchDOMEvent(e){e.data&&function(e,t,i,o){const s={clientX:i*e.offsetWidth+e.offsetLeft,clientY:o*e.offsetHeight+e.offsetTop,view:e.ownerDocument.defaultView},n=e.getBoundingClientRect();function r(e){if(e.nodeType!==Node.TEXT_NODE&&e.nodeType!==Node.COMMENT_NODE){const n=e.getBoundingClientRect();if(i>n.left&&i<n.right&&o>n.top&&o<n.bottom&&(e.dispatchEvent(new MouseEvent(t,s)),e instanceof HTMLInputElement&&"range"===e.type&&("mousedown"===t||"click"===t))){const[t,o]=["min","max"].map((t=>parseFloat(e[t]))),s=n.width,r=(i-n.x)/s;e.value=t+(o-t)*r,e.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let t=0;t<e.childNodes.length;t++)r(e.childNodes[t])}}i=i*n.width+n.left,o=o*n.height+n.top,r(e)}(this.dom,e.type,e.data.x,e.data.y)}update(){this.image=s(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}const o=new WeakMap;function s(t){const i=document.createRange(),s=new e.Color;function n(e,t,i,o){""!==o&&("uppercase"===e.textTransform&&(o=o.toUpperCase()),h.font=e.fontWeight+" "+e.fontSize+" "+e.fontFamily,h.textBaseline="top",h.fillStyle=e.color,h.fillText(o,t,i+.1*parseFloat(e.fontSize)))}function r(e,t,i,o,s){i<2*s&&(s=i/2),o<2*s&&(s=o/2),h.beginPath(),h.moveTo(e+s,t),h.arcTo(e+i,t,e+i,t+o,s),h.arcTo(e+i,t+o,e,t+o,s),h.arcTo(e,t+o,e,t,s),h.arcTo(e,t,e+i,t,s),h.closePath()}function a(e,t,i,o,s,n){const r=e[t+"Width"],a=e[t+"Style"],l=e[t+"Color"];"0px"!==r&&"none"!==a&&"transparent"!==l&&"rgba(0, 0, 0, 0)"!==l&&(h.strokeStyle=l,h.lineWidth=parseFloat(r),h.beginPath(),h.moveTo(i,o),h.lineTo(i+s,o+n),h.stroke())}const l=t.getBoundingClientRect();let d;o.has(t)?d=o.get(t):(d=document.createElement("canvas"),d.width=l.width,d.height=l.height);const h=d.getContext("2d"),c=new function(e){const t=[];let i=!1;function o(){if(i&&(i=!1,e.restore()),0===t.length)return;let o=-1/0,s=-1/0,n=1/0,r=1/0;for(let e=0;e<t.length;e++){const i=t[e];o=Math.max(o,i.x),s=Math.max(s,i.y),n=Math.min(n,i.x+i.width),r=Math.min(r,i.y+i.height)}e.save(),e.beginPath(),e.rect(o,s,n-o,r-s),e.clip(),i=!0}return{add:function(e){t.push(e),o()},remove:function(){t.pop(),o()}}}(h);return function e(t,o){let d=0,p=0,u=0,m=0;if(t.nodeType===Node.TEXT_NODE){i.selectNode(t);const e=i.getBoundingClientRect();d=e.left-l.left-.5,p=e.top-l.top-.5,u=e.width,m=e.height,n(o,d,p,t.nodeValue.trim())}else{if(t.nodeType===Node.COMMENT_NODE)return;if(t instanceof HTMLCanvasElement){if("none"===t.style.display)return;h.save();const e=window.devicePixelRatio;h.scale(1/e,1/e),h.drawImage(t,0,0),h.restore()}else{if("none"===t.style.display)return;const e=t.getBoundingClientRect();d=e.left-l.left-.5,p=e.top-l.top-.5,u=e.width,m=e.height;const i=(o=window.getComputedStyle(t)).backgroundColor;r(d,p,u,m,parseFloat(o.borderRadius)),"transparent"!==i&&"rgba(0, 0, 0, 0)"!==i&&(h.fillStyle=i,h.fill());const f=["borderTop","borderLeft","borderBottom","borderRight"];let v=!0,g=null;for(const e of f){if(g&&(v=o[e+"Width"]===o[g+"Width"]&&o[e+"Color"]===o[g+"Color"]&&o[e+"Style"]===o[g+"Style"]),!v)break;g=e}if(v){const e=parseFloat(o.borderTopWidth);"0px"!==o.borderTopWidth&&"none"!==o.borderTopStyle&&"transparent"!==o.borderTopColor&&"rgba(0, 0, 0, 0)"!==o.borderTopColor&&(h.strokeStyle=o.borderTopColor,h.lineWidth=e,h.stroke())}else a(o,"borderTop",d,p,u,0),a(o,"borderLeft",d,p,0,m),a(o,"borderBottom",d,p+m,u,0),a(o,"borderRight",d+u,p,0,m);if(t instanceof HTMLInputElement){let e=o.accentColor;void 0!==e&&"auto"!==e||(e=o.color),s.set(e);const i=Math.sqrt(.299*s.r**2+.587*s.g**2+.114*s.b**2)<.5?"white":"#111111";if("radio"===t.type&&(r(d,p,u,m,m),h.fillStyle="white",h.strokeStyle=e,h.lineWidth=1,h.fill(),h.stroke(),t.checked)){const t=2;r(d+t,p+t,u-2*t,m-2*t,m),h.fillStyle=e,h.strokeStyle=i,h.lineWidth=t,h.fill(),h.stroke()}if("checkbox"===t.type&&(r(d,p,u,m,2),h.fillStyle=t.checked?e:"white",h.strokeStyle=t.checked?i:e,h.lineWidth=1,h.stroke(),h.fill(),t.checked)){const e=h.textAlign;h.textAlign="center",n({color:i,fontFamily:o.fontFamily,fontSize:m+"px",fontWeight:"bold"},d+u/2,p,"âœ”"),h.textAlign=e}if("range"===t.type){const[o,s,n]=["min","max","value"].map((e=>parseFloat(t[e]))),a=(n-o)/(s-o)*(u-m);r(d,p+.25*m,u,.5*m,.25*m),h.fillStyle=i,h.strokeStyle=e,h.lineWidth=1,h.fill(),h.stroke(),r(d,p+.25*m,a+.5*m,.5*m,.25*m),h.fillStyle=e,h.fill(),r(d+a,p,m,m,.5*m),h.fillStyle=e,h.fill()}"color"!==t.type&&"text"!==t.type&&"number"!==t.type||(c.add({x:d,y:p,width:u,height:m}),n(o,d+parseInt(o.paddingLeft),p+parseInt(o.paddingTop),t.value),c.remove())}}}const f="auto"===o.overflow||"hidden"===o.overflow;f&&c.add({x:d,y:p,width:u,height:m});for(let i=0;i<t.childNodes.length;i++)e(t.childNodes[i],o);f&&c.remove()}(t),d}const n={type:"",data:new THREE.Vector2};AFRAME.registerComponent("html",{schema:{html:{type:"selector"},cursor:{type:"selector"}},init(){this.rerender=this.rerender.bind(this),this.handle=this.handle.bind(this),this.el.addEventListener("click",(e=>this.handle("click",e))),this.el.addEventListener("mouseleave",(e=>this.handle("mouseleave",e))),this.el.addEventListener("mouseenter",(e=>this.handle("mouseenter",e))),this.el.addEventListener("mouseup",(e=>this.handle("mouseup",e))),this.el.addEventListener("mousedown",(e=>this.handle("mousedown",e)))},update(){if(this.remove(),!this.data.html)return;const e=new t(this.data.html);this.el.setObject3D("html",e),this.data.html.addEventListener("input",this.rerender),this.data.html.addEventListener("change",this.rerender),this.cursor=this.data.cursor?this.data.cursor.object3D:null},tick(){if(this.activeRaycaster){const e=this.activeRaycaster.components.raycaster.getIntersection(this.el);this.handle("mousemove",{detail:{cursorEl:this.activeRaycaster,intersection:e}})}},handle(e,t){const i=t.detail.intersection,o=t.detail.cursorEl;if("mouseenter"===e&&(this.activeRaycaster=o),"mouseleave"===e&&this.activeRaycaster===o&&(this.activeRaycaster=null),this.cursor&&(this.cursor.visible=!1),i){const t=this.el.getObject3D("html"),o=i.uv;n.type=e,n.data.set(o.x,1-o.y),t.dispatchEvent(n),this.cursor&&(this.cursor.visible=!0,this.cursor.parent.worldToLocal(this.cursor.position.copy(i.point)))}},rerender(){const e=this.el.getObject3D("html");e&&!e.material.map.scheduleUpdate&&(e.material.map.scheduleUpdate=setTimeout((()=>e.material.map.update()),16))},remove(){this.el.getObject3D("html")&&(this.el.removeObject3D("html"),this.data.html.removeEventListener("change",this.rerender))}})}(THREE);
//# sourceMappingURL=aframe-html.min.js.map
