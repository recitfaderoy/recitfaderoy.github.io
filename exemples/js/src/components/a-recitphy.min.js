!function e(t,s,i){function o(r,a){if(!s[r]){if(!t[r]){var l="function"==typeof require&&require;if(!a&&l)return l(r,!0);if(n)return n(r,!0);var h=new Error("Cannot find module '"+r+"'");throw h.code="MODULE_NOT_FOUND",h}var d=s[r]={exports:{}};t[r][0].call(d.exports,(function(e){return o(t[r][1][e]||e)}),d,d.exports,e,t,s,i)}return s[r].exports}for(var n="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r]);return o}({1:[function(e,t,s){t.exports={name:"a-recit",title:"A-RECIT",version:"0.0.0",description:"Education component game based for A-Frame",homepage:"https://github.com/xx/README.md",main:"index.js",scripts:{prepare:"npm run build",clean:"rm arecit/*.js || del arecit\\*.js",build:'npm run clean && foreach -g src/*.js -x "browserify #{path} -o arecit/#{name}.js" && npm run minify',watch:'npm run clean && foreach -g src/*.js -C -x "watchify #{path} -d -o arecit/#{name}.js"',minify:'foreach -g arecit/*.js -C -x "minify #{path} > arecit/#{name}.min.js"',bump:"npm version minor --no-git-tag-version",gitadd:"git add package*.json arecit/*.js"},"pre-commit":["bump","build","gitadd"],keywords:["aframe","aframe-component","webvr","webxr","gamedev"],author:"RECITFAD based on poeticAndroid work's",license:"MIT",devDependencies:{browserify:"^17.0.0","foreach-cli":"^1.8.1",minify:"^7.0.2","pre-commit":"^1.2.2",watchify:"^4.0.0"}}},{}],2:[function(e,t,s){e("./libs/pools"),e("./libs/copyWorldPosRot"),e("./libs/ensureElement"),e("./libs/touchGestures"),e("./libs/betterRaycaster"),addEventListener("DOMContentLoaded",(e=>{document.body.addEventListener("swipeup",(e=>{document.body.requestFullscreen()}))})),e("./components/physics");const i=e("../package");console.log(`${i.title} Version ${i.version} by ${i.author}\n(${i.homepage})`)},{"../package":1,"./components/physics":3,"./libs/betterRaycaster":7,"./libs/copyWorldPosRot":9,"./libs/ensureElement":10,"./libs/pools":11,"./libs/touchGestures":12}],3:[function(e,t,s){const i=e("../libs/cmdCodec"),o=e("../../package");AFRAME.registerSystem("physics",{schema:{workerUrl:{type:"string",default:`https://cdn.jsdelivr.net/npm/a-game@${o.version}/dist/cannonWorker.min.js`},gravity:{type:"vec3",default:{x:0,y:-10,z:0}},debug:{type:"boolean",default:!1}},update(){if(this.data.workerUrl){if(!this.worker){if(this.data.workerUrl.includes("//")){let e=`importScripts(${JSON.stringify(this.data.workerUrl)})`;this.worker=new Worker(`data:text/javascript;base64,${btoa(e)}`)}else this.worker=new Worker(this.data.workerUrl);this.worker.postMessage("log "+i.stringifyParam("Physics worker ready!")),this.worker.addEventListener("message",this.onMessage.bind(this))}this.bodies=this.bodies||[],this.movingBodies=this.movingBodies||[],this.joints=this.joints||[],this.buffers=[new Float64Array(8),new Float64Array(8)],this.worker.postMessage("world gravity = "+i.stringifyParam(this.data.gravity)),this._debug=this.data.debug}else this.remove()},remove(){this.worker&&this.worker.terminate(),this.worker=null,this.bodies=[],this.movingBodies=[]},tick(e,t){if(!this.worker)return;if(this.buffers.length<2)return;let s=this.buffers.shift();if(s.length<8*this.movingBodies.length){let e=s.length;for(;e<8*this.movingBodies.length;)e*=2;let t=this.movingBodies;s=new Float64Array(e),s.fill(NaN);let i=THREE.Vector3.temp(),o=THREE.Quaternion.temp();for(let e=0;e<t.length;e++){let n=8*e;t[e]&&(t[e].object3D.localToWorld(i.set(0,0,0)),s[n++]=i.x,s[n++]=i.y,s[n++]=i.z,n++,t[e].object3D.getWorldQuaternion(o),s[n++]=o.x,s[n++]=o.y,s[n++]=o.z,s[n++]=o.w)}}this.worker.postMessage(s,[s.buffer])},onMessage(e){if("string"==typeof e.data){let t=i.parse(e.data);switch(t.shift()){case"world":this.command(t)}}else if(e.data instanceof Float64Array)for(this.buffers.push(e.data);this.buffers.length>2;)this.buffers.shift()},command(e){switch("number"==typeof e[0]&&e.shift(),e.shift()){case"body":let t=e.shift(),s=this.bodies[t];s&&s.components.body.command(e)}},eval(e){this.worker.postMessage("world eval "+i.stringifyParam(e))}}),e("./physics/body"),e("./physics/shape"),e("./physics/joint")},{"../../package":1,"../libs/cmdCodec":8,"./physics/body":4,"./physics/joint":5,"./physics/shape":6}],4:[function(e,t,s){const i=e("../../libs/cmdCodec");AFRAME.registerComponent("body",{dependencies:["position","rotation","scale"],schema:{type:{type:"string",default:"dynamic"},mass:{type:"number",default:1},friction:{type:"number",default:.3},restitution:{type:"number",default:.3},belongsTo:{type:"int",default:1},collidesWith:{type:"int",default:1},emitsWith:{type:"int",default:0},sleeping:{type:"boolean",default:!1},autoShape:{type:"boolean",default:!0}},init(){let e=this.el.sceneEl.systems.physics.worker,t=this.el.sceneEl.systems.physics.bodies,s=this.el.sceneEl.systems.physics.movingBodies,o=this.el.sceneEl.systems.physics.buffers[0];if(!e)return;this.id=t.indexOf(null),this.id<0&&(this.id=t.length),t[this.id]=this.el,"static"!==this.data.type?(this.mid=s.indexOf(null),this.mid<0&&(this.mid=s.length),s[this.mid]=this.el):this.mid=null;let n={mid:this.mid};if(n.type=this.data.type,n.position=this.el.object3D.localToWorld(THREE.Vector3.temp().set(0,0,0)),n.quaternion=this.el.object3D.getWorldQuaternion(THREE.Quaternion.temp()),null!==this.mid){let e=8*this.mid;o[e++]=n.position.x,o[e++]=n.position.y,o[e++]=n.position.z,o[e++]=this.data.sleeping,o[e++]=n.quaternion.x,o[e++]=n.quaternion.y,o[e++]=n.quaternion.z,o[e++]=n.quaternion.w}if(this.shapes=[],this.sleeping=!0,e.postMessage("world body "+this.id+" create "+i.stringifyParam(n)),setTimeout((()=>{n.position=this.el.object3D.localToWorld(THREE.Vector3.temp().set(0,0,0)),n.quaternion=this.el.object3D.getWorldQuaternion(THREE.Quaternion.temp()),e.postMessage("world body "+this.id+" position = "+i.stringifyParam(n.position)),e.postMessage("world body "+this.id+" quaternion = "+i.stringifyParam(n.quaternion)),this.el.components.shape&&this.el.components.shape.play();let t=this.el.querySelectorAll("[shape]");t&&t.forEach((e=>{e.components.shape&&e.components.shape.play()})),this.el.components.joint&&this.el.components.joint.play();for(let e in this.el.components)"joint__"===e.substr(0,7)&&this.el.components[e].play()})),this.data.autoShape&&!this.el.components.shape)if(this.el.firstElementChild){let e=this.el.querySelectorAll("a-box, a-sphere, a-cylinder");e&&e.forEach((e=>{e.components.shape||e.setAttribute("shape",!0)}))}else this.el.setAttribute("shape",!0);this._initiated=!0},play(){this._initiated||(this.init(),this.update({}))},update(e){let t=this.el.sceneEl.systems.physics.worker;t&&(this.data.type!==e.type&&t.postMessage("world body "+this.id+" type = "+i.stringifyParam(this.data.type)),this.data.mass!==e.mass&&t.postMessage("world body "+this.id+" mass = "+i.stringifyParam(this.data.mass)),this.data.friction!==e.friction&&t.postMessage("world body "+this.id+" friction = "+i.stringifyParam(this.data.friction)),this.data.restitution!==e.restitution&&t.postMessage("world body "+this.id+" restitution = "+i.stringifyParam(this.data.restitution)),this.data.belongsTo!==e.belongsTo&&t.postMessage("world body "+this.id+" belongsTo = "+i.stringifyParam(this.data.belongsTo)),this.data.collidesWith!==e.collidesWith&&t.postMessage("world body "+this.id+" collidesWith = "+i.stringifyParam(this.data.collidesWith)),this.data.emitsWith!==e.emitsWith&&t.postMessage("world body "+this.id+" emitsWith = "+i.stringifyParam(this.data.emitsWith)),setTimeout((()=>{t.postMessage("world body "+this.id+" sleeping = "+!!this.data.sleeping)})))},sleep(){let e=this.el.sceneEl.systems.physics.worker;e&&(e.postMessage("world body "+this.id+" sleeping = true"),this.sleeping=!0)},applyWorldImpulse(e,t){let s=this.el.sceneEl.systems.physics.worker;s&&s.postMessage("world body "+this.id+" impulse "+i.stringifyParam(e)+" "+i.stringifyParam(t))},applyLocalImpulse(e,t){let s=this.el.object3D.localToWorld(THREE.Vector3.temp().copy(t)),i=this.el.object3D.localToWorld(THREE.Vector3.temp().copy(e)).sub(this.el.object3D.localToWorld(THREE.Vector3.temp().set(0,0,0)));this.applyWorldImpulse(i,s)},pause(){let e=this.el.sceneEl.systems.physics.worker,t=this.el.sceneEl.systems.physics.bodies,s=this.el.sceneEl.systems.physics.movingBodies;if(!e)return;this.el.components.joint&&this.el.components.joint.pause();for(let e in this.el.components)"joint__"===e.substr(0,7)&&this.el.components[e].pause();let i=this.el.querySelectorAll("[shape]");i&&i.forEach((e=>{e.components.shape&&e.components.shape.pause()})),this.el.components.shape&&this.el.components.shape.pause(),t[this.id]=null,null!==this.mid&&(s[this.mid]=null),e.postMessage("world body "+this.id+" remove"),this._initiated=!1},tick(){let e=this.el.sceneEl.systems.physics.worker,t=this.el.sceneEl.systems.physics.buffers[0];if(e&&null!==this.mid){let e=8*this.mid;if(t.length<=e)return;if("kinematic"===this.data.type){let s=this.el.object3D.localToWorld(THREE.Vector3.temp().set(0,0,0));t[e++]=s.x,t[e++]=s.y,t[e++]=s.z,this.sleeping=!!t[e++];let i=this.el.object3D.getWorldQuaternion(THREE.Quaternion.temp());t[e++]=i.x,t[e++]=i.y,t[e++]=i.z,t[e++]=i.w}else if(t[e+1]){let s=THREE.Quaternion.temp();this.el.object3D.position.set(t[e++],t[e++],t[e++]),this.el.object3D.parent.worldToLocal(this.el.object3D.position),this.sleeping=!!t[e++],this.el.object3D.getWorldQuaternion(s),this.el.object3D.quaternion.multiply(s.conjugate().normalize()),s.set(t[e++],t[e++],t[e++],t[e++]),this.el.object3D.quaternion.multiply(s.normalize())}}},command(e){switch(e.shift()){case"emits":let t=e.shift();switch(t.event){case"collision":let e=this.el.sceneEl.systems.physics.bodies;if(t.body1=e[t.body1],t.body2=e[t.body2],!t.body1||!t.body2)return;t.shape1=t.body1.components.body.shapes[t.shape1],t.shape2=t.body2.components.body.shapes[t.shape2]}this.el.emit(t.event,t)}},eval(e){this.el.sceneEl.systems.physics.worker.postMessage("world body "+this.id+" eval "+i.stringifyParam(e))},commit(){let e=this.el.sceneEl.systems.physics.worker,t=THREE.Vector3.temp(),s=THREE.Quaternion.temp();this.el.object3D.localToWorld(t.set(0,0,0)),e.postMessage("world body "+this.id+" position "+i.stringifyParam(t)),this.el.object3D.getWorldQuaternion(s),e.postMessage("world body "+this.id+" quaternion "+i.stringifyParam(s))}})},{"../../libs/cmdCodec":8}],5:[function(e,t,s){const i=e("../../libs/cmdCodec");AFRAME.registerComponent("joint",{multiple:!0,schema:{type:{type:"string",default:"ball"},body1:{type:"selector"},body2:{type:"selector"},pivot1:{type:"vec3",default:{x:0,y:0,z:0}},pivot2:{type:"vec3",default:{x:0,y:0,z:0}},axis1:{type:"vec3",default:{x:0,y:1,z:0}},axis2:{type:"vec3",default:{x:0,y:1,z:0}},min:{type:"number",default:0},max:{type:"number",default:1},collision:{type:"boolean",default:!0}},play(){if(null!=this._id)return;let e=this.el.sceneEl.systems.physics.worker,t=this.el.sceneEl.systems.physics.joints;if(!e)return;if(!this.data.body1.components.body)return this._retry=setTimeout((()=>{this.play()}),256);if(!this.data.body2.components.body)return this._retry=setTimeout((()=>{this.play()}),256);this._id=t.indexOf(null),this._id<0&&(this._id=t.length),t[this._id]=this.el;let s={};s.type=this.data.type,s.body1=this.data.body1?this.data.body1.components.body.id:this.el.components.body.id,s.body2=this.data.body2.components.body.id,s.pivot1=THREE.Vector3.temp().copy(this.data.pivot1),s.pivot2=THREE.Vector3.temp().copy(this.data.pivot2),s.axis1=this.data.axis1,s.axis2=this.data.axis2,s.min=this.data.min,s.max=this.data.max,s.collision=this.data.collision;let o=this.el.object3D.getWorldScale(THREE.Vector3.temp());s.pivot1.multiply(o),s.pivot2.multiply(o),e.postMessage("world joint "+this._id+" create "+i.stringifyParam(s))},update(e){this.el.sceneEl.systems.physics.worker&&(this.data.body1=this.data.body1||this.el)},pause(){clearTimeout(this._retry);let e=this.el.sceneEl.systems.physics.worker,t=this.el.sceneEl.systems.physics.joints;e&&(t[this._id]=null,e.postMessage("world joint "+this._id+" remove"),this._id=null)},eval(e){this.el.sceneEl.systems.physics.worker.postMessage("world joint "+this._id+" eval "+i.stringifyParam(e))}})},{"../../libs/cmdCodec":8}],6:[function(e,t,s){const i=e("../../libs/cmdCodec");AFRAME.registerComponent("shape",{schema:{},play(){if(null!=this.id)return;let e=this.el.sceneEl.systems.physics.worker;if(!e)return;for(this.body=this.el;this.body&&!this.body.matches("[body]");)this.body=this.body.parentElement;if(!this.body)return this._retry=setTimeout((()=>{this.play()}),256);this.bodyId=this.body.components.body.id;let t=this.body.components.body.shapes;this.id=t.indexOf(null),this.id<0&&(this.id=t.length),t[this.id]=this.el;let s={};s.position=this.el.object3D.getWorldPosition(THREE.Vector3.temp()),this.body.object3D.worldToLocal(s.position),s.quaternion=this.el.object3D.getWorldQuaternion(THREE.Quaternion.temp());let o=this.body.object3D.getWorldQuaternion(THREE.Quaternion.temp());switch(s.quaternion.multiply(o.conjugate().normalize()).normalize(),s.size=THREE.Vector3.temp().set(1,1,1),this.el.tagName.toLowerCase()){case"a-sphere":s.type="sphere",s.size.multiplyScalar(2*this.el.components.geometry.data.radius);break;case"a-cylinder":s.type="cylinder",s.size.multiplyScalar(2*this.el.components.geometry.data.radius).y=this.el.components.geometry.data.height;break;case"a-box":s.type="box",s.size.set(this.el.components.geometry.data.width,this.el.components.geometry.data.height,this.el.components.geometry.data.depth)}let n=this.el.object3D.getWorldScale(THREE.Vector3.temp());s.size.multiply(n),s.position.multiply(n),e.postMessage("world body "+this.bodyId+" shape "+this.id+" create "+i.stringifyParam(s))},pause(){if(clearTimeout(this._retry),!this.body)return;let e=this.el.sceneEl.systems.physics.worker;if(!e)return;let t=this.body.components.body.shapes;e.postMessage("world body "+this.bodyId+" shape "+this.id+" remove"),t[this.id]=null,this.id=null},eval(e){this.el.sceneEl.systems.physics.worker.postMessage("world body "+this.bodyId+" shape "+this.id+" eval "+i.stringifyParam(e))}})},{"../../libs/cmdCodec":8}],7:[function(e,t,s){const i=AFRAME.components.raycaster.Component.prototype.update,o=AFRAME.components.raycaster.Component.prototype.refreshObjects;function n(e){if(e.indexOf("*")>=0)return e;return(e+", ").replaceAll(","," *,")+e}AFRAME.components.raycaster.schema.deep=AFRAME.components.raycaster.schema.showLine,AFRAME.components.raycaster.Component.prototype.update=function(e){return this.data.deep&&e.objects!==this.data.objects&&(this._matchSelector=this.data.objects,this.data.objects=n(this.data.objects)),i.apply(this,arguments)},AFRAME.components.raycaster.Component.prototype.refreshObjects=function(){let e=o.apply(this,arguments);if(this.data.deep){let e=this.intersections;for(let t of e)for(t.el=t.object.el;t.el&&!t.el.matches(this._matchSelector);)t.el=t.el.parentNode}return e}},{}],8:[function(e,t,s){t.exports={parse(e){let t=e.split(" "),s=[];for(let e of t)if(e)try{s.push(JSON.parse(e))}catch(t){"="!==e&&s.push(e)}return s},stringifyParam:e=>JSON.stringify(e).replaceAll(" ","\\u0020").replaceAll('"_','"')}},{}],9:[function(e,t,s){AFRAME.AEntity.prototype.copyWorldPosRot=function(e){let t=THREE.Quaternion.temp(),s=e.object3D,i=this.object3D;s&&i&&i.parent&&(s.localToWorld(i.position.set(0,0,0)),i.parent.worldToLocal(i.position),i.getWorldQuaternion(t),i.quaternion.multiply(t.conjugate().normalize()),s.getWorldQuaternion(t),i.quaternion.multiply(t.normalize()),i.updateWorldMatrix(!0,!0))}},{}],10:[function(e,t,s){Element.prototype.ensure=function(e,t=e,s={},i=""){let o,n,r;if(o=this.querySelector(e),!o){for(n in o=document.createElement(t),this.appendChild(o),s)r=s[n],o.setAttribute(n,r);o.innerHTML=i}return o}},{}],11:[function(e,t,s){function i(e){e._pool=[],e._inUse=[],e.temp=function(){let t=e._pool.pop()||new e;return e._inUse.push(t),e._gc||(e._gc=setTimeout(e._recycle)),t},e._recycle=function(){for(;e._inUse.length;)e._pool.push(e._inUse.pop());e._gc=!1}}i(THREE.Vector2),i(THREE.Vector3),i(THREE.Quaternion),i(THREE.Matrix3),i(THREE.Matrix4)},{}],12:[function(e,t,s){let i=Element.prototype.addEventListener,o=Element.prototype.removeEventListener,n=e=>{if(e._tgest)return e._tgest;let t,s,i,o;e._tgest={handlers:{swipeup:[],swipedown:[],swipeleft:[],swiperight:[],tap:[],hold:[]}};let n=(t,s)=>{if(e._tgest.handlers[t])for(let i of e._tgest.handlers[t])i(s);else console.log(t,e._tgest.handlers[t])};return e.addEventListener("touchstart",(e=>{t=e.changedTouches[0].screenX,s=e.changedTouches[0].screenY,o=!1,i=setTimeout((()=>{o=!0,n("hold",e)}),512)})),e.addEventListener("touchmove",(e=>{let r=e.changedTouches[0].screenX,a=e.changedTouches[0].screenY;if(Math.sqrt(Math.pow(t-r,2)+Math.pow(s-a,2))>32){if(clearTimeout(i),o)return;Math.abs(t-r)>Math.abs(s-a)?n(r<t?"swipeleft":"swiperight",e):n(a<s?"swipeup":"swipedown",e),o=!0}})),e.addEventListener("touchend",(e=>{clearTimeout(i);let r=e.changedTouches[0].screenX,a=e.changedTouches[0].screenY;if(Math.sqrt(Math.pow(t-r,2)+Math.pow(s-a,2))<32){if(o)return;n("tap",e)}})),e._tgest};Element.prototype.addEventListener=function(e,t){switch(e){case"swipeup":case"swipedown":case"swipeleft":case"swiperight":case"tap":case"hold":n(this).handlers[e].push(t);break;default:return i.call(this,e,t)}},Element.prototype.removeEventListener=function(e,t){switch(e){case"swipeup":case"swipedown":case"swipeleft":case"swiperight":case"tap":case"hold":let s=n(this),i=s.handlers[e].indexOf(t);i>=0&&s.handlers[e].splice(i,1);break;default:return o.call(this,e,t)}}},{}]},{},[2]);
